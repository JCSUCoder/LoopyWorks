/*! For license information please see main.js.LICENSE.txt */
(()=>{var e={591:(e,t,o)=>{var n,i,a,r;i=window,a={},r=i.c_||{},a.publish=function(e,t){for(var o=r[e],n=o?o.length:0;n--;)o[n].apply(i,t||[])},a.subscribe=function(e,t){return r[e]||(r[e]=[]),r[e].push(t),[e,t]},a.unsubscribe=function(e,t){for(var o=r[t?e:e[0]],n=(t=t||e[1],o?o.length:0);n--;)o[n]===t&&o.splice(n,1)},e.exports?e.exports=t=a:void 0===(n=function(){return a}.call(t,o,t,e))||(e.exports=n)}},t={};function o(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,o),a.exports}(()=>{"use strict";var e=o(591),t={MODE_EDIT:0,MODE_PLAY:1,TOOL_INK:0,TOOL_DRAG:1,TOOL_ERASE:2,TOOL_LABEL:3,TOOL_PAN:4,TOOL_LOOP:5};Math.TAU=2*Math.PI,window.HIGHLIGHT_COLOR="rgba(193, 220, 255, 0.6)";var n=!!navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i);function i(e){var t=document.createElement("div");return t.innerHTML=e,t.setAttribute("class","component_label"),t}function a(e,t){var o=document.createElement("div");return o.innerHTML=e,o.onclick=t,o.setAttribute("class","component_button"),o}function r(e,t){var o=t?document.createElement("textarea"):document.createElement("input");return o.setAttribute("class",e),o.addEventListener("keydown",(function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),!1),o}function s(e){var t={};return t.dom=document.createElement("input"),t.dom.style.border="none",t.dom.style.width="40px",t.dom.style.padding="5px",t.dom.addEventListener("keydown",(function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),!1),t.dom.onchange=function(){var o=parseInt(t.getValue());isNaN(o)&&(o=0),t.setValue(o),e(o)},t.dom.onclick=function(){t.dom.select()},t.getValue=function(){return t.dom.value},t.setValue=function(e){t.dom.value=e},t}function l(e,t,o,n){var i=function(e){var o=a(e);t(o)},a=function(t){var n={};if(t.changedTouches){var i=function(e){var t=e.getBoundingClientRect();return{left:t.left,top:t.top}}(e);n.x=t.changedTouches[0].clientX-i.left,n.y=t.changedTouches[0].clientY-i.top,t.preventDefault()}else n.x=t.offsetX,n.y=t.offsetY;return o(n),n},r=function(e){n({})};e.addEventListener("mousedown",i),e.addEventListener("mousemove",a),document.body.addEventListener("mouseup",r),e.addEventListener("touchstart",i,{capture:!1,passive:!0}),e.addEventListener("touchmove",a,{capture:!1,passive:!0}),document.body.addEventListener("touchend",r,{capture:!1,passive:!0})}function d(e){for(var t=1/0,o=1/0,n=-1/0,i=-1/0,a=0;a<e.length;a++){var r=e[a];r[0]<t&&(t=r[0]),n<r[0]&&(n=r[0]),r[1]<o&&(o=r[1]),i<r[1]&&(i=r[1])}return{left:t,right:n,top:o,bottom:i,width:n-t,height:i-o}}function u(e,t,o){e=JSON.parse(JSON.stringify(e));for(var n=0;n<e.length;n++){var i=e[n];i[0]+=t,i[1]+=o}return e}function c(e,t){e=JSON.parse(JSON.stringify(e));for(var o=0;o<e.length;o++){var n=e[o],i=n[0],a=n[1];n[0]=i*Math.cos(t)-a*Math.sin(t),n[1]=a*Math.cos(t)+i*Math.sin(t)}return e}function h(e,t,o){for(var n in o){if(void 0===t[n]){var i=o[n];"function"==typeof i&&(i=i()),t[n]=i}e[n]=t[n]}}function p(e,t,o,n,i){var a=o-e,r=n-t;return a*a+r*r<=i*i}function f(e){return function(){throw Error(e)}}function m(e,t,o){for(var n="#",i=0;i<3;i++){var a=e.substring(1+2*i,3+2*i),r=t.substring(1+2*i,3+2*i),s=parseInt(a,16),l=parseInt(r,16);n+=("0"+Math.floor(s*(1-o)+l*o).toString(16).toUpperCase()).slice(-2)}return n}window.onresize=function(){(0,e.publish)("resize")},window.onbeforeunload=function(e){if(loopy.dirty){var t="Are you sure you want to leave without saving your changes?";return e.returnValue=t,t}};var g=25,b=110;function y(e,t){var o=e.clientWidth,n=e.clientHeight;t.width=2*o,t.height=2*n,t.style.width=o+"px",t.style.height=n+"px"}var v=["#EA3E3E","#EA9D51","#FEEE43","#BFEE3F","#7FD4FF","#A97FFF"];function w(e,t){for(var o,n=0;n<document.styleSheets.length;n++)document.styleSheets[n].href&&document.styleSheets[n].href.indexOf(e)>-1&&(o=document.styleSheets[n].ownerNode);if(null==t&&(t=!o),t){if(o)return t;var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=e,document.getElementsByTagName("head")[0].appendChild(i)}else o&&o.parentNode.removeChild(o);return t}window.Mouse={},Mouse.init=function(o,n){return l(n,(function(t){Mouse.moved=!1,Mouse.pressed=!0,Mouse.startedOnTarget=!0,(0,e.publish)("mousedown")}),(function(n){var i=document.getElementById("canvasses"),a=0,r=0,s=1/o.offsetScale,l=i.clientWidth-g-g,d=i.clientHeight-b-g;o.embedded&&(a-=12.5,r-=12.5),a-=(l+g)/2,r-=(d+g)/2,a*=s,r*=s,a+=(l+g)/2,r+=(d+g)/2,o.tool!=t.TOOL_PAN&&(a-=o.offsetX,r-=o.offsetY);var u=n.x*s+a,c=n.y*s+r;Mouse.x=u,Mouse.y=c,Mouse.moved=!0,(0,e.publish)("mousemove")}),(function(){Mouse.pressed=!1,Mouse.startedOnTarget&&((0,e.publish)("mouseup"),Mouse.moved||(0,e.publish)("mouseclick")),Mouse.moved=!1,Mouse.startedOnTarget=!1})),Mouse.target=n,Mouse.showCursor=function(e){Mouse.target.style.cursor=e},Mouse.update=function(){Mouse.showCursor("")},Mouse};const M=Mouse;function k(e){var t={};return t.dom=e,t.pages=[],t.addPage=function(e,o){o.id=e,t.dom.appendChild(o.dom),t.pages.push(o)},t.currentPage={edit:()=>{}},t.showPage=function(e){for(var o={edit:()=>{}},n=0;n<t.pages.length;n++){var i=t.pages[n];i.id==e?(i.show(),o=i):i.hide()}return t.currentPage=o,o},t}function E(){var e=this;e.dom=document.createElement("div"),e.show=function(){e.dom.style.display="flex"},e.hide=function(){e.dom.style.display="none"},e.addComponent=function(t){return e.dom.appendChild(t.dom),t}}function x(t,o){var n=this;n._CLASS_="LoopMark",n.loopy=t.loopy,n.model=t,n.config=o,h(n,o,{x:0,y:0,clockwise:x.defaultOrientation,reinforcement:x.defaultType,color:x.defaultColor}),n.kill=function(){t.removeLoopMark(n),(0,e.publish)("kill",[n])},n.draw=function(e){var t,o=2*n.x,i=2*n.y;e.save(),e.translate(o,i),n.loopy.sidebar.currentPage.target==n&&(e.beginPath(),e.arc(0,0,60,0,Math.TAU,!1),e.fillStyle=HIGHLIGHT_COLOR,e.fill()),e.beginPath(),e.strokeStyle=n.color,e.lineWidth=6,n.clockwise?(e.arc(0,0,40,5*-Math.PI/4,2*Math.PI/5,!n.clockwise),t=2*Math.PI/5):(e.arc(0,0,40,1*Math.PI/4,7*-Math.PI/5,!n.clockwise),t=7*-Math.PI/5),e.stroke(),e.font="100 40px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillStyle=n.color,n.reinforcement?e.fillText("R",0,0):e.fillText("B",0,0),e.translate(20*Math.cos(t)*2,20*Math.sin(t)*2),n.clockwise?e.rotate(t+Math.PI):e.rotate(t),e.moveTo(6,6),e.lineTo(0,0),e.lineTo(-6,6),e.stroke(),e.restore()},n.isPointInLoopMark=function(e,t){var o=n.x-e,i=n.y-t;return Math.sqrt(o*o+i*i)<=20}}function C(o,n){var i=this;i._CLASS_="Edge",i.loopy=o.loopy,i.model=o,i.config=n,h(i,n,{from:f("CAN'T LEAVE 'FROM' BLANK"),to:f("CAN'T LEAVE 'TO' BLANK"),arc:100,rotation:0,strength:C.defaultStrength,thickness:C.defaultThickness,color:C.defaultColor,delay:C.defaultDelay}),i.from=o.getNode(i.from),i.to=o.getNode(i.to),i.signals=[],i.signalSpeed=0,i.addSignal=function(e){if(!(C.allSignals.length>C.MAX_SIGNALS||i.signals.length>C.MAX_SIGNALS_PER_EDGE)){var t,o=e.delta;t=void 0===e.age?1e6:e.age-1;var n={delta:o,position:0,scaleX:Math.abs(o),scaleY:o,age:t};t<=0||(i.signals.unshift(n),C.allSignals.push(n))}},i.updateSignals=function(){var e=Math.pow(2,i.loopy.signalSpeed),t=1;i.delay>0&&(t=i.delay+1),i.signalSpeed=e/(680*t);for(var o=0;o<i.signals.length;o++){var n=i.signals[o];n.position,n.position+=i.signalSpeed}for(var a=i.signals[i.signals.length-1];a&&a.position>=1;)a.delta*=i.strength,i.to.takeSignal(a),i.removeSignal(a),a=i.signals[i.signals.length-1]},i.removeSignal=function(e){i.signals.splice(i.signals.indexOf(e),1),C.allSignals.splice(C.allSignals.indexOf(e),1)},i.drawSignals=function(e){for(var t=0;t<i.signals.length;t++){var o=i.signals[t],n=i.getPositionAlongArrow(o.position),a=n.x,r=n.y;e.save(),e.translate(a,r),e.rotate(-b),e.scale(o.scaleX,o.scaleY),e.scale(40,40);var s,l=m(i.from.hue,i.to.hue,s=o.position<.4?0:o.position<.6?(o.position-.4)/(.6-.4):1);if(i.strength<0){var d=Math.cos(s*Math.PI);e.scale(1,d)}2==o.age?e.globalAlpha=.5:1==o.age&&(e.globalAlpha=.25),e.beginPath(),e.moveTo(-2,0),e.lineTo(0,-2),e.lineTo(2,0),e.lineTo(1,0),e.lineTo(1,2),e.lineTo(-1,2),e.lineTo(-1,0),e.fillStyle=l,e.fill(),e.restore()}};var a,r,s,l,d,u,c,g,b,y,v,w,M,k,E,x,T,_,I,L,S,A,P,O,B,D,U,N,R,Y,X,F,V,H=(0,e.subscribe)("model/reset",(function(){i.signals=[],C.allSignals=[]}));i.labelX=0,i.labelY=0,i.update=function(e){if(0==i.arc&&(i.arc=.1),a=2*i.from.x,r=2*i.from.y,s=2*i.to.x,l=2*i.to.y,i.from==i.to){var t=i.rotation;t*=Math.TAU/360,s+=Math.cos(t),l+=Math.sin(t)}u=s-a,c=l-r,g=Math.sqrt(u*u+c*c),b=Math.atan2(c,u),y=Math.abs(2*i.arc),v=(d=y/2+g*g/(8*y))-y,w=Math.acos(g/2/d),M=2*(i.to.radius+15),k=M/d,E=2*(i.from.radius+15),x=E/d,T=w-Math.TAU/2,_=-w,y>d&&(T*=-1,_*=-1),i.arc>0?(I=v,L=T+x,S=_-k):(I=-v,L=-T-x,S=-_+k),A=20,P=g/2+Math.cos(S)*d,O=I+Math.sin(S)*d,B=S+Math.TAU/4;var o=g/4/d;V=i.arc>0?S-o:S+o,i.from==i.to&&(V-=Math.PI/2),X=70,F=30,R=g/2+Math.cos(V)*d,Y=I+Math.sin(V)*d;var n,h=i.strength;n=h>=3?"+++":h>=2?"++":h>=1?"+":0==h?"?":h>=-1?"–":h>=-2?"– –":"– – –",i.label=n;var p=i.getPositionAlongArrow(.5);D=p.x,U=p.y,i.labelX=(a+Math.cos(b)*D-Math.sin(b)*U)/2,i.labelY=(r+Math.sin(b)*D+Math.cos(b)*U)/2,N=36,i.arc<0&&(N*=-1),U+=N,i.updateSignals()},i.getArrowLength=function(){var e;return i.from==i.to?d*Math.TAU-2*i.from.radius:(e=v<0?i.arc<0?Math.TAU+L-S:Math.TAU+S-L:Math.abs(S-L),d*e)},i.getPositionAlongArrow=function(e){e=1.1*e-.05;var t=L;v<0&&(t>0?t-=Math.TAU:t+=Math.TAU);var o=t+(S-t)*e;return{x:g/2+Math.cos(o)*d,y:I+Math.sin(o)*d}},i.draw=function(e){e.lineWidth=i.thickness,e.strokeStyle=i.color,e.save(),e.translate(a,r),e.rotate(b),i.loopy.sidebar.currentPage.target==i&&(e.save(),e.translate(D,U),e.rotate(-b),e.beginPath(),e.arc(0,5,60,0,Math.TAU,!1),e.fillStyle=HIGHLIGHT_COLOR,e.fill(),e.restore()),e.beginPath(),i.arc>0?e.arc(g/2,I,d,T,S,!1):e.arc(g/2,I,d,-T,S,!0),e.save(),e.translate(P,O),i.arc<0&&e.scale(-1,-1),e.rotate(B),e.moveTo(-A,-A),e.lineTo(0,0),e.lineTo(-A,A),e.restore(),e.stroke(),i.delay>0&&(e.save(),e.translate(R,Y),i.arc<0&&e.scale(-1,-1),e.rotate(V),e.moveTo(-X/2,0),e.lineTo(X/2,0),e.stroke(),e.moveTo(-X/2,F),e.lineTo(X/2,F),e.stroke(),e.restore()),e.font="100 60px sans-serif",e.textAlign="center",e.textBaseline="middle",e.save(),e.translate(D,U),e.rotate(-b),e.fillStyle=i.color,e.fillText(i.label,0,0),e.restore(),i.drawSignals(e),e.restore()},i.kill=function(){(0,e.unsubscribe)("model/reset",H),o.removeEdge(i),(0,e.publish)("kill",[i])},i.isPointOnLabel=function(e,o){var n;return n=i.loopy.tool==t.TOOL_DRAG||i.loopy.tool==t.TOOL_INK?40:i.loopy.tool==t.TOOL_ERASE?25:15,p(e,o,i.labelX,i.labelY,n)},i.getBoundingBox=function(){if(i.from==i.to){var e=b-Math.TAU/4,t=a+Math.cos(e)*-I,o=r+Math.sin(e)*-I,n=d/2;return{left:(t/=2)-n,top:(o/=2)-n,right:t+n,bottom:o+n}}var s={x:i.from.x,y:i.from.y},l={x:i.to.x,y:i.to.y},u={x:(s.x+l.x)/2,y:(s.y+l.y)/2};e=b-Math.TAU/4,u.x+=Math.cos(e)*i.arc,u.y+=Math.sin(e)*i.arc;for(var c=1/0,h=1/0,p=-1/0,f=-1/0,m=[s,l,u],g=0;g<m.length;g++){var y=m[g],v=y.x,w=y.y;c>v&&(c=v),h>w&&(h=w),p<v&&(p=v),f<w&&(f=w)}return{left:c,top:h,right:p,bottom:f}}}function T(e){var t=this;t.target=null,t.dom=document.createElement("div"),t.show=function(){t.dom.style.display="block",t.onshow()},t.hide=function(){t.dom.style.display="none",t.onhide()};var o=t.dom;t.components=[],t.componentsByID={},t.addComponent=function(e,n){return n||(n=e,e=""),n.page=t,n.propName=e,o.appendChild(n.dom),t.components.push(n),t.componentsByID[e]=n,n},t.getComponent=function(e){return t.componentsByID[e]},t.edit=function(e){t.target=e;for(var o=0;o<t.components.length;o++)t.components[o].show();t.onedit()},e&&t.addComponent(new A({header:!0,label:"Go Back",onclick:function(){e.showPage("Edit")}})),(o=document.createElement("div")).classList.add("form_container"),t.dom.appendChild(o),t.onedit=function(){},t.onshow=function(){},t.onhide=function(){},t.hide()}function _(){var t=this;t.dom=null,t.page=null,t.propName=null,t.show=function(){},t.getValue=function(){return t.page.target[t.propName]},t.setValue=function(o){(0,e.publish)("model/changed"),t.page.target[t.propName]=o,t.page.onedit()}}function I(e){var t=this;_.apply(t),t.dom=document.createElement("div");var o=i(e.label),n=r(e.textarea?"component_textarea":"component_input",e.textarea);n.oninput=function(e){t.setValue(n.value)},t.dom.appendChild(o),t.dom.appendChild(n),t.show=function(){n.value=t.getValue()},t.select=function(){setTimeout((function(){n.select()}),10)}}function L(e){var t=this;_.apply(t),t.dom=document.createElement("div");var o=i(e.label),n=function(e){var t=document.createElement("input");return t.setAttribute("class","component_input"),t.setAttribute("type","color"),t.addEventListener("keydown",(function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),!1),t}();n.oninput=function(e){t.setValue(n.value)},t.dom.appendChild(o),t.dom.appendChild(n),t.show=function(){n.value=t.getValue()},t.select=function(){setTimeout((function(){n.select()}),10)}}function S(e){var t=this;_.apply(t),t.dom=document.createElement("div");var o=i(e.label);t.dom.appendChild(o);var n=document.createElement("div");n.setAttribute("class","component_slider"),t.dom.appendChild(n);var a=new Image;a.draggable=!1,a.src="assets/sliders/"+e.bg+".png",a.setAttribute("class","component_slider_graphic");var r=new Image;r.draggable=!1,r.src="assets/sliders/slider_pointer.png",r.setAttribute("class","component_slider_pointer"),n.appendChild(a),n.appendChild(r);var s=function(){var o=t.getValue(),n=(e.options.indexOf(o)+.5)*(250/e.options.length);r.style.left=n-7.5+"px"},d=!1,u=function(o){var n=o.x/250,i=Math.floor(n*e.options.length),a=e.options[i];void 0!==a&&(t.setValue(a),e.oninput&&e.oninput(a),s())};l(a,(function(e){d=!0,u(e)}),(function(e){d&&u(e)}),(function(){d=!1})),t.show=function(){s()},t.setBGColor=function(e){a.style.background=e}}function A(e){var t=this;_.apply(t),t.dom=document.createElement("div");var o=a(e.label,(function(){e.onclick(t.page.target)}));t.dom.appendChild(o),e.header&&o.setAttribute("header","yes")}function P(e){var t=this;_.apply(t),t.dom=document.createElement("div"),t.dom.innerHTML=e.html}function O(e){var t=this;_.apply(t),t.dom=r("component_output"),t.dom.setAttribute("readonly","true"),t.dom.onclick=function(){t.dom.select()},t.output=function(e){t.dom.value=e}}x.defaultOrientation=1,x.defaultType=1,x.defaultColor="#666666",C.allSignals=[],C.MAX_SIGNALS=100,C.MAX_SIGNALS_PER_EDGE=10,C.defaultStrength=1,C.defaultColor="#666",C.defaultThickness=3,C.defaultDelay=0;function B(e,t){var o=this;o.id=t.id,o.dom=document.createElement("div"),o.dom.setAttribute("class","toolbar_button"),o.dom.style.backgroundImage="url('"+t.icon+"')",o.dom.setAttribute("aria-label",t.tooltip),o.dom.setAttribute("data-balloon-pos","down-left"),o.select=function(){o.dom.setAttribute("selected","yes")},o.deselect=function(){o.dom.setAttribute("selected","no")},"lock"==t.id?o.callback=function(){t.callback(),loopy.locked?o.select():o.deselect()}:"fs"==t.id?o.callback=function(){t.callback()}:o.callback=function(){t.callback(),e.selectButton(o)},o.dom.onclick=o.callback}const D=function(o){var n={},i=[];return n.buttonsByID={},n.dom=document.getElementById("toolbar"),n.addButton=function(t){var a=t.id,r=t.tooltip,s=t.callback,l=new B(n,{id:a,icon:"assets/nicons/"+a+".svg",tooltip:r,callback:s});n.dom.appendChild(l.dom),i.push(l),n.buttonsByID[a]=l,function(t){(0,e.subscribe)("key/"+t,(function(){o.ink.reset(),n.buttonsByID[t].callback()}))}(a)},n.addSeparator=function(){var e=document.createElement("div");e.setAttribute("class","toolbar_separator"),e.style.backgroundImage="url('assets/icons/separator.png')",n.dom.appendChild(e)},n.selectButton=function(e){for(var t=0;t<i.length;t++)i[t].deselect();o.locked&&i[i.length-1].select(),e.select()},n.currentTool="drag",n.setTool=function(e){n.currentTool=e;var i="TOOL_"+e.toUpperCase();o.tool=t[i],document.getElementById("canvasses").setAttribute("cursor",e)},n.addButton({id:"drag",tooltip:"MO(V)E",callback:function(){n.setTool("drag")}}),n.addButton({id:"pan",tooltip:"(P)AN",callback:function(){n.setTool("pan")}}),n.addSeparator(),n.addButton({id:"ink",tooltip:"PE(N)CIL",callback:function(){n.setTool("ink")}}),n.addButton({id:"loop",tooltip:"(L)OOP",callback:function(){n.setTool("loop")}}),n.addButton({id:"label",tooltip:"(T)EXT",callback:function(){n.setTool("label")}}),n.addButton({id:"erase",tooltip:"(E)RASE",callback:function(){n.setTool("erase")}}),n.addSeparator(),n.addButton({id:"lock",tooltip:"Press to Lock Edit Tools",callback:function(){o.locked?o.locked=!1:o.locked=!0}}),n.addSeparator(),n.addButton({id:"fs",tooltip:"Return to the Landing Page",callback:function(){w("assets/fs.css")}}),n.buttonsByID.drag.callback(),(0,e.subscribe)("model/changed",(function(){o.locked||n.buttonsByID.drag.callback()})),n};function U(o){var n={};n.loopy=o;var i=function(){var t=document.getElementById("canvasses"),o=document.createElement("canvas"),n=function(){var e=t.clientWidth,n=t.clientHeight;o.width=2*e,o.style.width=e+"px",o.height=2*n,o.style.height=n+"px"};return n(),t.appendChild(o),(0,e.subscribe)("resize",(function(){n()})),o}(),a=i.getContext("2d");return n.canvas=i,n.context=a,n.strokeData=[],n.drawInk=function(){if(Mouse.pressed){var e=n.strokeData[n.strokeData.length-1];a.strokeStyle="#ccc",a.lineWidth=5,a.lineCap="round";var t=document.getElementById("canvasses"),i=t.clientWidth-g-g,r=t.clientHeight-b-g,s=2*o.offsetX,l=2*o.offsetY;s-=i+g,l-=r+g;var d=o.offsetScale;s*=d,l*=d,s+=i+g,l+=r+g,o.embedded&&(s+=g,l+=g),a.setTransform(d,0,0,d,s,l),a.beginPath(),a.moveTo(2*e[0],2*e[1]),a.lineTo(2*Mouse.x,2*Mouse.y),a.stroke(),n.strokeData.push([Mouse.x,Mouse.y])}},n.reset=function(){var e=document.getElementById("canvasses"),t=e.clientWidth-g-g,r=e.clientHeight-b-g,s=2*o.offsetX,l=2*o.offsetY;s-=t+g,l-=r+g;var d=o.offsetScale;s*=d,l*=d,s+=t+g,l+=r+g,o.embedded&&(s+=g,l+=g),a.clearRect(-s,-l,i.width,i.height),n.strokeData=[]},(0,e.subscribe)("mousedown",(function(){n.loopy.mode==t.MODE_EDIT&&n.loopy.tool==t.TOOL_INK&&(n.strokeData=[],n.strokeData.push([Mouse.x,Mouse.y]),n.drawInk())})),(0,e.subscribe)("mousemove",(function(){n.loopy.mode==t.MODE_EDIT&&n.loopy.tool==t.TOOL_INK&&n.drawInk()})),(0,e.subscribe)("mouseup",(function(){if(n.loopy.mode==t.MODE_EDIT&&n.loopy.tool==t.TOOL_INK&&!(n.strokeData.length<2)&&Mouse.moved){var e=n.strokeData[0],i=o.model.getNodeByPoint(e[0],e[1]);i||(i=o.model.getNodeByPoint(e[0],e[1],20));var a=n.strokeData[n.strokeData.length-1],r=o.model.getNodeByPoint(a[0],a[1]);if(r||(r=o.model.getNodeByPoint(a[0],a[1],40)),i&&r){var s={from:i.id,to:r.id};if(i==r){var l=((b=d(n.strokeData)).left+b.right)/2,h=(b.top+b.bottom)/2,p=l-i.x,f=h-i.y,m=Math.atan2(f,p);if(b=d(c(u(n.strokeData,-i.x,-i.y),-m)),s.rotation=m*(360/Math.TAU)+90,s.arc=b.right,s.arc<i.radius)s=null,o.sidebar.edit(i);else{var g=i.radius+25;s.arc<g&&(s.arc=g)}}else{p=r.x-i.x,f=r.y-i.y,m=Math.atan2(f,p);var b=d(c(u(n.strokeData,-i.x,-i.y),-m));Math.abs(b.top)>Math.abs(b.bottom)?s.arc=-b.top:s.arc=-b.bottom}if(s){var y=o.model.addEdge(s);o.sidebar.edit(y)}}if(!i){l=((b=d(n.strokeData)).left+b.right)/2,h=(b.top+b.bottom)/2;var v=(b.width/2+b.height/2)/2;if(v>15){var w=o.model.addNode({x:l,y:h,radius:v});o.sidebar.edit(w)}}n.reset()}})),(0,e.subscribe)("mouseclick",(function(){n.loopy.mode==t.MODE_EDIT&&n.loopy.tool==t.TOOL_INK&&n.reset()})),n}U.MINIMUM_RADIUS=Node.DEFAULT_RADIUS,U.SNAP_TO_RADIUS=25;const N=U,R=function(o){var n={};return n.loopy=o,n.dragging=null,n.offsetX=0,n.offsetY=0,(0,e.subscribe)("mousedown",(function(){if(n.loopy.mode==t.MODE_EDIT&&n.loopy.tool==t.TOOL_DRAG){var e=o.model.getNodeByPoint(Mouse.x,Mouse.y);if(e)return n.dragging=e,n.offsetX=Mouse.x-e.x,n.offsetY=Mouse.y-e.y,void o.sidebar.edit(e);var i=o.model.getLabelByPoint(Mouse.x,Mouse.y);if(i)return n.dragging=i,n.offsetX=Mouse.x-i.x,n.offsetY=Mouse.y-i.y,void o.sidebar.edit(i);var a=o.model.getEdgeByPoint(Mouse.x,Mouse.y);if(a)return n.dragging=a,n.offsetX=Mouse.x-a.labelX,n.offsetY=Mouse.y-a.labelY,void o.sidebar.edit(a);var r=o.model.getLoopMarkByPoint(Mouse.x,Mouse.y);return r?(n.dragging=r,n.offsetX=Mouse.x-r.x,n.offsetY=Mouse.y-r.y,void o.sidebar.edit(r)):void 0}})),(0,e.subscribe)("mousemove",(function(){if(n.loopy.mode==t.MODE_EDIT&&n.loopy.tool==t.TOOL_DRAG){if(n.dragging&&"Node"==n.dragging._CLASS_){(0,e.publish)("model/changed");var i=n.dragging;i.x=Mouse.x-n.offsetX,i.y=Mouse.y-n.offsetY,o.model.update()}if(n.dragging&&"Edge"==n.dragging._CLASS_){(0,e.publish)("model/changed");var a=n.dragging,r=Mouse.x-n.offsetX,s=Mouse.y-n.offsetY;if(a.from!=a.to){var l=a.from.x,d=a.from.y,h=a.to.x-l,p=a.to.y-d,f=Math.atan2(p,h),m=c(u([[r,s]],-l,-d),-f)[0];a.arc=-m[1]}else{h=r-a.from.x,p=s-a.from.y,f=Math.atan2(p,h);var g=Math.sqrt(h*h+p*p),b=a.from.radius+25;g<b&&(g=b),a.arc=g,a.rotation=f*(360/Math.TAU)+90}o.model.update()}if(n.dragging&&"Label"==n.dragging._CLASS_){(0,e.publish)("model/changed");var y=n.dragging;y.x=Mouse.x-n.offsetX,y.y=Mouse.y-n.offsetY,o.model.update()}if(n.dragging&&"LoopMark"==n.dragging._CLASS_){(0,e.publish)("model/changed");var v=n.dragging;v.x=Mouse.x-n.offsetX,v.y=Mouse.y-n.offsetY,o.model.update()}}})),(0,e.subscribe)("mouseup",(function(){n.loopy.mode==t.MODE_EDIT&&n.loopy.tool==t.TOOL_DRAG&&(n.dragging=null,n.offsetX=0,n.offsetY=0)})),n},Y=function(o){var n={};return n.loopy=o,n.erase=function(e){if(n.loopy.mode==t.MODE_EDIT&&n.loopy.tool==t.TOOL_ERASE){if(Mouse.pressed||e){var i=o.model.getNodeByPoint(Mouse.x,Mouse.y);i&&i.kill()}if(Mouse.pressed||e){var a=o.model.getEdgeByPoint(Mouse.x,Mouse.y,!0);a&&a.kill()}if(Mouse.pressed||e){var r=o.model.getLabelByPoint(Mouse.x,Mouse.y);r&&r.kill()}if(Mouse.pressed||e){var s=o.model.getLoopMarkByPoint(Mouse.x,Mouse.y);s&&s.kill()}}},(0,e.subscribe)("mousemove",(function(){n.erase()})),(0,e.subscribe)("mouseclick",(function(){n.erase(!0)})),n},X=function(e){var o={};return o.loopy=e,o.tryMakingLabel=function(){if(o.loopy.mode==t.MODE_EDIT&&o.loopy.tool==t.TOOL_LABEL)if("Label"!=o.loopy.sidebar.currentPage.id){var n=e.model.addLabel({x:Mouse.x,y:Mouse.y+10,color:"#000000"});e.sidebar.edit(n)}else e.sidebar.showPage("Edit")},o},F=function(o){var n={};return n.loopy=o,n.active=!1,n.mouseXRef=0,n.mouseYRef=0,(0,e.subscribe)("mousedown",(function(){n.active=!0,n.mouseXRef=Mouse.x-o.offsetX,n.mouseYRef=Mouse.y-o.offsetY,o.initialCanvasX=o.offsetX,o.initialCanvasY=o.offsetY})),(0,e.subscribe)("mouseup",(function(){n.active=!1,o.initialCanvasX=o.offsetX,o.initialCanvasY=o.offsetY})),(0,e.subscribe)("mousemove",(function(){window.loopy.tool==t.TOOL_PAN&&n.active&&(o.offsetX=Mouse.x-n.mouseXRef,o.offsetY=Mouse.y-n.mouseYRef,(0,e.publish)("canvas/moved"))})),n},V=function(o){return(0,e.subscribe)("mouseup",(function(){o.mode==t.MODE_EDIT&&o.tool==t.TOOL_LOOP&&o.model.addLoopMark({x:Mouse.x,y:Mouse.y})})),this};function H(e){var t=this,o="<div class='play_button_icon' icon='"+e.icon+"'></div> <div class='play_button_label'>"+e.label+"</div>";t.dom=a(o,(function(){e.onclick()})),e.tooltip&&(t.dom.setAttribute("aria-label",e.tooltip),t.dom.setAttribute("data-balloon-pos","down"))}function z(e){var t=this;t.dom=document.createElement("div"),t.dom.classList.add("play_slider"),(o=new Image).src="assets/icons/speed_slow.png",o.width=20,o.height=15,t.dom.appendChild(o);var o,n=document.createElement("input");n.setAttribute("class","play_slider"),t.dom.appendChild(n),(o=new Image).src="assets/icons/speed_fast.png",o.width=20,o.height=15,t.dom.appendChild(o),n.type="range",n.value=e.value,n.step=e.step,n.min=e.min,n.max=e.max,n.oninput=function(t){e.oninput(n.value)}}const G=function(o){var i,a=k(document.getElementById("playbar"));return a.loopy=o,(0,e.subscribe)("key/enter",(function(){Key.control&&o.setMode(t.MODE_PLAY)})),(i=new E).addComponent(new H({icon:0,label:"Visualize Flow",tooltip:n?"⌘-Enter":"control-enter",onclick:function(){o.setMode(t.MODE_PLAY)}})).dom.style.backgroundColor="green",a.addPage("Editor",i),k.call(a,document.getElementById("playbar")),function(){var n,i=new E;o.embedded?((n=i.addComponent(new H({icon:2,label:"Reset",onclick:function(){(0,e.publish)("model/reset")}})).dom).style.backgroundColor="#d49b00",n.style.width="100px",n.style.left="0px",n.style.top="0px",(n=i.addComponent(new H({icon:3,label:"Remix",onclick:function(){var e=o.saveToURL();window.open(e,"_blank")}})).dom).style.width="100px",n.style.right="0px",n.style.top="0px"):((n=i.addComponent(new H({icon:1,label:"Stop",onclick:function(){o.setMode(t.MODE_EDIT)}})).dom).style.backgroundColor="red",(n=i.addComponent(new H({icon:2,label:"Reset",onclick:function(){(0,e.publish)("model/reset")}})).dom).style.backgroundColor="#d49b00"),i.addComponent(new z({value:o.signalSpeed,min:0,max:6,step:.2,oninput:function(e){o.signalSpeed=e}})).dom.style.bottom="0px",a.addPage("Player",i)}(),a};function W(e){var t=document.createElement("iframe");this.dom=t,t.width=e.width,t.height=e.height,e.manual||(e.page.onshow=function(){t.src=e.src},e.page.onhide=function(){t.removeAttribute("src")})}const q=function(){function e(e,t,o,n,i){this.g_w=e,this.g_h=t,this.square=o,this.tile=n,this.stroke=i}return e.prototype.getSvg=function(){return'<svg width="'+this.g_w*this.square*this.tile+'1" height="'+this.g_h*this.square*this.tile+'1" xmlns="http://www.w3.org/2000/svg"> \t\t\t\t<defs> \t\t\t\t\t\t<pattern id="smallGrid" width="'+this.g_w+'" height="'+this.g_h+'" patternUnits="userSpaceOnUse"> \t\t\t\t\t\t\t\t<path d="M '+this.g_w+" 0 L 0 0 0 "+this.g_h+'" fill="none" stroke="gray" stroke-width="'+this.stroke+'" /> \t\t\t\t\t\t</pattern> \t\t\t\t\t\t<pattern id="grid" width="'+this.g_w*this.square+'" height="'+this.g_h*this.square+'" patternUnits="userSpaceOnUse"> \t\t\t\t\t\t\t\t<rect width="'+this.g_w*this.square+'" height="'+this.g_h*this.square+'" fill="url(#smallGrid)" /> \t\t\t\t\t\t\t\t<path d="M '+this.g_w*this.square+" 0 L 0 0 0 "+this.g_h*this.square+'" fill="none" stroke="grey" stroke-width="'+2*this.stroke+'" /> \t\t\t\t\t\t</pattern> \t\t\t\t</defs> \t\t\t\t<rect width="100%" height="100%" fill="url(#grid)" /> \t\t</svg>'},e.prototype.getImg=function(){var e=window.URL||window.webkitURL,t=new Image,o=new Blob([this.getSvg()],{type:"image/svg+xml;charset=utf-8"}),n=e.createObjectURL(o);return t.src=n,t},e}();function J(t,o){var n=this;n._CLASS_="Label",n.loopy=t.loopy,n.model=t,n.config=o,h(n,o,{x:0,y:0,text:"...",color:"#000000"}),n.draw=function(e){var t=2*n.x,o=2*n.y;if(n.loopy.sidebar.currentPage.target==n){var i=n.getBounds();e.save(),e.scale(2,2),e.beginPath(),e.rect(i.x,i.y,i.width,i.height),e.fillStyle=HIGHLIGHT_COLOR,e.fill(),e.restore()}e.save(),e.translate(t,o),e.font="100 "+J.FONTSIZE+"px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillStyle=n.color,e.shadowColor="white",e.shadowBlur=7;var a=n.breakText();e.translate(0,-J.FONTSIZE*a.length/2);for(var r=0;r<a.length;r++){var s=a[r];e.fillText(s,0,0),e.translate(0,J.FONTSIZE)}e.restore()},n.kill=function(){t.removeLabel(n),(0,e.publish)("kill",[n])},n.breakText=function(){return n.text.split(/\n/)},n.getBounds=function(){for(var e=n.model.ctx,t=n.breakText(),o=0,i=0;i<t.length;i++){var a=t[i];o<(r=2*(e.measureText(a).width+10))&&(o=r)}var r=o,s=J.FONTSIZE*t.length/2;return{x:n.x-r/2,y:n.y-s/2-J.FONTSIZE/2,width:r,height:s+J.FONTSIZE/2}},n.isPointInLabel=function(e,t){return function(e,t,o){return!(e<o.x||e>o.x+o.width||t<o.y||t>o.y+o.height)}(e,t,n.getBounds())},n.getBoundingBox=function(){var e=n.getBounds();return{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height}}}function K(o,n){var i=this;i._CLASS_="Node",i.loopy=o.loopy,i.model=o,i.config=n,h(i,n,{id:K._getUID,x:0,y:0,init:K.defaultValue,label:"?",hue:n.color,radius:K.DEFAULT_RADIUS}),i.value=i.init,i.bound=function(){};var a=!1,r=0,s=0,l=!1,d=!1,u=(0,e.subscribe)("mousemove",(function(){i.loopy.mode==t.MODE_PLAY&&((l=i.isPointInNode(Mouse.x,Mouse.y))?(a=!0,i.loopy.showPlayTutorial=!1,s=Mouse.y<i.y?1:-1):(a=!1,s=0))})),c=(0,e.subscribe)("mousedown",(function(){if(i.loopy.mode==t.MODE_PLAY&&(l&&(d=!0),d)){var e=.33*s;i.value+=e,i.sendSignal({delta:e})}})),f=(0,e.subscribe)("mouseup",(function(){i.loopy.mode==t.MODE_PLAY&&(d=!1)})),m=(0,e.subscribe)("model/reset",(function(){i.value=i.init})),g=0;i.sendSignal=function(e){var t=i.model.getEdgesByStartNode(i);t=function(e,t){return e.splice(-t).concat(e)}(t,g),g=(g+1)%t.length;for(var o=0;o<t.length;o++)t[o].addSignal(e)},i.takeSignal=function(e){i.value+=e.delta,i.sendSignal(e),y-=e.delta/Math.abs(e.delta)*6};var b=0,y=0,v=0;i.update=function(e){var o=i.loopy.mode==t.MODE_PLAY;i.loopy.mode==t.MODE_EDIT&&(i.value=i.init),l&&Mouse.showCursor("pointer"),i.bound();var n=a||i.loopy.showPlayTutorial?1:0;r=.5*r+.5*n,(b+=y)>40&&(b=40),b<-40&&(b=-40),y+=v,y*=.3,v=.8*((o&&d?20*-s:0)-b)};var w=0;i.draw=function(e){var t=2*i.x,o=2*i.y,n=2*i.radius,a=i.hue;e.save(),e.translate(t,o+b),i.loopy.sidebar.currentPage.target==i&&(e.beginPath(),e.arc(0,0,n+40,0,Math.TAU,!1),e.fillStyle=HIGHLIGHT_COLOR,e.fill()),e.beginPath(),e.arc(0,0,n-2,0,Math.TAU,!1),e.fillStyle="#fff",e.fill(),e.lineWidth=6,e.strokeStyle=a,e.stroke();var l,d=Math.atan(5*i.value);d=(1+(d/=Math.PI/2))/2,i.value>=0&&i.value<=1?l=.1+.8*i.value:(i.value<0&&(l=1/(Math.abs(i.value)+1)*.1),i.value>1&&(l=1-1/i.value*.1)),e.beginPath(),w=.8*w+n*l*.2,e.arc(0,0,w,0,Math.TAU,!1),e.fillStyle=a,e.fill();var u=40;e.font="normal "+u+"px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillStyle="#000",e.shadowColor="white",e.shadowBlur=7;for(var c=e.measureText(i.label).width;c>2*n-30;)u-=1,e.font="normal "+u+"px sans-serif",c=e.measureText(i.label).width;e.fillText(i.label,0,0);var h=40,p=0;if(i.loopy.showPlayTutorial&&i.loopy.wobbleControls>0){var f=i.loopy.wobbleControls*(Math.TAU/30);p=10*Math.abs(Math.sin(f))}e.globalAlpha=r,e.strokeStyle="rgba(0,0,0,0.8)",e.beginPath(),e.moveTo(-40,-p-h),e.lineTo(0,-p-80),e.lineTo(h,-p-h),e.lineWidth=s>0?10:3,i.loopy.showPlayTutorial&&(e.lineWidth=6),e.stroke(),e.beginPath(),e.moveTo(-40,p+h),e.lineTo(0,p+80),e.lineTo(h,p+h),e.lineWidth=s<0?10:3,i.loopy.showPlayTutorial&&(e.lineWidth=6),e.stroke(),e.restore()},i.kill=function(){(0,e.unsubscribe)("mousemove",u),(0,e.unsubscribe)("mousedown",c),(0,e.unsubscribe)("mouseup",f),(0,e.unsubscribe)("model/reset",m),o.removeNode(i),(0,e.publish)("kill",[i])},i.isPointInNode=function(e,t,o){return o=o||0,p(e,t,i.x,i.y,i.radius+o)},i.getBoundingBox=function(){return{left:i.x-i.radius,top:i.y-i.radius,right:i.x+i.radius,bottom:i.y+i.radius}}}J.FONTSIZE=40,K.defaultValue=.5,K.defaultHue="#00EE00",K.DEFAULT_RADIUS=60,K._UID=0,K._getUID=function(){return K._UID++,K._UID};const j=function(){function e(e){this.raw_data=e}return e.prototype.deserializeAny=function(e,t,o){switch(this.raw_data=t,o.split(".").pop()){case"smwks":this.deserializeV1(e,t);break;case"loopy":this.deserializeVL(e,t);break;case"mdl":this.deserializeVV(e,t)}},e.prototype.stringify=function(e){var t=JSON.stringify(e);return(t=t.replace(/"/gi,"%22")).substr(0,t.length-1)+"%5D"},e.prototype.serializeV1=function(e){var t=[],o=[];e.nodes.forEach((function(e){o.push([e.id,Math.round(e.x),Math.round(e.y),e.init,encodeURIComponent(encodeURIComponent(e.label)),encodeURIComponent(encodeURIComponent(e.hue)),Math.round(e.radius)])})),t.push(o);var n=[];e.edges.forEach((function(e){n.push([e.from.id,e.to.id,Math.round(e.arc),e.strength,Math.round(e.rotation),e.thickness,encodeURIComponent(encodeURIComponent(e.color)),e.delay])})),t.push(n);var i=[];e.labels.forEach((function(e){i.push([Math.round(e.x),Math.round(e.y),encodeURIComponent(encodeURIComponent(e.text)),encodeURIComponent(encodeURIComponent(e.color))])})),t.push(i),t.push(e.nodeUID);var a=[];return e.loop_marks.forEach((function(e){a.push([Math.round(e.x),Math.round(e.y),e.clockwise,e.reinforcement,encodeURIComponent(encodeURIComponent(e.color))])})),t.push(a),this.stringify(t)},e.prototype.deserializeV1=function(e,t){e.clear();var o=JSON.parse(t),n=o[0],i=o[1],a=o[2],r=o[3],s=o[4];n.forEach((function(t){e.addNode({id:t[0],x:t[1],y:t[2],init:t[3],label:decodeURIComponent(t[4]),color:decodeURIComponent(t[5]),radius:t[6]})})),i.forEach((function(t){e.addEdge({from:t[0],to:t[1],arc:t[2],strength:t[3],rotation:0,thickness:t[5],color:decodeURIComponent(t[6]),delay:t[7]})})),a.forEach((function(t){e.addLabel({x:t[0],y:t[1],text:decodeURIComponent(t[2]),color:decodeURIComponent(t[3])})})),s.forEach((function(t){e.addLoopMark({x:t[0],y:t[1],clockwise:t[2],reinforcement:t[3],color:decodeURIComponent(t[4])})})),e.nodeUID=r},e.prototype.deserializeVL=function(e,t){e.clear(),alert("Auto importing loopy file");for(var o=JSON.parse(t),n=o[0],i=o[1],a=o[2],r=o[3],s=0;s<n.length;s++){var l=n[s];e.addNode({id:l[0],x:l[1],y:l[2],init:l[3],label:decodeURIComponent(l[4]),hue:v[l[5]]})}for(s=0;s<i.length;s++){var d=i[s],u={from:d[0],to:d[1],arc:d[2],strength:d[3]};e.addEdge(u)}for(s=0;s<a.length;s++){var c=a[s];e.addLabel({x:c[0],y:c[1],text:decodeURIComponent(c[2])})}e.nodeUID=r},e.prototype.deserializeVV=function(e,t){e.clear(),alert("Auto importing a Vensim model, some features are uncompatible and it is not officially suported. All views from the file will be collapsed.");for(var o=t.split("\n"),n=!1,i=0;i<o.length;i++){var a=o[i];if(n&&"$"!=a.charAt(0)){var r=a.split(",");"10"==r[0]?e.addNode({id:Number(r[1]),x:Number(r[3]),y:Number(r[4]),init:.5,label:r[2],color:"#666",radius:60}):"1"==r[0]&&e.addEdge({from:Number(r[2]),to:Number(r[3]),arc:100,strength:1,rotation:0,thickness:3,color:"#666",delay:0})}"*"==a.charAt(0)&&"*"!=a.charAt(1)&&(alert("Loading "+a.split("*")[1]),n=!0)}},e}(),Z=function(){function t(t){var o,n,i=this;this.speed=.05,this.canvas_dirty=!1,this.drawCountdownFull=60,this.drawCountdown=this.drawCountdownFull,this.nodes=[],this.nodeByID={},this.nodeUID=0,this.edges=[],this.labels=[],this.loop_marks=[],this.loopy=t,this.project=new j("[[],[],[],0,[]]"),this.canvas=(o=document.getElementById("canvasses"),n=document.createElement("canvas"),y(o,n),o.appendChild(n),(0,e.subscribe)("resize",(function(){y(o,n)})),n),this.ctx=this.canvas.getContext("2d"),this.grid=new q(50,50,4,5,2),this.grid_img=this.grid.getImg(),(0,e.subscribe)("mousemove",(function(){i.drawCountdown=i.drawCountdownFull})),(0,e.subscribe)("mousedown",(function(){i.drawCountdown=i.drawCountdownFull})),(0,e.subscribe)("model/changed",(function(){i.loopy.mode==$.Edit&&(i.drawCountdown=i.drawCountdownFull)})),(0,e.subscribe)("canvas/moved",(function(){i.drawCountdown=i.drawCountdownFull})),(0,e.subscribe)("resize",(function(){i.drawCountdown=i.drawCountdownFull})),(0,e.subscribe)("model/reset",(function(){i.drawCountdown=i.drawCountdownFull})),(0,e.subscribe)("loopy/mode",(function(){i.loopy.mode==$.Play?i.drawCountdown=2*i.drawCountdownFull:i.drawCountdown=i.drawCountdownFull})),(0,e.subscribe)("mouseclick",(function(){if(i.loopy.mode==$.Edit&&i.loopy.tool!=Q.Erase){var e=i.getNodeByPoint(i.loopy.mouseControl.x,i.loopy.mouseControl.y,2);if(e)return void i.loopy.sidebar.edit(e);var t=i.getLabelByPoint(i.loopy.mouseControl.x,i.loopy.mouseControl.y);if(t)return void i.loopy.sidebar.edit(t);var o=i.getEdgeByPoint(i.loopy.mouseControl.x,i.loopy.mouseControl.y);if(o)return void i.loopy.sidebar.edit(o);var n=i.getLoopMarkByPoint(i.loopy.mouseControl.x,i.loopy.mouseControl.y);if(n)return void i.loopy.sidebar.edit(n);if(i.loopy.tool==Q.Label)return void i.loopy.labeller.tryMakingLabel();i.loopy.sidebar.showPage("Edit")}}))}return t.prototype.getNode=function(e){return this.nodeByID[e]},t.prototype.addNode=function(t){(0,e.publish)("model/changed");var o=t;o.id||(o.id=this.getUID());var n=new K(this,t);return this.nodeByID[n.id]=n,this.nodes.push(n),this.update(),n},t.prototype.removeNode=function(t){(0,e.publish)("model/changed"),this.nodes.splice(this.nodes.indexOf(t),1),delete this.nodeByID[t.id];for(var o=0;o<this.edges.length;o++){var n=this.edges[o];n.to!=t&&n.from!=t||(n.kill(),o--)}},t.prototype.getUID=function(){return this.nodeUID++,this.nodeUID},t.prototype.addEdge=function(t){(0,e.publish)("model/changed");var o=new C(this,t);return this.edges.push(o),this.update(),o},t.prototype.removeEdge=function(t){(0,e.publish)("model/changed"),this.edges.splice(this.edges.indexOf(t),1)},t.prototype.getEdgesByStartNode=function(e){return this.edges.filter((function(t){return t.from==e}))},t.prototype.addLabel=function(t){(0,e.publish)("model/changed");var o=new J(this,t);return this.labels.push(o),this.update(),o},t.prototype.removeLabel=function(t){(0,e.publish)("model/changed"),this.labels.splice(this.labels.indexOf(t),1)},t.prototype.addLoopMark=function(t){(0,e.publish)("model/changed");var o=new x(this,t);return this.loop_marks.push(o),this.update(),o},t.prototype.removeLoopMark=function(t){(0,e.publish)("model/changed"),this.loop_marks.splice(this.loop_marks.indexOf(t),1)},t.prototype.update=function(){var e=this;this.edges.forEach((function(t){t.update(e.speed)})),this.nodes.forEach((function(t){t.update(e.speed)})),this.canvas_dirty=!0},t.prototype.draw=function(){var e=this;if(this.edges.forEach((function(t){t.signals.length>0&&(e.drawCountdown=e.drawCountdownFull)})),this.drawCountdown--,this.drawCountdown>0&&this.canvas_dirty){this.canvas_dirty=!1;var t=this.loopy,o=this.ctx;o.clearRect(0,0,this.canvas.width,this.canvas.height),o.save();var n=document.getElementById("canvasses"),i=n.clientWidth-g-g,a=n.clientHeight-b-g,r=2*t.offsetX,s=2*t.offsetY;r-=i+g,s-=a+g;var l=t.offsetScale;r*=l,s*=l,r+=i+g,s+=a+g,o.setTransform(l,0,0,l,r,s),o.drawImage(this.grid_img,0,0),this.labels.forEach((function(e){return e.draw(o)})),this.edges.forEach((function(e){return e.draw(o)})),this.nodes.forEach((function(e){return e.draw(o)})),this.loop_marks.forEach((function(e){return e.draw(o)})),o.restore()}},t.prototype.serialize=function(){return this.project.serializeV1(this)},t.prototype.deserialize=function(e,t){this.project.deserializeAny(this,e,t)},t.prototype.clear=function(){for(;this.nodes.length>0;)this.nodes[0].kill();for(;this.labels.length>0;)this.labels[0].kill();for(;this.loop_marks.length>0;)this.loop_marks[0].kill()},t.prototype.getNodeByPoint=function(e,t,o){for(var n=this.nodes.length-1;n>=0;n--){var i=this.nodes[n];if(i.isPointInNode(e,t,o))return i}return null},t.prototype.getEdgeByPoint=function(e,t){for(var o=this.edges.length-1;o>=0;o--){var n=this.edges[o];if(n.isPointOnLabel(e,t))return n}return null},t.prototype.getLabelByPoint=function(e,t){for(var o=this.labels.length-1;o>=0;o--){var n=this.labels[o];if(n.isPointInLabel(e,t))return n}return null},t.prototype.getLoopMarkByPoint=function(e,t){for(var o=this.loop_marks.length-1;o>=0;o--){var n=this.loop_marks[o];if(n.isPointInLoopMark(e,t))return n}return null},t.prototype.getBounds=function(){if(this.nodes.length>0||this.labels.length>0||this.loop_marks.length>0){var e=1/0,t=1/0,o=-1/0,n=-1/0,i=function(i){for(var a=0;a<i.length;a++){var r=i[a].getBoundingBox();e>r.left&&(e=r.left),t>r.top&&(t=r.top),o<r.right&&(o=r.right),n<r.bottom&&(n=r.bottom)}};return i(this.nodes),i(this.edges),i(this.labels),i(this.loop_marks),{left:e,top:t,right:o,bottom:n}}var a=document.getElementById("canvasses");return{left:0,top:0,right:a.clientWidth-g-g,bottom:a.clientHeight-b-g}},t.prototype.center=function(e){if(this.nodes.length>0||this.labels.length>0){var t=this.getBounds(),o=document.getElementById("canvasses"),n=o.clientWidth-g-g,i=o.clientHeight-b-g,a=(t.left+t.right)/2,r=(t.top+t.bottom)/2;if(this.loopy.offsetX=(g+n)/2-a,this.loopy.offsetY=(g+i)/2-r,e){var s,l=t.right-t.left,d=t.bottom-t.top;s=l/d>n/i?n/l:i/d,this.loopy.offsetScale=s}}},t}();var $,Q;!function(e){e[e.Edit=0]="Edit",e[e.Play=1]="Play"}($||($={})),function(e){e[e.Ink=0]="Ink",e[e.Drag=1]="Drag",e[e.Erase=2]="Erase",e[e.Label=3]="Label",e[e.Pan=4]="Pan",e[e.Loop=5]="Loop"}(Q||(Q={}));const ee=function(){function t(){var t,o,n=this;this.offsetX=0,this.offsetY=0,this.offsetScale=1,this.initialCanvasX=0,this.initialCanvasY=0,this.signalSpeed=3,this.mode=$.Edit,this.tool=Q.Drag,this.tools_locked=!1,this.dirty=!1,this.wobbleControls=-1,this._blankData="[[[4,243,337,0.33,%22Actions%22,%22%25230b72e0%22,46],[7,525,329,0.5,%22Results%22,%22%2523c507df%22,55],[9,819,325,0,%22Slowing%2520Action%22,%22%2523d51010%22,48]],[[7,9,141,1,0,7,%22%2523c72323%22,0],[7,4,-155,1,0,7,%22%25233450b7%22,0],[9,7,152,-1,0,3,%22%2523c72323%22,1],[4,7,-149,1,0,5,%22%25233450b7%22,0]],[[531,165,%22Limits%2520to%2520Growth%22,%22%2523000000%22]],9,[[679,330,1,0,%22%2523c72323%22],[382,332,0,1,%22%25233450b7%22]]%5D",this.mouseControl=M.init(this,document.getElementById("canvasses")),this.model=new Z(this),this.sidebar=((o=k(document.getElementById("sidebar"))).edit=function(e){o.showPage(e._CLASS_),o.currentPage.edit(e)},(0,e.subscribe)("kill",(function(e){o.currentPage.target==e&&o.showPage("Edit")})),(t=new T(o)).addComponent("label",new I({label:"Name:"})),t.addComponent("hue",new L({label:"Color:"})),t.addComponent("init",new S({bg:"initial",label:"Start Amount:",options:[0,.16,.33,.5,.66,.83,1],oninput:function(e){Node.defaultValue=e}})),t.onedit=function(){var e=t.target,o=e.hue;t.getComponent("init").setBGColor(o);var n=e.label;""!=n&&"?"!=n||t.getComponent("label").select()},t.addComponent(new A({label:"delete node",onclick:function(e){e.kill(),o.showPage("Edit")}})),o.addPage("Node",t),function(){var e=new T(o);e.addComponent("strength",new S({bg:"strength",label:"Relationship:",options:[1,-1],oninput:function(e){C.defaultStrength=e}})),e.addComponent("delay",new S({bg:"delay",label:"Delay: ",options:[0,1],oninput:function(e){C.defaultDelay=e}})),e.addComponent("color",new L({label:"Color: "})),e.addComponent("thickness",new S({bg:"initial",label:"Thickness:",options:[3,4,5,6,7,8,9],oninput:function(e){Node.defaultValue=e}})),e.onedit=function(){var t=e.target.color;e.getComponent("thickness").setBGColor(t)},e.addComponent(new A({label:"delete arrow",onclick:function(e){e.kill(),o.showPage("Edit")}})),o.addPage("Edge",e)}(),function(){var e=new T(o);e.addComponent("text",new I({label:"Label:",textarea:!0})),e.addComponent("color",new L({label:"Color:"})),e.onshow=function(){e.getComponent("text").select()},e.onhide=function(){var t=e.target;if(e.target){var o=t.text;/^\s*$/.test(o)&&(e.target=null,t.kill())}},e.addComponent(new A({label:"delete label",onclick:function(e){e.kill(),o.showPage("Edit")}})),o.addPage("Label",e)}(),function(){var e=new T(o);e.addComponent("clockwise",new S({bg:"delay",label:"Clockwise: ",options:[0,1],oninput:function(e){x.defaultOrientation=e}})),e.addComponent("reinforcement",new S({bg:"delay",label:"Reinforcement: ",options:[0,1],oninput:function(e){x.defaultOrientation=e}})),e.addComponent("color",new L({label:"Color: "})),o.addPage("LoopMark",e)}(),function(){var e=new T;e.addComponent(new P({html:"<b style='font-size:1.4em'>About ...</b> <br>Build: v1.4.1 - <strong>Alpha</strong><br>an advanced and free tool for thinking in systems<br><br><font size='3'><strong>License:</strong> GPLv3</font><hr/><br><div class='sidebar-buttons'><span class='mini_button' onclick='window.publish(\"modal\",[\"save_link\"])'>Save as Link</span><span class='mini_button' onclick='window.publish(\"export/file\")'>Save as File</span><span class='mini_button' onclick='window.publish(\"import/file\")'>Load from File</span><a class='mini_button' target='_blank' rel='noreferrer' href='https://juancsucoder.github.io/SystemicWorks/report'>Report a Bug</a><a class='mini_button' target='_blank' rel='noreferrer' href='https://github.com/JuanCSUCoder/SystemicWorks'>Source Code</a><a class='mini_button' target='_blank' rel='noreferrer' href='https://github.com/JuanCSUCoder/SystemicWorks/blob/main/LICENSE'>License</a></div><hr/><br><span>SystemicWorks</span> is made by <a target='_blank' rel='noreferrer' href='https://github.com/JuanCSUCoder'>JuanCSUCoder</a> based on the <a target='_blank' rel='noreferrer' href='https://ncase.me/loopy/'>LOOPY(v1.1)</a> project of <a target='_blank' rel='noreferrer' href='http://ncase.me'>nicky case</a> "})),o.addPage("Edit",e)}(),(0,e.subscribe)("key/save",(function(){Key.control&&(0,e.publish)("modal",["save_link"])})),o),this.toolbar=D(this),this.playbar=G(this),this.modal=function(t){var o,n=k(document.getElementById("modal_page"));return n.loopy=t,n.isShowing=!1,n.show=function(){document.getElementById("modal_container").setAttribute("show","yes"),n.isShowing=!0},n.hide=function(){document.getElementById("modal_container").setAttribute("show","no"),n.currentPage.onhide&&n.currentPage.onhide(),n.isShowing=!1},document.getElementById("modal_bg").onclick=n.hide,document.getElementById("modal_close").onclick=n.hide,(0,e.subscribe)("modal",(function(e){n.show();var t=n.showPage(e);t.onshow&&t.onshow();var o=document.getElementById("modal");o.style.width=n.currentPage.width+"px",o.style.height=n.currentPage.height+"px"})),(o=new E).width=670,o.height=570,o.addComponent(new W({page:o,src:"pages/examples/",width:640,height:520})).dom.style.background="#f7f7f7",n.addPage("examples",o),function(){var e=new E;e.width=530,e.height=430,e.addComponent(new W({page:e,src:"pages/howto.html",width:500,height:350}));var t=document.createElement("div");t.style.fontSize="18px",t.style.marginTop="6px",t.style.color="#777",t.innerHTML="need ideas for simulations? check out <span style='text-decoration:underline; cursor:pointer' onclick='publish(\"modal\",[\"examples\"])'>the examples!</span>",e.dom.appendChild(t),n.addPage("howto",e)}(),function(){var e=new E;e.width=690,e.height=550,e.addComponent(new W({page:e,src:"pages/credits/",width:660,height:500})),n.addPage("credits",e)}(),function(){var e=new E;e.width=500,e.height=155,e.addComponent(new P({html:"copy your link:"}));var o=e.addComponent(new O({})),i=document.createElement("div");i.style.textAlign="right",i.style.fontSize="15px",i.style.marginTop="6px",i.style.color="#888",i.innerHTML="(this is a long URL, so you may want to use a link-shortener like <a target='_blank' rel='noreferrer' href='https://bitly.com/'>bit.ly</a>)",e.dom.appendChild(i);var a=document.createElement("div");a.style.textAlign="right",a.style.fontSize="15px",a.style.marginTop="3px",a.style.color="#888",a.innerHTML="X out of 2048 characters",e.dom.appendChild(a),e.onshow=function(){var e=t.saveToURL();o.output(e),o.dom.select();var n=e.length+" / 2048 characters";e.length>2048&&(n+=" - MAY BE TOO LONG FOR MOST BROWSERS"),a.innerHTML=n,a.style.fontWeight=e.length>2048?"bold":"100",a.style.fontSize=e.length>2048?"14px":"15px"},n.addPage("save_link",e)}(),function(){var e,o=new E;o.width=700,o.height=500;var i=function(){var t='<iframe width="'+r.getValue()+'" height="'+l.getValue()+'" frameborder="0" src="'+e+'"></iframe>';u.output(t)},a=document.createElement("div");a.style.width="150px",a.style.height="440px",a.style.float="left",o.dom.appendChild(a),(d=document.createElement("div")).innerHTML="<br>PREVIEW &rarr;<br><br>",a.appendChild(d),(d=document.createElement("div")).style.fontSize="15px",d.innerHTML="what size do you want your embed to be?",a.appendChild(d);var r=s(i);a.appendChild(r.dom),(d=document.createElement("div")).style.display="inline-block",d.style.fontSize="15px",d.innerHTML="&nbsp;×&nbsp;",a.appendChild(d);var l=s(i);a.appendChild(l.dom),(d=document.createElement("div")).style.fontSize="15px",d.innerHTML="<br><br>copy this code into your website's html:",a.appendChild(d);var d,u=new O({});u.dom.style.fontSize="12px",a.appendChild(u.dom),(d=document.createElement("div")).style.fontSize="15px",d.style.textAlign="right",d.innerHTML="<br><br>(note: the REMIX button lets someone else, well, remix your model! don't worry, it'll just be a copy, it won't affect the original.)",a.appendChild(d);var c=o.addComponent(new W({page:o,manual:!0,src:"",width:500,height:440})).dom;c.style.float="right",o.onshow=function(){r.setValue(500),l.setValue(440),e=t.saveToURL(!0),c.src=e,i(),u.dom.select()},o.onhide=function(){c.removeAttribute("src")},n.addPage("embed",o)}(),n}(this),this.ink=N(this),this.drag=R(this),this.erase=Y(this),this.labeller=X(this),this.pan=F(this),this.loop=V(this),this.sidebar.showPage("Edit"),this.playbar.showPage("Editor"),(0,e.subscribe)("model/changed",(function(){n.dirty=!0})),(0,e.subscribe)("export/file",(function(){var e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+n.model.serialize()),e.setAttribute("download","system_model.smwks"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)})),(0,e.subscribe)("import/file",(function(){var e=document.createElement("input");e.type="file",e.onchange=function(e){var t=e.target,o=t.files[0],i=new FileReader;i.readAsText(o,"UTF-8"),i.onload=function(e){var o,i=null===(o=e.target)||void 0===o?void 0:o.result;n.model.deserialize(i,t.value)}},e.click()})),this.init=this.init.bind(this),this.update=this.update.bind(this),this.draw=this.draw.bind(this),this.setMode=this.setMode.bind(this),this.saveToURL=this.saveToURL.bind(this),setInterval(this.update,1e3/30),this.init(),this.dirty=!1,document.body.style.opacity="",requestAnimationFrame(this.draw)}return t.prototype.init=function(){var e=function(e){var t=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var o=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}("data");e||(e=decodeURIComponent(this._blankData)),this.model.deserialize(e,"default.smwks")},t.prototype.update=function(){this.mouseControl.update(),this.wobbleControls>=0&&this.wobbleControls--,this.modal.isShowing||this.model.update()},t.prototype.draw=function(){this.modal.isShowing||this.model.draw(),requestAnimationFrame(this.draw)},t.prototype.setMode=function(t){var o,n,i,a,r,s,l,d;this.mode=t,e.publish("loopy/mode"),t==$.Play?(this.toolbar.buttonsByID.drag.callback(),this.wobbleControls=45,this.sidebar.showPage("Edit"),this.playbar.showPage("Player"),null===(o=this.sidebar.dom)||void 0===o||o.setAttribute("mode","play"),null===(n=this.toolbar.dom)||void 0===n||n.setAttribute("mode","play"),null===(i=this.playbar.dom)||void 0===i||i.setAttribute("mode","play"),null===(a=document.getElementById("canvasses"))||void 0===a||a.removeAttribute("cursor")):e.publish("model/reset"),t==$.Edit&&(this.wobbleControls=-1,this.sidebar.showPage("Edit"),this.playbar.showPage("Editor"),null===(r=this.sidebar.dom)||void 0===r||r.setAttribute("mode","edit"),null===(s=this.toolbar.dom)||void 0===s||s.setAttribute("mode","edit"),null===(l=this.playbar.dom)||void 0===l||l.setAttribute("mode","edit"),null===(d=document.getElementById("canvasses"))||void 0===d||d.setAttribute("cursor",function(e){switch(e){case Q.Drag:return"drag";case Q.Erase:return"erase";case Q.Ink:return"ink";case Q.Label:return"label";case Q.Loop:return"loop";case Q.Pan:return"pan";default:return null}}(this.toolbar.currentTool)))},t.prototype.saveToURL=function(){var e=this.model.serialize(),t=window.location.origin+window.location.pathname+"?data="+e;return this.dirty=!1,window.history.replaceState(null,"",t),t},t}();window.subscribe=e.subscribe,window.publish=e.publish,window.onload=function(){window.loopy=new ee,document.getElementById("goto").addEventListener("click",(function(){w("assets/fs.css")}))}})()})();