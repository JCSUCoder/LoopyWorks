/*! For license information please see main.js.LICENSE.txt */
(()=>{var e={362:(e,t,o)=>{"use strict";var n=o(591),i={MODE_EDIT:0,MODE_PLAY:1,TOOL_INK:0,TOOL_DRAG:1,TOOL_ERASE:2,TOOL_LABEL:3,TOOL_PAN:4,TOOL_LOOP:5};Math.TAU=2*Math.PI,window.HIGHLIGHT_COLOR="rgba(193, 220, 255, 0.6)";var s=!!navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i);function a(e){var t=document.createElement("div");return t.innerHTML=e,t.setAttribute("class","component_label"),t}function l(e,t){var o=document.createElement("div");return o.innerHTML=e,o.onclick=t,o.setAttribute("class","component_button"),o}function r(e,t){var o=t?document.createElement("textarea"):document.createElement("input");return o.setAttribute("class",e),o.addEventListener("keydown",(function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),!1),o}function d(e){var t={};return t.dom=document.createElement("input"),t.dom.style.border="none",t.dom.style.width="40px",t.dom.style.padding="5px",t.dom.addEventListener("keydown",(function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),!1),t.dom.onchange=function(){var o=parseInt(t.getValue());isNaN(o)&&(o=0),t.setValue(o),e(o)},t.dom.onclick=function(){t.dom.select()},t.getValue=function(){return t.dom.value},t.setValue=function(e){t.dom.value=e},t}function c(e,t,o,n,i){var s=function(e){var o=a(e);t(o)},a=function(t){var n={};if(t.changedTouches){var i=function(e){var t=e.getBoundingClientRect();return{left:t.left,top:t.top}}(e);n.x=t.changedTouches[0].clientX-i.left,n.y=t.changedTouches[0].clientY-i.top,t.preventDefault()}else n.x=t.offsetX,n.y=t.offsetY;return o(n),n},l=function(e){n({})};e.addEventListener("mousedown",s),e.addEventListener("mousemove",a),e.addEventListener("wheel",(function(e){var t={};t.deltaY=e.deltaY,i(t)})),document.body.addEventListener("mouseup",l),e.addEventListener("touchstart",s,!1),e.addEventListener("touchmove",a,!1),document.body.addEventListener("touchend",l,!1)}function u(e){for(var t=1/0,o=1/0,n=-1/0,i=-1/0,s=0;s<e.length;s++){var a=e[s];a[0]<t&&(t=a[0]),n<a[0]&&(n=a[0]),a[1]<o&&(o=a[1]),i<a[1]&&(i=a[1])}return{left:t,right:n,top:o,bottom:i,width:n-t,height:i-o}}function h(e,t,o){e=JSON.parse(JSON.stringify(e));for(var n=0;n<e.length;n++){var i=e[n];i[0]+=t,i[1]+=o}return e}function f(e,t){e=JSON.parse(JSON.stringify(e));for(var o=0;o<e.length;o++){var n=e[o],i=n[0],s=n[1];n[0]=i*Math.cos(t)-s*Math.sin(t),n[1]=s*Math.cos(t)+i*Math.sin(t)}return e}function p(e,t){for(var o in t)e[o]=t[o]}function m(e,t,o,n,i){var s=o-e,a=n-t;return s*s+a*a<=i*i}function g(e,t,o){for(var n="#",i=0;i<3;i++){var s=e.substring(1+2*i,3+2*i),a=t.substring(1+2*i,3+2*i),l=parseInt(s,16),r=parseInt(a,16);n+=("0"+Math.floor(l*(1-o)+r*o).toString(16).toUpperCase()).slice(-2)}return n}document.querySelector(".page-head").ontransitionend=function(){(0,n.publish)("resize")},window.onresize=function(){(0,n.publish)("resize")},window.onbeforeunload=function(e){if(loopy.dirty){var t="Are you sure you want to leave without saving your changes?";return e.returnValue=t,t}};var b=25,y=110;function v(e,t){var o=e.clientWidth,n=e.clientHeight;t.width=2*o,t.height=2*n,t.style.width=o+"px",t.style.height=n+"px"}var w=["#EA3E3E","#EA9D51","#FEEE43","#BFEE3F","#7FD4FF","#A97FFF"];function k(e,t){for(var o,n=0;n<document.styleSheets.length;n++)document.styleSheets[n].href&&document.styleSheets[n].href.indexOf(e)>-1&&(o=document.styleSheets[n].ownerNode);if(null==t&&(t=!o),t){if(o)return t;var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=e,document.getElementsByTagName("head")[0].appendChild(i)}else o&&o.parentNode.removeChild(o);return t}function _(e){var t=[],o=!1;return e.forEach((function(e){if(e.includes(" ")){var n=function(e){for(var t=e.split(" "),o=["",""],n=0;n<Math.round(t.length/2);n++){var i=t[n];o[0]+=i+" "}for(n=Math.round(t.length/2);n<t.length;n++)i=t[n],o[1]+=i+" ";return o[0]=o[0].slice(0,-1),o[1]=o[1].slice(0,-1),o}(e);t.push(n[0]),t.push(n[1]),o=!0}else t.push(e)})),{paragraph:t,success:o}}function x(e,t,o){var n=0;return o.save(),o.font=t+"px sans-serif",e.forEach((function(e){var t=o.measureText(e).width;t>n&&(n=t)})),o.restore(),n}function M(e,t){return e*t}window.Mouse={},Mouse.x=0,Mouse.y=0,Mouse.showCursor=function(e){},Mouse.init=function(e,t){return c(t,(function(e){Mouse.moved=!1,Mouse.pressed=!0,Mouse.startedOnTarget=!0,(0,n.publish)("mousedown")}),(function(t){var o=document.getElementById("canvasses"),i=0,s=0,a=1/e.offsetScale,l=o.clientWidth-b-b,r=o.clientHeight-y-b;e.embedded&&(i-=12.5,s-=12.5),i-=(l+b)/2,s-=(r+b)/2,i*=a,s*=a,i+=(l+b)/2,s+=(r+b)/2,e.pan.active||(i-=e.offsetX,s-=e.offsetY);var d=t.x*a+i,c=t.y*a+s;Mouse.x=d,Mouse.y=c,Mouse.moved=!0,(0,n.publish)("mousemove")}),(function(){Mouse.pressed=!1,Mouse.startedOnTarget&&((0,n.publish)("mouseup"),Mouse.moved||(0,n.publish)("mouseclick")),Mouse.moved=!1,Mouse.startedOnTarget=!1}),(function(e){(0,n.publish)("wheel",[-.01*e.deltaY])})),Mouse.target=t,Mouse.showCursor=function(e){Mouse.target.style.cursor=e},Mouse.update=function(){Mouse.showCursor("")},Mouse};const E=Mouse;function C(e){var t={};return t.dom=e,t.pages=[],t.addPage=function(e,o){o.id=e,t.dom.appendChild(o.dom),t.pages.push(o)},t.currentPage={edit:()=>{}},t.showPage=function(e){for(var o={edit:()=>{}},n=0;n<t.pages.length;n++){var i=t.pages[n];i.id==e?(i.show(),o=i):i.hide()}return t.currentPage=o,o},t}function T(){var e=this;e.dom=document.createElement("div"),e.show=function(){e.dom.style.display="flex"},e.hide=function(){e.dom.style.display="none"},e.addComponent=function(t){return e.dom.appendChild(t.dom),t}}function I(e,t){var o=this;o._CLASS_="LoopMark",o.loopy=e.loopy,o.model=e,o.config=t,p(o,t),o.kill=function(){e.removeLoopMark(o),(0,n.publish)("kill",[o])},o.draw=function(e){var t,n=2*o.x,i=2*o.y;e.save(),e.translate(n,i),o.loopy.sidebar.currentPage.target==o&&(e.beginPath(),e.arc(0,0,60,0,Math.TAU,!1),e.fillStyle=HIGHLIGHT_COLOR,e.fill()),e.beginPath(),e.strokeStyle=o.color,e.lineWidth=6,o.clockwise?(e.arc(0,0,40,5*-Math.PI/4,2*Math.PI/5,!o.clockwise),t=2*Math.PI/5):(e.arc(0,0,40,1*Math.PI/4,7*-Math.PI/5,!o.clockwise),t=7*-Math.PI/5),e.stroke(),e.font="100 40px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillStyle=o.color,o.reinforcement?e.fillText("R",0,0):e.fillText("B",0,0),e.translate(20*Math.cos(t)*2,20*Math.sin(t)*2),o.clockwise?e.rotate(t+Math.PI):e.rotate(t),e.moveTo(6,6),e.lineTo(0,0),e.lineTo(-6,6),e.stroke(),e.restore()},o.isPointInLoopMark=function(e,t){var n=o.x-e,i=o.y-t;return Math.sqrt(n*n+i*i)<=20}}function S(e,t){var o=this;o._CLASS_="Edge",o.loopy=e.loopy,o.model=e,o.config=t,p(o,t),o.from=e.getNode(o.from),o.to=e.getNode(o.to),o.signals=[],o.signalSpeed=0,o.addSignal=function(e){if(!(S.allSignals.length>S.MAX_SIGNALS||o.signals.length>S.MAX_SIGNALS_PER_EDGE)){var t,n=e.delta;t=void 0===e.age?1e6:e.age-1;var i={delta:n,position:0,scaleX:Math.abs(n),scaleY:n,age:t};t<=0||(o.signals.unshift(i),S.allSignals.push(i))}},o.updateSignals=function(){var e=Math.pow(2,o.loopy.signalSpeed),t=1;o.delay>0&&(t=o.delay+1),o.signalSpeed=e/(680*t);for(var n=0;n<o.signals.length;n++){var i=o.signals[n];i.position,i.position+=o.signalSpeed}for(var s=o.signals[o.signals.length-1];s&&s.position>=1;)s.delta*=o.strength,o.to.takeSignal(s),o.removeSignal(s),s=o.signals[o.signals.length-1]},o.removeSignal=function(e){o.signals.splice(o.signals.indexOf(e),1),S.allSignals.splice(S.allSignals.indexOf(e),1)},o.drawSignals=function(e){for(var t=0;t<o.signals.length;t++){var n=o.signals[t],i=o.getPositionAlongArrow(n.position),s=i.x,a=i.y;e.save(),e.translate(s,a),e.rotate(-f),e.scale(n.scaleX,n.scaleY),e.scale(40,40);var l,r=g(o.from.color,o.to.color,l=n.position<.4?0:n.position<.6?(n.position-.4)/(.6-.4):1);if(o.strength<0){var d=Math.cos(l*Math.PI);e.scale(1,d)}2==n.age?e.globalAlpha=.5:1==n.age&&(e.globalAlpha=.25),e.beginPath(),e.moveTo(-2,0),e.lineTo(0,-2),e.lineTo(2,0),e.lineTo(1,0),e.lineTo(1,2),e.lineTo(-1,2),e.lineTo(-1,0),e.fillStyle=r,e.fill(),e.restore()}};var s,a,l,r,d,c,u,h,f,b,y,v,w,k,_,x,M,E,C,T,I,L,P,A,B,O,D,N,R,U,Y,X,z,H=(0,n.subscribe)("model/reset",(function(){o.signals=[],S.allSignals=[]}));o.labelX=0,o.labelY=0,o.update=function(e){if(0==o.arc&&(o.arc=.1),s=2*o.from.x,a=2*o.from.y,l=2*o.to.x,r=2*o.to.y,o.from==o.to){var t=o.rotation;t*=Math.TAU/360,l+=Math.cos(t),r+=Math.sin(t)}c=l-s,u=r-a,h=Math.sqrt(c*c+u*u),f=Math.atan2(u,c),b=Math.abs(2*o.arc),y=(d=b/2+h*h/(8*b))-b,v=Math.acos(h/2/d);let n=Math.tan(v),i=o.to.ry,p=o.to.rx,m=1/Math.sqrt(1/(i*i)+n*n/(p*p)),g=Math.sqrt(p*p-m*m*p*p/(i*i)),S=Math.abs(m),H=Math.abs(g),F=Math.sqrt(S*S+H*H);w=this.model.loopy.onlyText?0:25,k=2*(F+w)/d,_=2*(o.from.radius+w),x=_/d,M=v-Math.TAU/2,E=-v,b>d&&(M*=-1,E*=-1),o.arc>0?(C=y,T=M+x,I=E-k):(C=-y,T=-M-x,I=-E+k),L=20,P=h/2+Math.cos(I)*d,A=C+Math.sin(I)*d,B=I+Math.TAU/4;var V=h/4/d;z=o.arc>0?I-V:I+V,o.from==o.to&&(z-=Math.PI/2),Y=70,X=30,R=h/2+Math.cos(z)*d,U=C+Math.sin(z)*d;var G,W=o.strength;G=W>=3?"+++":W>=2?"++":W>=1?"+":0==W?"?":W>=-1?"–":W>=-2?"– –":"– – –",o.label=G;var q=o.getPositionAlongArrow(.5);O=q.x,D=q.y,o.labelX=(s+Math.cos(f)*O-Math.sin(f)*D)/2,o.labelY=(a+Math.sin(f)*O+Math.cos(f)*D)/2,N=36,o.arc<0&&(N*=-1),D+=N,o.updateSignals()},o.getArrowLength=function(){var e;return o.from==o.to?d*Math.TAU-2*o.from.radius:(e=y<0?o.arc<0?Math.TAU+T-I:Math.TAU+I-T:Math.abs(I-T),d*e)},o.getPositionAlongArrow=function(e){e=1.1*e-.05;var t=T;y<0&&(t>0?t-=Math.TAU:t+=Math.TAU);var o=t+(I-t)*e;return{x:h/2+Math.cos(o)*d,y:C+Math.sin(o)*d}},o.draw=function(e){e.lineWidth=o.thickness,e.strokeStyle=o.color,e.save(),e.translate(s,a),e.rotate(f),o.loopy.sidebar.currentPage.target==o&&(e.save(),e.translate(O,D),e.rotate(-f),e.beginPath(),e.arc(0,5,60,0,Math.TAU,!1),e.fillStyle=HIGHLIGHT_COLOR,e.fill(),e.restore()),e.beginPath(),o.arc>0?e.arc(h/2,C,d,M,I,!1):e.arc(h/2,C,d,-M,I,!0),e.save(),e.translate(P,A),o.arc<0&&e.scale(-1,-1),e.rotate(B),e.moveTo(-L,-L),e.lineTo(0,0),e.lineTo(-L,L),e.restore(),e.stroke(),o.delay>0&&(e.save(),e.translate(R,U),o.arc<0&&e.scale(-1,-1),e.rotate(z),e.moveTo(-Y/2,0),e.lineTo(Y/2,0),e.stroke(),e.moveTo(-Y/2,X),e.lineTo(Y/2,X),e.stroke(),e.restore()),e.font="100 60px sans-serif",e.textAlign="center",e.textBaseline="middle",e.save(),e.translate(O,D),e.rotate(-f),e.fillStyle=o.color,e.fillText(o.label,0,0),e.restore(),o.drawSignals(e),e.restore()},o.kill=function(){(0,n.unsubscribe)("model/reset",H),e.removeEdge(o),(0,n.publish)("kill",[o])},o.isPointOnLabel=function(e,t){var n;return n=o.loopy.tool==i.TOOL_DRAG||o.loopy.tool==i.TOOL_INK?40:o.loopy.tool==i.TOOL_ERASE?25:15,m(e,t,o.labelX,o.labelY,n)},o.getBoundingBox=function(){if(o.from==o.to){var e=f-Math.TAU/4,t=s+Math.cos(e)*-C,n=a+Math.sin(e)*-C,i=d/2;return{left:(t/=2)-i,top:(n/=2)-i,right:t+i,bottom:n+i}}var l={x:o.from.x,y:o.from.y},r={x:o.to.x,y:o.to.y},c={x:(l.x+r.x)/2,y:(l.y+r.y)/2};e=f-Math.TAU/4,c.x+=Math.cos(e)*o.arc,c.y+=Math.sin(e)*o.arc;for(var u=1/0,h=1/0,p=-1/0,m=-1/0,g=[l,r,c],b=0;b<g.length;b++){var y=g[b],v=y.x,w=y.y;u>v&&(u=v),h>w&&(h=w),p<v&&(p=v),m<w&&(m=w)}return{left:u,top:h,right:p,bottom:m}}}I.defaultOrientation=1,I.defaultType=1,I.defaultColor="#666666",S.allSignals=[],S.MAX_SIGNALS=100,S.MAX_SIGNALS_PER_EDGE=10,S.defaultStrength=1,S.defaultColor="#666666",S.defaultThickness=3,S.defaultDelay=0;function L(e){var t=this;t.target=null,t.dom=document.createElement("div"),t.show=function(){t.dom.style.display="block",t.onshow()},t.hide=function(){t.dom.style.display="none",t.onhide()};var o=t.dom;t.components=[],t.componentsByID={},t.addComponent=function(e,n){return n||(n=e,e=""),n.page=t,n.propName=e,o.appendChild(n.dom),t.components.push(n),t.componentsByID[e]=n,n},t.getComponent=function(e){return t.componentsByID[e]},t.edit=function(e){t.target=e;for(var o=0;o<t.components.length;o++)t.components[o].show();t.onedit()},e&&t.addComponent(new D({header:!0,label:"Go Back",onclick:function(){e.showPage("Edit")}})),(o=document.createElement("div")).classList.add("form_container"),t.dom.appendChild(o),t.onedit=function(){},t.onshow=function(){},t.onhide=function(){},t.hide()}function P(){var e=this;e.dom=null,e.page=null,e.propName=null,e.show=function(){},e.getValue=function(){return e.page.target[e.propName]},e.setValue=function(t){(0,n.publish)("model/changed"),e.page.target[e.propName]=t,e.page.onedit()}}function A(e){var t=this;P.apply(t),t.dom=document.createElement("div");var o=a(e.label),n=r(e.textarea?"component_textarea":"component_input",e.textarea);n.oninput=function(e){t.setValue(n.value)},t.dom.appendChild(o),t.dom.appendChild(n),t.show=function(){n.value=t.getValue()},t.select=function(){setTimeout((function(){n.select()}),10)}}function B(e){var t=this;P.apply(t),t.dom=document.createElement("div");var o=a(e.label),n=function(e){var t=document.createElement("input");return t.setAttribute("class","component_input"),t.setAttribute("type","color"),t.addEventListener("keydown",(function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),!1),t}();n.oninput=function(e){t.setValue(n.value)},t.dom.appendChild(o),t.dom.appendChild(n),t.show=function(){n.value=t.getValue()},t.select=function(){setTimeout((function(){n.select()}),10)}}function O(e){var t=this;P.apply(t),t.dom=document.createElement("div");var o=a(e.label);t.dom.appendChild(o);var n=document.createElement("div");n.setAttribute("class","component_slider"),t.dom.appendChild(n);var i=new Image;i.draggable=!1,i.src="assets/sliders/"+e.bg+".png",i.setAttribute("class","component_slider_graphic");var s=new Image;s.draggable=!1,s.src="assets/sliders/slider_pointer.png",s.setAttribute("class","component_slider_pointer"),n.appendChild(i),n.appendChild(s);var l=function(){var o=t.getValue(),n=(e.options.indexOf(o)+.5)*(250/e.options.length);s.style.left=n-7.5+"px"},r=!1,d=function(o){var n=o.x/250,i=Math.floor(n*e.options.length),s=e.options[i];void 0!==s&&(t.setValue(s),e.oninput&&e.oninput(s),l())};c(i,(function(e){r=!0,d(e)}),(function(e){r&&d(e)}),(function(){r=!1})),t.show=function(){l()},t.setBGColor=function(e){i.style.background=e}}function D(e){var t=this;P.apply(t),t.dom=document.createElement("div");var o=l(e.label,(function(){e.onclick(t.page.target)}));t.dom.appendChild(o),e.header&&o.setAttribute("header","yes")}function N(e){var t=this;P.apply(t),t.dom=document.createElement("div"),t.dom.innerHTML=e.html}function R(e){var t=this;P.apply(t),t.dom=r("component_output"),t.dom.setAttribute("readonly","true"),t.dom.onclick=function(){t.dom.select()},t.output=function(e){t.dom.value=e}}function U(e,t,o){var n=this;n.id=t.id,n.dom=document.createElement("div"),n.dom.setAttribute("class","toolbar_button"),n.dom.style.backgroundImage="url('"+t.icon+"')",n.dom.setAttribute("aria-label",t.tooltip),n.dom.setAttribute("data-balloon-pos","down-left"),n.select=function(){n.dom.setAttribute("selected","yes")},n.deselect=function(){n.dom.setAttribute("selected","no")},"lock"==t.id?n.callback=function(){t.callback(),o.locked?n.select():n.deselect()}:"fs"==t.id?n.callback=function(){t.callback()}:"clone"==t.id?n.callback=function(){t.callback(),o.clonning?n.select():n.deselect()}:"mode"==t.id?n.callback=function(){t.callback(),o.onlyText?n.select():n.deselect()}:t.id.startsWith("z")?n.callback=function(){t.callback()}:n.callback=function(){t.callback(),e.selectButton(n)},n.dom.onclick=n.callback}const Y=function(e){var t={},o=[];return t.buttonsByID={},t.dom=document.getElementById("toolbar"),t.addButton=function(i){var s=i.id,a=i.tooltip,l=i.callback,r=new U(t,{id:s,icon:"assets/nicons/"+s+".svg",tooltip:a,callback:l},e);t.dom.appendChild(r.dom),o.push(r),t.buttonsByID[s]=r,function(o){(0,n.subscribe)("key/"+o,(function(){e.ink.reset(),t.buttonsByID[o].callback()}))}(s)},t.addSeparator=function(){var e=document.createElement("div");e.setAttribute("class","toolbar_separator"),e.style.backgroundImage="url('assets/icons/separator.png')",t.dom.appendChild(e)},t.selectButton=function(t){for(var n=0;n<o.length;n++)o[n].deselect();e.locked&&this.buttonsByID.lock.select(),e.clonning&&this.buttonsByID.clone.select(),t.select()},t.currentTool="drag",t.setTool=function(o){t.currentTool=o;var n="TOOL_"+o.toUpperCase();e.tool=i[n],document.getElementById("canvasses").setAttribute("cursor",o)},t.addButton({id:"drag",tooltip:"MO(V)E",callback:function(){t.setTool("drag")}}),t.addSeparator(),t.addButton({id:"pan",tooltip:"(P)AN",callback:function(){t.setTool("pan")}}),t.addButton({id:"zout",tooltip:"ZOOM OUT",callback:function(){e.offsetScale*=.9,(0,n.publish)("canvas/moved")}}),t.addButton({id:"zin",tooltip:"ZOOM IN",callback:function(){e.offsetScale*=1.1,(0,n.publish)("canvas/moved")}}),t.addSeparator(),t.addButton({id:"ink",tooltip:"PE(N)CIL",callback:function(){t.setTool("ink")}}),t.addButton({id:"loop",tooltip:"(L)OOP",callback:function(){t.setTool("loop")}}),t.addButton({id:"label",tooltip:"(T)EXT",callback:function(){t.setTool("label")}}),t.addButton({id:"erase",tooltip:"(E)RASE",callback:function(){t.setTool("erase")}}),t.addSeparator(),t.addButton({id:"clone",tooltip:"Press to enable/disable clonning the previous element",callback:function(){e.clonning?e.clonning=!1:e.clonning=!0}}),t.addButton({id:"mode",tooltip:"Press to enable/disable 'Only Text' mode",callback:function(){e.onlyText?e.onlyText=!1:e.onlyText=!0,(0,n.publish)("model/changed")}}),t.addButton({id:"lock",tooltip:"Press to Lock/Unlock Edit Tools",callback:function(){e.locked?e.locked=!1:e.locked=!0}}),t.addSeparator(),t.addButton({id:"fs",tooltip:"Return to the Landing Page",callback:function(){k("assets/fs.css")}}),t.buttonsByID.clone.callback(),t.buttonsByID.lock.callback(),t.buttonsByID.drag.callback(),(0,n.subscribe)("model/changed",(function(){e.locked||t.buttonsByID.drag.callback()})),t};function X(e){var t={};t.loopy=e;var o=function(){var e=document.getElementById("canvasses"),t=document.createElement("canvas"),o=function(){var o=e.clientWidth,n=e.clientHeight;t.width=2*o,t.style.width=o+"px",t.height=2*n,t.style.height=n+"px"};return o(),e.appendChild(t),(0,n.subscribe)("resize",(function(){o()})),t}(),s=o.getContext("2d");return t.canvas=o,t.context=s,t.strokeData=[],t.drawInk=function(){if(Mouse.pressed){var o=t.strokeData[t.strokeData.length-1];s.strokeStyle="#ccc",s.lineWidth=5,s.lineCap="round";var n=document.getElementById("canvasses"),i=n.clientWidth-b-b,a=n.clientHeight-y-b,l=2*e.offsetX,r=2*e.offsetY;l-=i+b,r-=a+b;var d=e.offsetScale;l*=d,r*=d,l+=i+b,r+=a+b,e.embedded&&(l+=b,r+=b),s.setTransform(d,0,0,d,l,r),s.beginPath(),s.moveTo(2*o[0],2*o[1]),s.lineTo(2*Mouse.x,2*Mouse.y),s.stroke(),t.strokeData.push([Mouse.x,Mouse.y])}},t.reset=function(){let n=e.offsetScale,i=2*e.offsetX*n,a=2*e.offsetY*n,l=o.width/n,r=o.height/n,d=2*-e.offsetX,c=2*-e.offsetY;s.setTransform(n,0,0,n,i,a),window.debug_mode?(console.log("Ink Debug --------"),console.log("AX: "+d),console.log("AY: "+c),console.log("TX: "+i),console.log("TY: "+a),console.log("TW: "+l),console.log("TH: "+r),console.log("------------------"),s.fillStyle="rgba(0,0,0,0.5)",s.fillRect(d,c,l,r),setTimeout((()=>{s.clearRect(d,c,l,r)}),1e3)):s.clearRect(d,c,l,r),t.strokeData=[]},(0,n.subscribe)("mousedown",(function(){t.loopy.mode==i.MODE_EDIT&&t.loopy.tool==i.TOOL_INK&&(t.strokeData=[],t.strokeData.push([Mouse.x,Mouse.y]),t.drawInk())})),(0,n.subscribe)("mousemove",(function(){t.loopy.mode==i.MODE_EDIT&&t.loopy.tool==i.TOOL_INK&&t.drawInk()})),(0,n.subscribe)("mouseup",(function(){if(t.loopy.mode!=i.MODE_EDIT)return;if(t.loopy.tool!=i.TOOL_INK)return;if(t.strokeData.length<2)return;var o=t.strokeData[0],n=e.model.getNodeByPoint(o[0],o[1]);if(n||(n=e.model.getNodeByPoint(o[0],o[1],20)),!Mouse.moved&&n)return;var s=t.strokeData[t.strokeData.length-1],a=e.model.getNodeByPoint(s[0],s[1]);a||(a=e.model.getNodeByPoint(s[0],s[1],40));let l=e.model.getEdgeByPoint(o[0],o[1]),r=e.model.getLabelByPoint(o[0],o[1]),d=e.model.getLoopMarkByPoint(o[0],o[1]),c=Mouse.moved&&!(l||r||d)&&!n;if(n&&a){var p={from:n.id,to:a.id};if(n==a){var m=((k=u(t.strokeData)).left+k.right)/2,g=(k.top+k.bottom)/2,b=m-n.x,y=g-n.y,v=Math.atan2(y,b);if(k=u(f(h(t.strokeData,-n.x,-n.y),-v)),p.rotation=v*(360/Math.TAU)+90,p.arc=k.right,p.arc<n.radius)p=null,e.sidebar.edit(n);else{var w=n.radius+25;p.arc<w&&(p.arc=w)}}else{b=a.x-n.x,y=a.y-n.y,v=Math.atan2(y,b);var k=u(f(h(t.strokeData,-n.x,-n.y),-v));Math.abs(k.top)>Math.abs(k.bottom)?p.arc=-k.top:p.arc=-k.bottom}if(p){var _=e.model.addEdge(p);e.sidebar.edit(_)}}if(c){m=((k=u(t.strokeData)).left+k.right)/2,g=(k.top+k.bottom)/2;var x=k.width/2,M=k.height/2;if(x>20&&M>20){var E=e.model.addNode({x:m,y:g,w:x,h:M});!window.debug_mode&&e.sidebar.edit(E)}else E=e.model.addNode({x:m,y:g,w:40,h:20}),!window.debug_mode&&e.sidebar.edit(E)}t.reset()})),(0,n.subscribe)("mouseclick",(function(){t.loopy.mode==i.MODE_EDIT&&t.loopy.tool==i.TOOL_INK&&t.reset()})),t}X.MINIMUM_RADIUS=Node.DEFAULT_RADIUS,X.SNAP_TO_RADIUS=25;const z=X,H=function(e){var t={};return t.loopy=e,t.dragging=null,t.offsetX=0,t.offsetY=0,t.handling=null,(0,n.subscribe)("mousedown",(function(){if(t.loopy.mode==i.MODE_EDIT&&t.loopy.tool==i.TOOL_DRAG){var o=e.model.getLoopMarkByPoint(Mouse.x,Mouse.y);if(o)return t.dragging=o,t.offsetX=Mouse.x-o.x,t.offsetY=Mouse.y-o.y,void e.sidebar.edit(o);var n=e.model.getHandlerByPoint(Mouse.x,Mouse.y);if(n)return t.handling=n,t.offsetX=Mouse.x-n.w,t.offsetY=Mouse.y-n.h,void e.sidebar.edit(n);var s=e.model.getNodeByPoint(Mouse.x,Mouse.y);if(s)return t.dragging=s,t.offsetX=Mouse.x-s.x,t.offsetY=Mouse.y-s.y,void e.sidebar.edit(s);var a=e.model.getLabelByPoint(Mouse.x,Mouse.y);if(a)return t.dragging=a,t.offsetX=Mouse.x-a.x,t.offsetY=Mouse.y-a.y,void e.sidebar.edit(a);var l=e.model.getEdgeByPoint(Mouse.x,Mouse.y);return l?(t.dragging=l,t.offsetX=Mouse.x-l.labelX,t.offsetY=Mouse.y-l.labelY,void e.sidebar.edit(l)):void 0}})),(0,n.subscribe)("mousemove",(function(){if(t.loopy.mode==i.MODE_EDIT&&t.loopy.tool==i.TOOL_DRAG){if(t.handling){(0,n.publish)("model/changed");var o=t.handling;o.w=Math.abs(Mouse.x-t.offsetX),o.h=Math.abs(Mouse.y-t.offsetY),o.w<20&&(o.w=20),o.h<20&&(o.h=20),e.model.update()}if(t.dragging&&"Node"==t.dragging._CLASS_){(0,n.publish)("model/changed");var s=t.dragging;s.x=Mouse.x-t.offsetX,s.y=Mouse.y-t.offsetY,e.model.update()}if(t.dragging&&"Edge"==t.dragging._CLASS_){(0,n.publish)("model/changed");var a=t.dragging,l=Mouse.x-t.offsetX,r=Mouse.y-t.offsetY;if(a.from!=a.to){var d=a.from.x,c=a.from.y,u=a.to.x-d,p=a.to.y-c,m=Math.atan2(p,u),g=f(h([[l,r]],-d,-c),-m)[0];a.arc=-g[1]}else{u=l-a.from.x,p=r-a.from.y,m=Math.atan2(p,u);var b=Math.sqrt(u*u+p*p),y=a.from.radius+25;b<y&&(b=y),a.arc=b,a.rotation=m*(360/Math.TAU)+90}e.model.update()}if(t.dragging&&"Label"==t.dragging._CLASS_){(0,n.publish)("model/changed");var v=t.dragging;v.x=Mouse.x-t.offsetX,v.y=Mouse.y-t.offsetY,e.model.update()}if(t.dragging&&"LoopMark"==t.dragging._CLASS_){(0,n.publish)("model/changed");var w=t.dragging;w.x=Mouse.x-t.offsetX,w.y=Mouse.y-t.offsetY,e.model.update()}}})),(0,n.subscribe)("mouseup",(function(){t.loopy.mode==i.MODE_EDIT&&t.loopy.tool==i.TOOL_DRAG&&(t.dragging=null,t.handling=null,t.offsetX=0,t.offsetY=0)})),t},F=function(e){var t={};return t.loopy=e,t.erase=function(o){if(t.loopy.mode==i.MODE_EDIT&&t.loopy.tool==i.TOOL_ERASE){if(Mouse.pressed||o){var n=e.model.getNodeByPoint(Mouse.x,Mouse.y);n&&n.kill()}if(Mouse.pressed||o){var s=e.model.getEdgeByPoint(Mouse.x,Mouse.y,!0);s&&s.kill()}if(Mouse.pressed||o){var a=e.model.getLabelByPoint(Mouse.x,Mouse.y);a&&a.kill()}if(Mouse.pressed||o){var l=e.model.getLoopMarkByPoint(Mouse.x,Mouse.y);l&&l.kill()}}},(0,n.subscribe)("mousemove",(function(){t.erase()})),(0,n.subscribe)("mouseclick",(function(){t.erase(!0)})),t},V=function(e){var t={};return t.loopy=e,t.tryMakingLabel=function(){if(t.loopy.mode==i.MODE_EDIT&&t.loopy.tool==i.TOOL_LABEL){var o=e.model.addLabel({x:Mouse.x,y:Mouse.y+10,color:"#000000"});e.sidebar.edit(o)}},t},G=function(e){var t={};return t.loopy=e,t.active=!1,t.referenced=!1,t.mouseXRef=0,t.mouseYRef=0,(0,n.subscribe)("mousedown",(function(){window.loopy.tool==i.TOOL_PAN&&(t.active=!0,t.referenced=!1,e.initialCanvasX=e.offsetX,e.initialCanvasY=e.offsetY)})),(0,n.subscribe)("mouseup",(function(){window.loopy.tool==i.TOOL_PAN&&(t.active=!1,e.initialCanvasX=e.offsetX,e.initialCanvasY=e.offsetY)})),(0,n.subscribe)("mousemove",(function(){t.referenced||(t.mouseXRef=Mouse.x-e.offsetX,t.mouseYRef=Mouse.y-e.offsetY,t.referenced=!0),window.loopy.tool==i.TOOL_PAN&&t.active&&(e.offsetX=Mouse.x-t.mouseXRef,e.offsetY=Mouse.y-t.mouseYRef,(0,n.publish)("canvas/moved"))})),t},W=function(e){return(0,n.subscribe)("mouseup",(function(){e.mode==i.MODE_EDIT&&e.tool==i.TOOL_LOOP&&e.model.addLoopMark({x:Mouse.x,y:Mouse.y})})),this};function q(e){var t=this,o="<div class='play_button_icon' icon='"+e.icon+"'></div> <div class='play_button_label'>"+e.label+"</div>";t.dom=l(o,(function(){e.onclick()})),e.tooltip&&(t.dom.setAttribute("aria-label",e.tooltip),t.dom.setAttribute("data-balloon-pos","down"))}function K(e){var t=this;t.dom=document.createElement("div"),t.dom.classList.add("play_slider"),(o=new Image).src="assets/icons/speed_slow.png",o.width=20,o.height=15,t.dom.appendChild(o);var o,n=document.createElement("input");n.setAttribute("class","play_slider"),t.dom.appendChild(n),(o=new Image).src="assets/icons/speed_fast.png",o.width=20,o.height=15,t.dom.appendChild(o),n.type="range",n.value=e.value,n.step=e.step,n.min=e.min,n.max=e.max,n.oninput=function(t){e.oninput(n.value)}}const J=function(e){var t,o=C(document.getElementById("playbar"));return o.loopy=e,(0,n.subscribe)("key/enter",(function(){Key.control&&e.setMode(i.MODE_PLAY)})),(t=new T).addComponent(new q({icon:0,label:"Visualize Flow",tooltip:s?"⌘-Enter":"control-enter",onclick:function(){e.setMode(i.MODE_PLAY)}})).dom.style.backgroundColor="green",o.addPage("Editor",t),C.call(o,document.getElementById("playbar")),function(){var t,s=new T;e.embedded?((t=s.addComponent(new q({icon:2,label:"Reset",onclick:function(){(0,n.publish)("model/reset")}})).dom).style.backgroundColor="#d49b00",t.style.width="100px",t.style.left="0px",t.style.top="0px",(t=s.addComponent(new q({icon:3,label:"Remix",onclick:function(){var t=e.saveToURL();window.open(t,"_blank")}})).dom).style.width="100px",t.style.right="0px",t.style.top="0px"):((t=s.addComponent(new q({icon:1,label:"Stop",onclick:function(){e.setMode(i.MODE_EDIT)}})).dom).style.backgroundColor="red",(t=s.addComponent(new q({icon:2,label:"Reset",onclick:function(){(0,n.publish)("model/reset")}})).dom).style.backgroundColor="#d49b00"),s.addComponent(new K({value:e.signalSpeed,min:0,max:6,step:.2,oninput:function(t){e.signalSpeed=t}})).dom.style.bottom="0px",o.addPage("Player",s)}(),o};function j(e){var t=document.createElement("iframe");this.dom=t,t.width=e.width,t.height=e.height,e.manual||(e.page.onshow=function(){t.src=e.src},e.page.onhide=function(){t.removeAttribute("src")})}const Z=function(){function e(e,t,o,n,i){this.g_w=e,this.g_h=t,this.square=o,this.tile=n,this.stroke=i}return e.prototype.getSvg=function(){return'<svg width="'+this.g_w*this.square*this.tile+'1" height="'+this.g_h*this.square*this.tile+'1" xmlns="http://www.w3.org/2000/svg"> \t\t\t\t<defs> \t\t\t\t\t\t<pattern id="smallGrid" width="'+this.g_w+'" height="'+this.g_h+'" patternUnits="userSpaceOnUse"> \t\t\t\t\t\t\t\t<path d="M '+this.g_w+" 0 L 0 0 0 "+this.g_h+'" fill="none" stroke="gray" stroke-width="'+this.stroke+'" /> \t\t\t\t\t\t</pattern> \t\t\t\t\t\t<pattern id="grid" width="'+this.g_w*this.square+'" height="'+this.g_h*this.square+'" patternUnits="userSpaceOnUse"> \t\t\t\t\t\t\t\t<rect width="'+this.g_w*this.square+'" height="'+this.g_h*this.square+'" fill="url(#smallGrid)" /> \t\t\t\t\t\t\t\t<path d="M '+this.g_w*this.square+" 0 L 0 0 0 "+this.g_h*this.square+'" fill="none" stroke="grey" stroke-width="'+2*this.stroke+'" /> \t\t\t\t\t\t</pattern> \t\t\t\t</defs> \t\t\t\t<rect width="100%" height="100%" fill="url(#grid)" /> \t\t</svg>'},e.prototype.getImg=function(){var e=window.URL||window.webkitURL,t=new Image,o=new Blob([this.getSvg()],{type:"image/svg+xml;charset=utf-8"}),n=e.createObjectURL(o);return t.src=n,t},e}();function $(e,t){var o=this;o._CLASS_="Label",o.loopy=e.loopy,o.model=e,o.config=t,p(o,t),o.draw=function(e){var t=2*o.x,n=2*o.y;if(o.loopy.sidebar.currentPage.target==o){var i=o.getBounds();e.save(),e.scale(2,2),e.beginPath(),e.rect(i.x,i.y,i.width,i.height),e.fillStyle=HIGHLIGHT_COLOR,e.fill(),e.restore()}e.save(),e.translate(t,n),e.font="100 "+$.FONTSIZE+"px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillStyle=o.color,e.shadowColor="white",e.shadowBlur=7;var s=o.breakText();e.translate(0,-$.FONTSIZE*s.length/2);for(var a=0;a<s.length;a++){var l=s[a];e.fillText(l,0,0),e.translate(0,$.FONTSIZE)}e.restore()},o.kill=function(){e.removeLabel(o),(0,n.publish)("kill",[o])},o.breakText=function(){return o.text.split(/\n/)},o.getBounds=function(){for(var e=o.model.ctx,t=o.breakText(),n=0,i=0;i<t.length;i++){var s=t[i];n<(a=2*(e.measureText(s).width+10))&&(n=a)}var a=n,l=$.FONTSIZE*t.length/2;return{x:o.x-a/2,y:o.y-l/2-$.FONTSIZE/2,width:a,height:l+$.FONTSIZE/2}},o.isPointInLabel=function(e,t){return function(e,t,o){return!(e<o.x||e>o.x+o.width||t<o.y||t>o.y+o.height)}(e,t,o.getBounds())},o.getBoundingBox=function(){var e=o.getBounds();return{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height}}}$.FONTSIZE=40;const Q=function(){function e(e,t){var o=this;this._CLASS_="Node",this.id=t.id,this.model=e,this.x=t.x,this.y=t.y,this.init=t.init,this.label=t.label,this.color=t.color,this.w=t.w,this.h=t.h,this.rx=Math.sqrt(this.w*(this.w+this.h)),this.ry=this.rx*Math.sqrt(this.h/this.w),this.cb_rx=this.rx*this.init,this.cb_ry=this.ry*this.init,this.radius=Math.max(this.rx,this.ry),this.value=this.init,this.controls_visible=!1,this.controls_alpha=0,this.controls_direction=0,this.controls_selected=!1,this.controls_pressed=!1,this.handler_hovered=!1,this.offset=0,this.offset_goto=0,this.offset_velocity=0,this.offset_acceleration=0,this.offset_damping=.3,this.offset_hookes=.8,this.shift_index=0,this._listenerMouseMove=(0,n.subscribe)("mousemove",(function(){if(e.loopy.mode==ne.Play)o.controls_selected=o.isPointInNode(window.Mouse.x,window.Mouse.y,0),o.controls_selected?(o.controls_visible=!0,o.controls_direction=window.Mouse.y<o.y?1:-1):(o.controls_visible=!1,o.controls_direction=0);else{var t=o.x+o.w,n=o.y+o.h;m(Mouse.x,Mouse.y,t,n,6)?o.handler_hovered=!0:o.handler_hovered=!1}})),this._listenerMouseDown=(0,n.subscribe)("mousedown",(function(){if(e.loopy.mode==ne.Play&&(o.controls_selected&&(o.controls_pressed=!0),o.controls_pressed)){var t=.33*o.controls_direction;o.value+=t,o.sendSignal({delta:t})}})),this._listenerMouseUp=(0,n.subscribe)("mouseup",(function(){e.loopy.mode==ne.Play&&(o.controls_pressed=!1)})),this._listenerReset=(0,n.subscribe)("model/reset",(function(){o.value=o.init}))}return e.prototype.update=function(e){this.rx=Math.sqrt(this.w*(this.w+this.h)),this.ry=this.rx*Math.sqrt(this.h/this.w),this.radius=Math.max(this.rx,this.ry);var t=this.model.loopy.mode==ne.Play;this.model.loopy.mode==ne.Edit&&(this.value=this.init),this.controls_selected&&Mouse.showCursor("pointer");var o=this.controls_visible?1:0;this.controls_alpha=.5*this.controls_alpha+.5*o,t&&this.controls_pressed?this.offset_goto=20*-this.controls_direction:this.offset_goto=0,this.offset+=this.offset_velocity,this.offset=this.offset>40?40:this.offset,this.offset=this.offset<-40?-40:this.offset,this.offset_velocity+=this.offset_acceleration,this.offset_velocity*=this.offset_damping,this.offset_acceleration=(this.offset_goto-this.offset)*this.offset_hookes},e.prototype.draw=function(e){if(e.save(),e.translate(2*this.x,2*this.y),this.model.loopy.sidebar.currentPage.target==this&&(e.beginPath(),this.model.loopy.onlyText?e.rect(2*-this.w-10,2*-this.h-10,4*this.w+20,4*this.h+20):e.ellipse(0,0,2*(this.rx+10),2*(this.ry+10),0,0,2*Math.PI,!1),e.fillStyle=window.HIGHLIGHT_COLOR,e.fill()),this.model.loopy.onlyText)e.beginPath(),e.fillStyle="#fff",e.shadowColor="black",e.shadowBlur=7,e.rect(2*-this.w,2*-this.h,4*this.w,4*this.h),e.fill();else{e.beginPath(),e.lineWidth=6,e.strokeStyle=this.color,e.fillStyle="#fff",e.ellipse(0,0,2*this.rx,2*this.ry,0,0,2*Math.PI,!1),e.fill(),e.stroke();var t=.9*this.rx*Math.abs(this.value);this.cb_rx=.8*this.cb_rx+.2*t;var o=.9*this.ry*Math.abs(this.value);this.cb_ry=.8*this.cb_ry+.2*o,e.beginPath(),e.fillStyle=this.color,e.ellipse(0,0,2*this.cb_rx,2*this.cb_ry,0,0,2*Math.PI,!1),e.fill()}e.fillStyle="#000",e.textAlign="center",e.textBaseline="middle",e.shadowColor="white",e.shadowBlur=7,function(e,t,o){var n=[e],i=60;for(t.font=i+"px sans-serif";x(n,i,t)>o.width||M(n.length,i)>o.height;)if(M(n.length,i)<=o.height){var s=_(n);s.success?n=s.paragraph:(i--,t.font=i+"px sans-serif")}else i--,t.font=i+"px sans-serif";!function(e,t,o){var n=0,i=e.length*t;o.save(),o.textBaseline="top",o.translate(0,-i/2),o.font=t+"px sans-serif",e.forEach((function(e){o.fillText(e,0,n),n+=t})),o.restore()}(n,i,t)}(this.label,e,{width:4*this.w,height:4*this.h}),e.beginPath(),e.shadowColor="black",e.shadowBlur=0,e.strokeStyle="#000",e.fillStyle=this.handler_hovered?"#fff":"#999",e.arc(2*this.w,2*this.h,12,0,2*Math.PI),e.fill(),e.stroke();e.globalAlpha=this.controls_alpha,e.strokeStyle="rgba(0,0,0,0.8)",e.beginPath(),e.moveTo(-40,-40),e.lineTo(0,-80),e.lineTo(40,-40),e.lineWidth=this.controls_direction>0?10:3,e.stroke(),e.beginPath(),e.moveTo(-40,40),e.lineTo(0,80),e.lineTo(40,40),e.lineWidth=this.controls_direction<0?10:3,e.stroke(),e.restore()},e.prototype.sendSignal=function(e){var t,o,n=this.model.getEdgesByStartNode(this);t=n,o=this.shift_index,n=t.splice(-o).concat(t),this.shift_index=(this.shift_index+1)%n.length,n.forEach((function(t){t.addSignal(e)}))},e.prototype.takeSignal=function(e){this.value+=e.delta,this.sendSignal(e),this.offset_velocity-=e.delta/Math.abs(e.delta)*6},e.prototype.kill=function(){(0,n.unsubscribe)("mousemove",this._listenerMouseMove),(0,n.unsubscribe)("mousedown",this._listenerMouseDown),(0,n.unsubscribe)("mouseup",this._listenerMouseUp),(0,n.unsubscribe)("model/reset",this._listenerReset),this.model.removeNode(this),(0,n.publish)("kill",[this])},e.prototype.isPointInNode=function(e,t,o){if(this.model.loopy.onlyText){var n=this.getBoundingBox(),i=n.left<e&&e<n.right,s=n.top<t&&t<n.bottom;return i&&s}return Math.pow(e-this.x,2)/Math.pow(this.rx,2)+Math.pow(t-this.y,2)/Math.pow(this.ry,2)<=1},e.prototype.getBoundingBox=function(){return{left:this.x-this.w,top:this.y-this.h,right:this.x+this.w,bottom:this.y+this.h}},e}(),ee=function(){function e(e){this.raw_data=e}return e.prototype.deserializeAny=function(e,t,o){this.raw_data=t;var n=o.split(".").pop(),i=t.includes("'");switch(n){case"smwks":i?this.deserializeV2(e,t):(alert("You are importing an old SystemicWorks file, so it will be converted to the new format"),this.deserializeV1(e,t));break;case"loopy":alert("You are importing a Loopy file, so it will be converted to the .smwks format"),this.deserializeVL(e,t);break;case"mdl":this.deserializeVV(e,t)}},e.prototype.stringify=function(e){var t=JSON.stringify(e[0]);e.splice(0,1);var o=JSON.stringify(e);return t+"'"+(o=o.replace(/"/gi,"%22")).substr(0,o.length-1)+"%5D"},e.prototype.serialize=function(e){var t=[];t.push(e.loopy.version);var o=[];e.nodes.forEach((function(e){o.push([e.id,Math.round(e.x),Math.round(e.y),e.init,encodeURIComponent(encodeURIComponent(e.label)),encodeURIComponent(encodeURIComponent(e.color)),Math.round(e.w),Math.round(e.h)])})),t.push(o);var n=[];e.edges.forEach((function(e){n.push([e.from.id,e.to.id,Math.round(e.arc),e.strength,Math.round(e.rotation),e.thickness,encodeURIComponent(encodeURIComponent(e.color)),e.delay])})),t.push(n);var i=[];e.labels.forEach((function(e){i.push([Math.round(e.x),Math.round(e.y),encodeURIComponent(encodeURIComponent(e.text)),encodeURIComponent(encodeURIComponent(e.color))])})),t.push(i),t.push(e.nodeUID);var s=[];return e.loop_marks.forEach((function(e){s.push([Math.round(e.x),Math.round(e.y),e.clockwise,e.reinforcement,encodeURIComponent(encodeURIComponent(e.color))])})),t.push(s),this.stringify(t)},e.prototype.deserializeV1=function(e,t){e.clear();var o=JSON.parse(t),n=o[0],i=o[1],s=o[2],a=o[3],l=o[4];n.forEach((function(t){e.addNode({id:t[0],x:t[1],y:t[2],init:t[3],label:decodeURIComponent(t[4]),color:decodeURIComponent(t[5]),w:.6*t[6],h:.6*t[6]})})),i.forEach((function(t){e.addEdge({from:t[0],to:t[1],arc:t[2],strength:t[3],rotation:0,thickness:t[5],color:decodeURIComponent(t[6]),delay:t[7]})})),s.forEach((function(t){e.addLabel({x:t[0],y:t[1],text:decodeURIComponent(t[2]),color:decodeURIComponent(t[3])})})),l.forEach((function(t){e.addLoopMark({x:t[0],y:t[1],clockwise:t[2],reinforcement:t[3],color:decodeURIComponent(t[4])})})),e.nodeUID=a},e.prototype.deserializeV2=function(e,t){e.clear();var o=t.split("'");o[0],t=o[1];var n=JSON.parse(t),i=n[0],s=n[1],a=n[2],l=n[3],r=n[4];i.forEach((function(t){e.addNode({id:t[0],x:t[1],y:t[2],init:t[3],label:decodeURIComponent(t[4]),color:decodeURIComponent(t[5]),w:t[6],h:t[7]})})),s.forEach((function(t){e.addEdge({from:t[0],to:t[1],arc:t[2],strength:t[3],rotation:0,thickness:t[5],color:decodeURIComponent(t[6]),delay:t[7]})})),a.forEach((function(t){e.addLabel({x:t[0],y:t[1],text:decodeURIComponent(t[2]),color:decodeURIComponent(t[3])})})),r.forEach((function(t){e.addLoopMark({x:t[0],y:t[1],clockwise:t[2],reinforcement:t[3],color:decodeURIComponent(t[4])})})),e.nodeUID=l},e.prototype.deserializeVL=function(e,t){e.clear(),alert("Auto importing loopy file");for(var o=JSON.parse(t),n=o[0],i=o[1],s=o[2],a=o[3],l=0;l<n.length;l++){var r=n[l];e.addNode({id:r[0],x:r[1],y:r[2],init:r[3],label:decodeURIComponent(r[4]),color:w[r[5]],w:40,h:40})}for(l=0;l<i.length;l++){var d=i[l],c={from:d[0],to:d[1],arc:d[2],strength:d[3]};e.addEdge(c)}for(l=0;l<s.length;l++){var u=s[l];e.addLabel({x:u[0],y:u[1],text:decodeURIComponent(u[2])})}e.nodeUID=a},e.prototype.deserializeVV=function(e,t){e.clear(),alert("Auto importing a Vensim model, some features are uncompatible and it is not officially suported. All views from the file will be collapsed.");for(var o=t.split("\n"),n=!1,i=0;i<o.length;i++){var s=o[i];if(n&&"$"!=s.charAt(0)){var a=s.split(",");"10"==a[0]?e.addNode({id:Number(a[1]),x:Number(a[3]),y:Number(a[4]),init:.5,label:a[2],color:"#3284d1",w:Number(a[5]),h:Number(a[6])}):"1"==a[0]&&e.addEdge({from:Number(a[2]),to:Number(a[3]),arc:30,strength:1,rotation:0,thickness:3,color:"#666666",delay:0})}"*"==s.charAt(0)&&"*"!=s.charAt(1)&&(alert("Loading "+s.split("*")[1]),n=!0)}},e}();var te=function(){return(te=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var i in t=arguments[o])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};const oe=function(){function e(e){var t,o,i=this;this.speed=.05,this.canvas_dirty=!1,this.last_scale=1,this.drawCountdownFull=60,this.drawCountdown=this.drawCountdownFull,this.scale_ease=1,this.x_ease=0,this.y_ease=0,this.nodes=[],this.nodeByID={},this.nodeUID=0,this.edges=[],this.labels=[],this.loop_marks=[],this.loopy=e,this.project=new ee("[[],[],[],0,[]]"),this.canvas=(t=document.getElementById("canvasses"),o=document.createElement("canvas"),v(t,o),t.appendChild(o),(0,n.subscribe)("resize",(function(){v(t,o)})),o),this.ctx=this.canvas.getContext("2d"),this.last_scale=this.loopy.offsetScale,this.grid=new Z(30,30,5,2,1/this.loopy.offsetScale),this.grid_img=this.grid.getImg(),(0,n.subscribe)("mousemove",(function(){i.drawCountdown=i.drawCountdownFull})),(0,n.subscribe)("mousedown",(function(){i.drawCountdown=i.drawCountdownFull})),(0,n.subscribe)("model/changed",(function(){i.loopy.mode==ne.Edit&&(i.drawCountdown=i.drawCountdownFull)})),(0,n.subscribe)("canvas/moved",(function(){i.drawCountdown=i.drawCountdownFull})),(0,n.subscribe)("resize",(function(){i.drawCountdown=i.drawCountdownFull})),(0,n.subscribe)("model/reset",(function(){i.drawCountdown=i.drawCountdownFull})),(0,n.subscribe)("loopy/mode",(function(){i.loopy.mode==ne.Play?i.drawCountdown=2*i.drawCountdownFull:i.drawCountdown=i.drawCountdownFull})),(0,n.subscribe)("mouseclick",(function(){if(i.loopy.mode==ne.Edit&&i.loopy.tool!=ie.Erase){var e=i.getNodeByPoint(i.loopy.mouseControl.x,i.loopy.mouseControl.y,2);if(e)return void i.loopy.sidebar.edit(e);var t=i.getLabelByPoint(i.loopy.mouseControl.x,i.loopy.mouseControl.y);if(t)return void i.loopy.sidebar.edit(t);var o=i.getEdgeByPoint(i.loopy.mouseControl.x,i.loopy.mouseControl.y);if(o)return void i.loopy.sidebar.edit(o);var n=i.getLoopMarkByPoint(i.loopy.mouseControl.x,i.loopy.mouseControl.y);if(n)return void i.loopy.sidebar.edit(n);if(i.loopy.tool==ie.Label)return void i.loopy.labeller.tryMakingLabel();i.loopy.sidebar.showPage("Edit")}})),this.node_def={x:0,y:0,init:.5,color:"#00EE00",label:"?",radius:60},this.edge_def={arc:100,rotation:0,strength:1,thickness:3,color:"#666666",delay:0},this.label_def={x:0,y:0,text:"...",color:"#000000"},this.loopmark_def={x:0,y:0,clockwise:1,reinforcement:1,color:"#141414"},this.node_last={x:0,y:0,init:.5,color:"#00EE00",label:"?",radius:60},this.edge_last={arc:100,rotation:0,strength:1,thickness:3,color:"#666666",delay:0},this.label_last={x:0,y:0,text:"...",color:"#000000"},this.loopmark_last={x:0,y:0,clockwise:1,reinforcement:1,color:"#141414"}}return e.prototype.getNode=function(e){return this.nodeByID[e]},e.prototype.addNode=function(e){(0,n.publish)("model/changed");var t=e;t.id||(t.id=this.getUID()),t=this.loopy.clonning?te(te({},this.node_last),t):te(te({},this.node_def),t);var o=new Q(this,t);return this.nodeByID[o.id]=o,this.nodes.push(o),this.update(),o},e.prototype.removeNode=function(e){(0,n.publish)("model/changed"),this.nodes.splice(this.nodes.indexOf(e),1),delete this.nodeByID[e.id];for(var t=0;t<this.edges.length;t++){var o=this.edges[t];o.to!=e&&o.from!=e||(o.kill(),t--)}},e.prototype.getUID=function(){return this.nodeUID++,this.nodeUID},e.prototype.addEdge=function(e){(0,n.publish)("model/changed");var t=new S(this,e=this.loopy.clonning?te(te({},this.edge_last),e):te(te({},this.edge_def),e));return this.edges.push(t),this.update(),t},e.prototype.removeEdge=function(e){(0,n.publish)("model/changed"),this.edges.splice(this.edges.indexOf(e),1)},e.prototype.getEdgesByStartNode=function(e){return this.edges.filter((function(t){return t.from==e}))},e.prototype.addLabel=function(e){(0,n.publish)("model/changed");var t=new $(this,e=this.loopy.clonning?te(te({},this.label_last),e):te(te({},this.label_def),e));return this.labels.push(t),this.update(),t},e.prototype.removeLabel=function(e){(0,n.publish)("model/changed"),this.labels.splice(this.labels.indexOf(e),1)},e.prototype.addLoopMark=function(e){(0,n.publish)("model/changed");var t=new I(this,e=this.loopy.clonning?te(te({},this.loopmark_last),e):te(te({},this.loopmark_def),e));return this.loop_marks.push(t),this.update(),t},e.prototype.removeLoopMark=function(e){(0,n.publish)("model/changed"),this.loop_marks.splice(this.loop_marks.indexOf(e),1)},e.prototype.updateLasts=function(e){switch(e._CLASS_){case"Node":this.node_last={x:0,y:0,init:e.init,color:e.color,label:e.label,radius:e.radius};break;case"Edge":this.edge_last={arc:e.arc,rotation:e.rotation,strength:e.strength,thickness:e.thickness,color:e.color,delay:e.delay};break;case"Label":this.label_last={x:0,y:0,text:e.text,color:e.color};break;case"LoopMark":this.loopmark_last={x:0,y:0,clockwise:e.clockwise,reinforcement:e.reinforcement,color:e.color}}},e.prototype.update=function(){var e=this;this.edges.forEach((function(t){t.update(e.speed)})),this.nodes.forEach((function(t){t.update(e.speed)})),this.last_scale!=this.loopy.offsetScale&&(this.grid=new Z(30,30,5,2,1/this.loopy.offsetScale),this.grid_img=this.grid.getImg(),this.last_scale=this.loopy.offsetScale),this.canvas_dirty=!0},e.prototype.draw=function(){var e=this;if(this.edges.forEach((function(t){t.signals.length>0&&(e.drawCountdown=e.drawCountdownFull)})),this.drawCountdown--,this.drawCountdown>0&&this.canvas_dirty){this.canvas_dirty=!1;var t=this.loopy,o=this.ctx;o.clearRect(0,0,this.canvas.width,this.canvas.height),o.save(),this.scale_ease=.8*this.scale_ease+.2*t.offsetScale,this.x_ease=.8*this.x_ease+.2*t.offsetX,this.y_ease=.8*this.y_ease+.2*t.offsetY;var n=document.getElementById("canvasses"),i=n.clientWidth-b-b,s=n.clientHeight-y-b,a=2*this.x_ease,l=2*this.y_ease;a-=i+b,l-=s+b;var r=this.scale_ease;a*=r,l*=r,a+=i+b,l+=s+b,o.setTransform(r,0,0,r,a,l),o.drawImage(this.grid_img,0,0),this.labels.forEach((function(e){return e.draw(o)})),this.edges.forEach((function(e){return e.draw(o)})),this.nodes.forEach((function(e){return e.draw(o)})),this.loop_marks.forEach((function(e){return e.draw(o)})),o.restore()}},e.prototype.serialize=function(){return this.project.serialize(this)},e.prototype.deserialize=function(e,t){this.project.deserializeAny(this,e,t)},e.prototype.clear=function(){for(;this.nodes.length>0;)this.nodes[0].kill();for(;this.labels.length>0;)this.labels[0].kill();for(;this.loop_marks.length>0;)this.loop_marks[0].kill()},e.prototype.getNodeByPoint=function(e,t,o){for(var n=this.nodes.length-1;n>=0;n--){var i=this.nodes[n];if(i.isPointInNode(e,t,o))return i}return null},e.prototype.getHandlerByPoint=function(e,t){for(var o=this.nodes.length-1;o>=0;o--){var n=this.nodes[o];if(m(e,t,n.x+n.w,n.y+n.h,6))return n}},e.prototype.getEdgeByPoint=function(e,t){for(var o=this.edges.length-1;o>=0;o--){var n=this.edges[o];if(n.isPointOnLabel(e,t))return n}return null},e.prototype.getLabelByPoint=function(e,t){for(var o=this.labels.length-1;o>=0;o--){var n=this.labels[o];if(n.isPointInLabel(e,t))return n}return null},e.prototype.getLoopMarkByPoint=function(e,t){for(var o=this.loop_marks.length-1;o>=0;o--){var n=this.loop_marks[o];if(n.isPointInLoopMark(e,t))return n}return null},e.prototype.getBounds=function(){if(this.nodes.length>0||this.labels.length>0||this.loop_marks.length>0){var e=1/0,t=1/0,o=-1/0,n=-1/0,i=function(i){for(var s=0;s<i.length;s++){var a=i[s].getBoundingBox();e>a.left&&(e=a.left),t>a.top&&(t=a.top),o<a.right&&(o=a.right),n<a.bottom&&(n=a.bottom)}};return i(this.nodes),i(this.edges),i(this.labels),i(this.loop_marks),{left:e,top:t,right:o,bottom:n}}var s=document.getElementById("canvasses");return{left:0,top:0,right:s.clientWidth-b-b,bottom:s.clientHeight-y-b}},e.prototype.center=function(e){if(this.nodes.length>0||this.labels.length>0){var t=this.getBounds(),o=document.getElementById("canvasses"),n=o.clientWidth-b-b,i=o.clientHeight-y-b,s=(t.left+t.right)/2,a=(t.top+t.bottom)/2;if(this.loopy.offsetX=(b+n)/2-s,this.loopy.offsetY=(b+i)/2-a,e){var l,r=t.right-t.left,d=t.bottom-t.top;l=r/d>n/i?n/r:i/d,this.loopy.offsetScale=l}}},e}();var ne,ie;!function(e){e[e.Edit=0]="Edit",e[e.Play=1]="Play"}(ne||(ne={})),function(e){e[e.Ink=0]="Ink",e[e.Drag=1]="Drag",e[e.Erase=2]="Erase",e[e.Label=3]="Label",e[e.Pan=4]="Pan",e[e.Loop=5]="Loop"}(ie||(ie={}));const se=function(){function e(){var e=this;this.version=[2,0,0],this.offsetX=0,this.offsetY=0,this.offsetScale=1,this.initialCanvasX=0,this.initialCanvasY=0,this.signalSpeed=3,this.mode=ne.Edit,this.tool=ie.Drag,this.tools_locked=!1,this.clonning=!1,this.dirty=!1,this.wobbleControls=-1,this.onlyText=!1,this.temp_onlyText=!1,this._blankData="[2,0,0]'[[[4,73,250,0.33,%22Actions%22,%22%25230b72e0%22,31,20],[7,315,250,0.5,%22Results%22,%22%2523c507df%22,59,20],[9,554,250,0,%22Slowing%2520Action%22,%22%2523d51010%22,31,20]],[[7,9,120,1,0,7,%22%2523c72323%22,0],[7,4,130,1,0,7,%22%25233450b7%22,0],[9,7,114,-1,0,3,%22%2523c72323%22,1],[4,7,117,1,0,5,%22%25233450b7%22,0]],[[302,93,%22Limits%2520to%2520Growth%22,%22%2523000000%22]],9,[[433,250,1,0,%22%2523c72323%22],[172,250,1,1,%22%25233450b7%22]]%5D",this.mouseControl=E.init(this,document.getElementById("canvasses")),this.model=new oe(this),this.sidebar=function(e){var t,o=C(document.getElementById("sidebar"));return o.edit=function(t){e.model.updateLasts(t),o.showPage(t._CLASS_),o.currentPage.edit(t)},(0,n.subscribe)("kill",(function(e){o.currentPage.target==e&&o.showPage("Edit")})),(t=new L(o)).addComponent("label",new A({label:"Name:"})),t.addComponent("color",new B({label:"Color:"})),t.addComponent("init",new O({bg:"initial",label:"Start Amount:",options:[0,.16,.33,.5,.66,.83,1],oninput:function(e){Node.defaultValue=e}})),t.onedit=function(){var e=t.target,o=e.color;t.getComponent("init").setBGColor(o);var n=e.label;""!=n&&"?"!=n||t.getComponent("label").select()},t.addComponent(new D({label:"delete node",onclick:function(e){e.kill(),o.showPage("Edit")}})),o.addPage("Node",t),function(){var e=new L(o);e.addComponent("strength",new O({bg:"strength",label:"Relationship:",options:[1,-1],oninput:function(e){S.defaultStrength=e}})),e.addComponent("delay",new O({bg:"delay",label:"Delay: ",options:[0,1],oninput:function(e){S.defaultDelay=e}})),e.addComponent("color",new B({label:"Color: "})),e.addComponent("thickness",new O({bg:"initial",label:"Thickness:",options:[3,4,5,6,7,8,9],oninput:function(e){Node.defaultValue=e}})),e.onedit=function(){var t=e.target.color;e.getComponent("thickness").setBGColor(t)},e.addComponent(new D({label:"delete arrow",onclick:function(e){e.kill(),o.showPage("Edit")}})),o.addPage("Edge",e)}(),function(){var e=new L(o);e.addComponent("text",new A({label:"Label:",textarea:!0})),e.addComponent("color",new B({label:"Color:"})),e.onshow=function(){e.getComponent("text").select()},e.onhide=function(){var t=e.target;if(e.target){var o=t.text;/^\s*$/.test(o)&&(e.target=null,t.kill())}},e.addComponent(new D({label:"delete label",onclick:function(e){e.kill(),o.showPage("Edit")}})),o.addPage("Label",e)}(),function(){var e=new L(o);e.addComponent("clockwise",new O({bg:"delay",label:"Clockwise: ",options:[0,1],oninput:function(e){I.defaultOrientation=e}})),e.addComponent("reinforcement",new O({bg:"delay",label:"Reinforcement: ",options:[0,1],oninput:function(e){I.defaultOrientation=e}})),e.addComponent("color",new B({label:"Color: "})),o.addPage("LoopMark",e)}(),function(){var e=new L;e.addComponent(new N({html:"<b style='font-size:1.4em'>About ...</b> <br>Build: v2.3.1<br>an advanced and free tool for thinking in systems<br><br><font size='3'><strong>License:</strong> GPLv3</font><hr/><br><div class='sidebar-buttons'><span class='mini_button' onclick='window.publish(\"modal\",[\"save_link\"])'>Save as Link</span><span class='mini_button' onclick='window.publish(\"export/file\")'>Save as File</span><span class='mini_button' onclick='window.publish(\"import/file\")'>Load from File</span><a class='mini_button' target='_blank' rel='noreferrer' href='https://juancsucoder.github.io/SystemicWorks/report'>Report a Bug</a><a class='mini_button' target='_blank' rel='noreferrer' href='https://github.com/JuanCSUCoder/SystemicWorks'>Source Code</a><a class='mini_button' target='_blank' rel='noreferrer' href='https://github.com/JuanCSUCoder/SystemicWorks/blob/main/LICENSE'>License</a></div><hr/><br><span>SystemicWorks</span> is made by <a target='_blank' rel='noreferrer' href='https://github.com/JuanCSUCoder'>JuanCSUCoder</a> based on the <a target='_blank' rel='noreferrer' href='https://ncase.me/loopy/'>LOOPY(v1.1)</a> project of <a target='_blank' rel='noreferrer' href='http://ncase.me'>nicky case</a> <br> <br><hr /> <br> <label for='debug_toggle' style='font-size: 1.5rem'>Debug Mode </label> <input type='checkbox' id='debug_toggle' name='debug_toggle'/> <br><br> <div id='debug_logs' style='display:none;'></div>"})),o.addPage("Edit",e)}(),(0,n.subscribe)("key/save",(function(){Key.control&&(0,n.publish)("modal",["save_link"])})),o}(this),this.toolbar=Y(this),this.playbar=J(this),this.modal=function(e){var t,o=C(document.getElementById("modal_page"));return o.loopy=e,o.isShowing=!1,o.show=function(){document.getElementById("modal_container").setAttribute("show","yes"),o.isShowing=!0},o.hide=function(){document.getElementById("modal_container").setAttribute("show","no"),o.currentPage.onhide&&o.currentPage.onhide(),o.isShowing=!1},document.getElementById("modal_bg").onclick=o.hide,document.getElementById("modal_close").onclick=o.hide,(0,n.subscribe)("modal",(function(e){o.show();var t=o.showPage(e);t.onshow&&t.onshow();var n=document.getElementById("modal");n.style.width=o.currentPage.width+"px",n.style.height=o.currentPage.height+"px"})),(t=new T).width=670,t.height=570,t.addComponent(new j({page:t,src:"pages/examples/",width:640,height:520})).dom.style.background="#f7f7f7",o.addPage("examples",t),function(){var e=new T;e.width=530,e.height=430,e.addComponent(new j({page:e,src:"pages/howto.html",width:500,height:350}));var t=document.createElement("div");t.style.fontSize="18px",t.style.marginTop="6px",t.style.color="#777",t.innerHTML="need ideas for simulations? check out <span style='text-decoration:underline; cursor:pointer' onclick='publish(\"modal\",[\"examples\"])'>the examples!</span>",e.dom.appendChild(t),o.addPage("howto",e)}(),function(){var e=new T;e.width=690,e.height=550,e.addComponent(new j({page:e,src:"pages/credits/",width:660,height:500})),o.addPage("credits",e)}(),function(){var t=new T;t.width=500,t.height=155,t.addComponent(new N({html:"Copy your link:"}));var n=t.addComponent(new R({})),i=document.createElement("div");i.style.textAlign="right",i.style.fontSize="15px",i.style.marginTop="6px",i.style.color="#888",i.innerHTML="(this is a long URL, so you may want to use a link-shortener like <a target='_blank' rel='noreferrer' href='https://bitly.com/'>bit.ly</a>)",t.dom.appendChild(i);var s=document.createElement("div");s.style.textAlign="right",s.style.fontSize="15px",s.style.marginTop="3px",s.style.color="#888",s.innerHTML="X out of 2048 characters",t.dom.appendChild(s),t.onshow=function(){var t=e.saveToURL();n.output(t),n.dom.select();var o=t.length+" / 2048 characters";t.length>2048&&(o+=" - MAY BE TOO LONG FOR MOST BROWSERS"),s.innerHTML=o,s.style.fontWeight=t.length>2048?"bold":"100",s.style.fontSize=t.length>2048?"14px":"15px"},o.addPage("save_link",t)}(),function(){var t,n=new T;n.width=700,n.height=500;var i=function(){var e='<iframe width="'+a.getValue()+'" height="'+l.getValue()+'" frameborder="0" src="'+t+'"></iframe>';c.output(e)},s=document.createElement("div");s.style.width="150px",s.style.height="440px",s.style.float="left",n.dom.appendChild(s),(r=document.createElement("div")).innerHTML="<br>PREVIEW &rarr;<br><br>",s.appendChild(r),(r=document.createElement("div")).style.fontSize="15px",r.innerHTML="what size do you want your embed to be?",s.appendChild(r);var a=d(i);s.appendChild(a.dom),(r=document.createElement("div")).style.display="inline-block",r.style.fontSize="15px",r.innerHTML="&nbsp;×&nbsp;",s.appendChild(r);var l=d(i);s.appendChild(l.dom),(r=document.createElement("div")).style.fontSize="15px",r.innerHTML="<br><br>copy this code into your website's html:",s.appendChild(r);var r,c=new R({});c.dom.style.fontSize="12px",s.appendChild(c.dom),(r=document.createElement("div")).style.fontSize="15px",r.style.textAlign="right",r.innerHTML="<br><br>(note: the REMIX button lets someone else, well, remix your model! don't worry, it'll just be a copy, it won't affect the original.)",s.appendChild(r);var u=n.addComponent(new j({page:n,manual:!0,src:"",width:500,height:440})).dom;u.style.float="right",n.onshow=function(){a.setValue(500),l.setValue(440),t=e.saveToURL(!0),u.src=t,i(),c.dom.select()},n.onhide=function(){u.removeAttribute("src")},o.addPage("embed",n)}(),o}(this),this.ink=z(this),this.drag=H(this),this.erase=F(this),this.labeller=V(this),this.pan=G(this),this.loop=W(this),this.sidebar.showPage("Edit"),this.playbar.showPage("Editor"),(0,n.subscribe)("model/changed",(function(){e.dirty=!0})),(0,n.subscribe)("export/file",(function(){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+e.model.serialize()),t.setAttribute("download","system_model.smwks"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)})),(0,n.subscribe)("import/file",(function(){var t=document.createElement("input");t.type="file",t.onchange=function(t){var o=t.target,n=o.files[0],i=new FileReader;i.readAsText(n,"UTF-8"),i.onload=function(t){var n,i=null===(n=t.target)||void 0===n?void 0:n.result;e.model.deserialize(i,o.value)}},t.click()})),(0,n.subscribe)("file/loaded",(function(t){e.model.deserialize(t,"default.smwks")})),(0,n.subscribe)("wheel",(function(t){if(window.Key.alt||window.Key.shift||window.Key.control)window.Key.alt?(e.offsetY+=40*t,(0,n.publish)("canvas/moved")):(e.offsetX+=40*t,(0,n.publish)("canvas/moved"));else if(t>0)for(var o=0;o<t;o++)e.offsetScale*=1.1,(0,n.publish)("canvas/moved");else for(o=0;o<Math.abs(t);o++)e.offsetScale*=.9,(0,n.publish)("canvas/moved")})),this.init=this.init.bind(this),this.update=this.update.bind(this),this.draw=this.draw.bind(this),this.setMode=this.setMode.bind(this),this.saveToURL=this.saveToURL.bind(this),setInterval(this.update,1e3/30),this.init(),this.dirty=!1,document.body.style.opacity="",requestAnimationFrame(this.draw)}return e.prototype.init=function(){var e,t=("data",e=window.location.search,new URLSearchParams(e).get("data"));t||(t=decodeURIComponent(this._blankData)),this.model.deserialize(t,"default.smwks")},e.prototype.update=function(){this.mouseControl.update(),this.wobbleControls>=0&&this.wobbleControls--,this.modal.isShowing||this.model.update(),this.offsetScale=Math.min(Math.max(.125,this.offsetScale),4)},e.prototype.draw=function(){this.modal.isShowing||this.model.draw(),requestAnimationFrame(this.draw)},e.prototype.setMode=function(e){var t,o,i,s,a,l,r,d;this.mode=e,n.publish("loopy/mode"),e==ne.Play?(this.temp_onlyText=this.onlyText,this.temp_onlyText&&this.toolbar.buttonsByID.mode.callback(),this.toolbar.buttonsByID.pan.callback(),this.wobbleControls=45,this.sidebar.showPage("Edit"),this.playbar.showPage("Player"),null===(t=this.sidebar.dom)||void 0===t||t.setAttribute("mode","play"),null===(o=this.toolbar.dom)||void 0===o||o.setAttribute("mode","play"),null===(i=this.playbar.dom)||void 0===i||i.setAttribute("mode","play"),null===(s=document.getElementById("canvasses"))||void 0===s||s.removeAttribute("cursor")):n.publish("model/reset"),e==ne.Edit&&(this.wobbleControls=-1,this.onlyText!=this.temp_onlyText&&this.toolbar.buttonsByID.mode.callback(),this.sidebar.showPage("Edit"),this.playbar.showPage("Editor"),null===(a=this.sidebar.dom)||void 0===a||a.setAttribute("mode","edit"),null===(l=this.toolbar.dom)||void 0===l||l.setAttribute("mode","edit"),null===(r=this.playbar.dom)||void 0===r||r.setAttribute("mode","edit"),null===(d=document.getElementById("canvasses"))||void 0===d||d.setAttribute("cursor",function(e){switch(e){case ie.Drag:return"drag";case ie.Erase:return"erase";case ie.Ink:return"ink";case ie.Label:return"label";case ie.Loop:return"loop";case ie.Pan:return"pan";default:return null}}(this.toolbar.currentTool)))},e.prototype.saveToURL=function(){var e=this.model.serialize(),t=window.location.origin+window.location.pathname+"?data="+e;return this.dirty=!1,window.history.replaceState(null,"",t),t},e}(),ae=function(e,t){var o=this;e.Key={},this.key_codes={Enter:"enter",Alt:"alt",Shift:"shift",Control:"control",n:"ink",v:"drag",e:"erase",t:"label",s:"save",p:"pan",l:"loop"},e.addEventListener("keydown",(function(i){if(!(t&&t.modal&&t.modal.isShowing)){window.debug_mode&&console.log(i.key);var s=o.key_codes[i.key];e.Key[s]=!0,(0,n.publish)("key/"+s)}}),!1),e.addEventListener("keyup",(function(n){if(!(t&&t.modal&&t.modal.isShowing)){var i=o.key_codes[n.key];e.Key[i]=!1,n.stopPropagation(),n.preventDefault()}}),!1)};window.subscribe=n.subscribe,window.publish=n.publish,window.onload=function(){if(window.matchMedia("(display-mode: standalone)").matches){k("assets/transitions.css",!1),k("assets/fs.css",!0);var e=document.querySelector(".page-head");e.parentElement.removeChild(e)}else k("assets/transitions.css",!0);window.loopy=new se,document.getElementById("goto").addEventListener("click",(function(){k("assets/fs.css")}));var t=document.getElementById("sidebar"),o=document.getElementById("canvasses"),i=document.getElementById("hide-button"),s=document.getElementById("unhide-button");i.addEventListener("click",(function(){t.style.display="none",o.style.height="100%",(0,n.publish)("resize"),s.style.display="flex"})),s.addEventListener("click",(function(){t.style.display="block",o.style.removeProperty("height"),(0,n.publish)("resize"),s.style.display="none"})),new ae(window,window.loopy);var a,l=document.getElementById("install_button");window.addEventListener("beforeinstallprompt",(function(e){l.style.display="flex",e.preventDefault(),a=e})),window.promptPWA=function(){try{a.prompt(),a.userChoice.then((function(e){"accepted"===e.outcome&&k("assets/fs.css",!0),a=null}))}catch(e){l.innerText="Something failed. Check if it is already installed or add it manually to the home screen",l.style.display="flex",l.style.backgroundColor="yellow",l.style.color="black",l.style.pointerEvents="none",l.style.cursor="default"}},document.getElementsByTagName("body")[0].style.display="block",document.querySelectorAll("canvas").forEach((function(e){v(o,e)})),window.debug_mode=!1;var r=document.getElementById("debug_logs"),d=document.getElementById("debug_toggle");console.stdlog=console.log.bind(console),console.logs=[],console.log=function(){console.logs.push(Array.from(arguments)),console.stdlog.apply(console,arguments),(0,n.publish)("logs/update")},(0,n.subscribe)("logs/update",(function(){var e=document.createElement("p");e.appendChild(document.createTextNode(console.logs[console.logs.length-1]+"\n")),r.appendChild(e)})),setInterval((function(){r.scrollTop=r.scrollHeight}),100),d.addEventListener("change",(function(e){window.debug_mode=e.currentTarget.checked,window.debug_mode&&"ACTIVATE"!=prompt("You are activating DEBUG MODE. Don't use this feature unless you know what you are doing. Write ACTIVATE to confirm this action")&&(window.debug_mode=!1,e.currentTarget.checked=!1),r.style.display=window.debug_mode?"block":"none"})),(0,n.subscribe)("resize",(function(){window.debug_mode&&console.log("Resize Event")})),(0,n.subscribe)("model/changed",(function(){window.debug_mode&&console.log("Model Changed Event")})),(0,n.subscribe)("model/reset",(function(){window.debug_mode&&console.log("Model Reset Event")})),(0,n.subscribe)("canvas/moved",(function(){window.debug_mode&&(console.log("Canvas Moved Event ----"),console.log("OffsetX: "+window.loopy.offsetX),console.log("OffsetY: "+window.loopy.offsetY),console.log("Scale: "+window.loopy.offsetScale))}))}},591:(e,t,o)=>{var n,i,s,a;i=window,s={},a=i.c_||{},s.publish=function(e,t){for(var o=a[e],n=o?o.length:0;n--;)o[n].apply(i,t||[])},s.subscribe=function(e,t){return a[e]||(a[e]=[]),a[e].push(t),[e,t]},s.unsubscribe=function(e,t){for(var o=a[t?e:e[0]],n=(t=t||e[1],o?o.length:0);n--;)o[n]===t&&o.splice(n,1)},e.exports?e.exports=t=s:void 0===(n=function(){return s}.call(t,o,t,e))||(e.exports=n)}},t={};!function o(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,o),s.exports}(362)})();