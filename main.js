/*! For license information please see main.js.LICENSE.txt */
(()=>{var t={591:(t,e,o)=>{var n,i,s,a;i=window,s={},a=i.c_||{},s.publish=function(t,e){for(var o=a[t],n=o?o.length:0;n--;)o[n].apply(i,e||[])},s.subscribe=function(t,e){return a[t]||(a[t]=[]),a[t].push(e),[t,e]},s.unsubscribe=function(t,e){for(var o=a[e?t:t[0]],n=(e=e||t[1],o?o.length:0);n--;)o[n]===e&&o.splice(n,1)},t.exports?t.exports=e=s:void 0===(n=function(){return s}.call(e,o,e,t))||(t.exports=n)}},e={};function o(n){var i=e[n];if(void 0!==i)return i.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,o),s.exports}(()=>{"use strict";var t=o(591),e={MODE_EDIT:0,MODE_PLAY:1,TOOL_INK:0,TOOL_DRAG:1,TOOL_ERASE:2,TOOL_LABEL:3,TOOL_PAN:4,TOOL_LOOP:5};Math.TAU=2*Math.PI,window.HIGHLIGHT_COLOR="rgba(193, 220, 255, 0.6)";var n=!!navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i);function i(t){var e=document.createElement("div");return e.innerHTML=t,e.setAttribute("class","component_label"),e}function s(t,e){var o=document.createElement("div");return o.innerHTML=t,o.onclick=e,o.setAttribute("class","component_button"),o}function a(t,e){var o=e?document.createElement("textarea"):document.createElement("input");return o.setAttribute("class",t),o.addEventListener("keydown",(function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}),!1),o}function r(t){var e={};return e.dom=document.createElement("input"),e.dom.style.border="none",e.dom.style.width="40px",e.dom.style.padding="5px",e.dom.addEventListener("keydown",(function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}),!1),e.dom.onchange=function(){var o=parseInt(e.getValue());isNaN(o)&&(o=0),e.setValue(o),t(o)},e.dom.onclick=function(){e.dom.select()},e.getValue=function(){return e.dom.value},e.setValue=function(t){e.dom.value=t},e}function l(t,e,o,n){var i=function(t){var o=s(t);e(o)},s=function(e){var n={};if(e.changedTouches){var i=function(t){var e=t.getBoundingClientRect();return{left:e.left,top:e.top}}(t);n.x=e.changedTouches[0].clientX-i.left,n.y=e.changedTouches[0].clientY-i.top,e.preventDefault()}else n.x=e.offsetX,n.y=e.offsetY;return o(n),n},a=function(t){n({})};t.addEventListener("mousedown",i),t.addEventListener("mousemove",s),document.body.addEventListener("mouseup",a),t.addEventListener("touchstart",i,{capture:!1,passive:!0}),t.addEventListener("touchmove",s,{capture:!1,passive:!0}),document.body.addEventListener("touchend",a,{capture:!1,passive:!0})}function d(t){for(var e=1/0,o=1/0,n=-1/0,i=-1/0,s=0;s<t.length;s++){var a=t[s];a[0]<e&&(e=a[0]),n<a[0]&&(n=a[0]),a[1]<o&&(o=a[1]),i<a[1]&&(i=a[1])}return{left:e,right:n,top:o,bottom:i,width:n-e,height:i-o}}function c(t,e,o){t=JSON.parse(JSON.stringify(t));for(var n=0;n<t.length;n++){var i=t[n];i[0]+=e,i[1]+=o}return t}function u(t,e){t=JSON.parse(JSON.stringify(t));for(var o=0;o<t.length;o++){var n=t[o],i=n[0],s=n[1];n[0]=i*Math.cos(e)-s*Math.sin(e),n[1]=s*Math.cos(e)+i*Math.sin(e)}return t}function h(t,e){for(var o in e)t[o]=e[o]}function p(t,e,o,n,i){var s=o-t,a=n-e;return s*s+a*a<=i*i}function f(t,e,o){for(var n="#",i=0;i<3;i++){var s=t.substring(1+2*i,3+2*i),a=e.substring(1+2*i,3+2*i),r=parseInt(s,16),l=parseInt(a,16);n+=("0"+Math.floor(r*(1-o)+l*o).toString(16).toUpperCase()).slice(-2)}return n}window.onresize=function(){(0,t.publish)("resize")},window.onbeforeunload=function(t){if(loopy.dirty){var e="Are you sure you want to leave without saving your changes?";return t.returnValue=e,e}};var m=25,g=110;function y(t,e){var o=t.clientWidth,n=t.clientHeight;e.width=2*o,e.height=2*n,e.style.width=o+"px",e.style.height=n+"px"}var b=["#EA3E3E","#EA9D51","#FEEE43","#BFEE3F","#7FD4FF","#A97FFF"];function v(t,e){for(var o,n=0;n<document.styleSheets.length;n++)document.styleSheets[n].href&&document.styleSheets[n].href.indexOf(t)>-1&&(o=document.styleSheets[n].ownerNode);if(null==e&&(e=!o),e){if(o)return e;var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=t,document.getElementsByTagName("head")[0].appendChild(i)}else o&&o.parentNode.removeChild(o);return e}function w(t){var e=[],o=!1;return t.forEach((function(t){if(t.includes(" ")){var n=function(t){for(var e=t.split(" "),o=["",""],n=0;n<Math.round(e.length/2);n++){var i=e[n];o[0]+=i+" "}for(n=Math.round(e.length/2);n<e.length;n++)i=e[n],o[1]+=i+" ";return o[0]=o[0].slice(0,-1),o[1]=o[1].slice(0,-1),o}(t);e.push(n[0]),e.push(n[1]),o=!0}else e.push(t)})),{paragraph:e,success:o}}function x(t,e,o){var n=0;return o.save(),o.font=e+"px sans-serif",t.forEach((function(t){var e=o.measureText(t).width;e>n&&(n=e)})),o.restore(),n}function k(t,e){return t*e}window.Mouse={},Mouse.x=0,Mouse.y=0,Mouse.showCursor=function(t){},Mouse.init=function(e,o){return l(o,(function(e){Mouse.moved=!1,Mouse.pressed=!0,Mouse.startedOnTarget=!0,(0,t.publish)("mousedown")}),(function(o){var n=document.getElementById("canvasses"),i=0,s=0,a=1/e.offsetScale,r=n.clientWidth-m-m,l=n.clientHeight-g-m;e.embedded&&(i-=12.5,s-=12.5),i-=(r+m)/2,s-=(l+m)/2,i*=a,s*=a,i+=(r+m)/2,s+=(l+m)/2,e.pan.active||(i-=e.offsetX,s-=e.offsetY);var d=o.x*a+i,c=o.y*a+s;Mouse.x=d,Mouse.y=c,Mouse.moved=!0,(0,t.publish)("mousemove")}),(function(){Mouse.pressed=!1,Mouse.startedOnTarget&&((0,t.publish)("mouseup"),Mouse.moved||(0,t.publish)("mouseclick")),Mouse.moved=!1,Mouse.startedOnTarget=!1})),Mouse.target=o,Mouse.showCursor=function(t){Mouse.target.style.cursor=t},Mouse.update=function(){Mouse.showCursor("")},Mouse};const M=Mouse;function _(t){var e={};return e.dom=t,e.pages=[],e.addPage=function(t,o){o.id=t,e.dom.appendChild(o.dom),e.pages.push(o)},e.currentPage={edit:()=>{}},e.showPage=function(t){for(var o={edit:()=>{}},n=0;n<e.pages.length;n++){var i=e.pages[n];i.id==t?(i.show(),o=i):i.hide()}return e.currentPage=o,o},e}function E(){var t=this;t.dom=document.createElement("div"),t.show=function(){t.dom.style.display="flex"},t.hide=function(){t.dom.style.display="none"},t.addComponent=function(e){return t.dom.appendChild(e.dom),e}}function C(e,o){var n=this;n._CLASS_="LoopMark",n.loopy=e.loopy,n.model=e,n.config=o,h(n,o),n.kill=function(){e.removeLoopMark(n),(0,t.publish)("kill",[n])},n.draw=function(t){var e,o=2*n.x,i=2*n.y;t.save(),t.translate(o,i),n.loopy.sidebar.currentPage.target==n&&(t.beginPath(),t.arc(0,0,60,0,Math.TAU,!1),t.fillStyle=HIGHLIGHT_COLOR,t.fill()),t.beginPath(),t.strokeStyle=n.color,t.lineWidth=6,n.clockwise?(t.arc(0,0,40,5*-Math.PI/4,2*Math.PI/5,!n.clockwise),e=2*Math.PI/5):(t.arc(0,0,40,1*Math.PI/4,7*-Math.PI/5,!n.clockwise),e=7*-Math.PI/5),t.stroke(),t.font="100 40px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillStyle=n.color,n.reinforcement?t.fillText("R",0,0):t.fillText("B",0,0),t.translate(20*Math.cos(e)*2,20*Math.sin(e)*2),n.clockwise?t.rotate(e+Math.PI):t.rotate(e),t.moveTo(6,6),t.lineTo(0,0),t.lineTo(-6,6),t.stroke(),t.restore()},n.isPointInLoopMark=function(t,e){var o=n.x-t,i=n.y-e;return Math.sqrt(o*o+i*i)<=20}}function T(o,n){var i=this;i._CLASS_="Edge",i.loopy=o.loopy,i.model=o,i.config=n,h(i,n),i.from=o.getNode(i.from),i.to=o.getNode(i.to),i.signals=[],i.signalSpeed=0,i.addSignal=function(t){if(!(T.allSignals.length>T.MAX_SIGNALS||i.signals.length>T.MAX_SIGNALS_PER_EDGE)){var e,o=t.delta;e=void 0===t.age?1e6:t.age-1;var n={delta:o,position:0,scaleX:Math.abs(o),scaleY:o,age:e};e<=0||(i.signals.unshift(n),T.allSignals.push(n))}},i.updateSignals=function(){var t=Math.pow(2,i.loopy.signalSpeed),e=1;i.delay>0&&(e=i.delay+1),i.signalSpeed=t/(680*e);for(var o=0;o<i.signals.length;o++){var n=i.signals[o];n.position,n.position+=i.signalSpeed}for(var s=i.signals[i.signals.length-1];s&&s.position>=1;)s.delta*=i.strength,i.to.takeSignal(s),i.removeSignal(s),s=i.signals[i.signals.length-1]},i.removeSignal=function(t){i.signals.splice(i.signals.indexOf(t),1),T.allSignals.splice(T.allSignals.indexOf(t),1)},i.drawSignals=function(t){for(var e=0;e<i.signals.length;e++){var o=i.signals[e],n=i.getPositionAlongArrow(o.position),s=n.x,a=n.y;t.save(),t.translate(s,a),t.rotate(-g),t.scale(o.scaleX,o.scaleY),t.scale(40,40);var r,l=f(i.from.color,i.to.color,r=o.position<.4?0:o.position<.6?(o.position-.4)/(.6-.4):1);if(i.strength<0){var d=Math.cos(r*Math.PI);t.scale(1,d)}2==o.age?t.globalAlpha=.5:1==o.age&&(t.globalAlpha=.25),t.beginPath(),t.moveTo(-2,0),t.lineTo(0,-2),t.lineTo(2,0),t.lineTo(1,0),t.lineTo(1,2),t.lineTo(-1,2),t.lineTo(-1,0),t.fillStyle=l,t.fill(),t.restore()}};var s,a,r,l,d,c,u,m,g,y,b,v,w,x,k,M,_,E,C,I,L,S,P,A,O,B,D,R,N,U,X,Y,H,z=(0,t.subscribe)("model/reset",(function(){i.signals=[],T.allSignals=[]}));i.labelX=0,i.labelY=0,i.update=function(t){if(0==i.arc&&(i.arc=.1),s=2*i.from.x,a=2*i.from.y,r=2*i.to.x,l=2*i.to.y,i.from==i.to){var e=i.rotation;e*=Math.TAU/360,r+=Math.cos(e),l+=Math.sin(e)}c=r-s,u=l-a,m=Math.sqrt(c*c+u*u),g=Math.atan2(u,c),y=Math.abs(2*i.arc),b=(d=y/2+m*m/(8*y))-y,v=Math.acos(m/2/d);let o=Math.tan(v),n=i.to.ry,h=i.to.rx,p=1/Math.sqrt(1/(n*n)+o*o/(h*h)),f=Math.sqrt(h*h-p*p*h*h/(n*n)),T=Math.abs(p),z=Math.abs(f),F=Math.sqrt(T*T+z*z);w=this.model.loopy.onlyText?0:25,x=2*(F+w)/d,k=2*(i.from.radius+w),M=k/d,_=v-Math.TAU/2,E=-v,y>d&&(_*=-1,E*=-1),i.arc>0?(C=b,I=_+M,L=E-x):(C=-b,I=-_-M,L=-E+x),S=20,P=m/2+Math.cos(L)*d,A=C+Math.sin(L)*d,O=L+Math.TAU/4;var V=m/4/d;H=i.arc>0?L-V:L+V,i.from==i.to&&(H-=Math.PI/2),X=70,Y=30,N=m/2+Math.cos(H)*d,U=C+Math.sin(H)*d;var G,q=i.strength;G=q>=3?"+++":q>=2?"++":q>=1?"+":0==q?"?":q>=-1?"–":q>=-2?"– –":"– – –",i.label=G;var W=i.getPositionAlongArrow(.5);B=W.x,D=W.y,i.labelX=(s+Math.cos(g)*B-Math.sin(g)*D)/2,i.labelY=(a+Math.sin(g)*B+Math.cos(g)*D)/2,R=36,i.arc<0&&(R*=-1),D+=R,i.updateSignals()},i.getArrowLength=function(){var t;return i.from==i.to?d*Math.TAU-2*i.from.radius:(t=b<0?i.arc<0?Math.TAU+I-L:Math.TAU+L-I:Math.abs(L-I),d*t)},i.getPositionAlongArrow=function(t){t=1.1*t-.05;var e=I;b<0&&(e>0?e-=Math.TAU:e+=Math.TAU);var o=e+(L-e)*t;return{x:m/2+Math.cos(o)*d,y:C+Math.sin(o)*d}},i.draw=function(t){t.lineWidth=i.thickness,t.strokeStyle=i.color,t.save(),t.translate(s,a),t.rotate(g),i.loopy.sidebar.currentPage.target==i&&(t.save(),t.translate(B,D),t.rotate(-g),t.beginPath(),t.arc(0,5,60,0,Math.TAU,!1),t.fillStyle=HIGHLIGHT_COLOR,t.fill(),t.restore()),t.beginPath(),i.arc>0?t.arc(m/2,C,d,_,L,!1):t.arc(m/2,C,d,-_,L,!0),t.save(),t.translate(P,A),i.arc<0&&t.scale(-1,-1),t.rotate(O),t.moveTo(-S,-S),t.lineTo(0,0),t.lineTo(-S,S),t.restore(),t.stroke(),i.delay>0&&(t.save(),t.translate(N,U),i.arc<0&&t.scale(-1,-1),t.rotate(H),t.moveTo(-X/2,0),t.lineTo(X/2,0),t.stroke(),t.moveTo(-X/2,Y),t.lineTo(X/2,Y),t.stroke(),t.restore()),t.font="100 60px sans-serif",t.textAlign="center",t.textBaseline="middle",t.save(),t.translate(B,D),t.rotate(-g),t.fillStyle=i.color,t.fillText(i.label,0,0),t.restore(),i.drawSignals(t),t.restore()},i.kill=function(){(0,t.unsubscribe)("model/reset",z),o.removeEdge(i),(0,t.publish)("kill",[i])},i.isPointOnLabel=function(t,o){var n;return n=i.loopy.tool==e.TOOL_DRAG||i.loopy.tool==e.TOOL_INK?40:i.loopy.tool==e.TOOL_ERASE?25:15,p(t,o,i.labelX,i.labelY,n)},i.getBoundingBox=function(){if(i.from==i.to){var t=g-Math.TAU/4,e=s+Math.cos(t)*-C,o=a+Math.sin(t)*-C,n=d/2;return{left:(e/=2)-n,top:(o/=2)-n,right:e+n,bottom:o+n}}var r={x:i.from.x,y:i.from.y},l={x:i.to.x,y:i.to.y},c={x:(r.x+l.x)/2,y:(r.y+l.y)/2};t=g-Math.TAU/4,c.x+=Math.cos(t)*i.arc,c.y+=Math.sin(t)*i.arc;for(var u=1/0,h=1/0,p=-1/0,f=-1/0,m=[r,l,c],y=0;y<m.length;y++){var b=m[y],v=b.x,w=b.y;u>v&&(u=v),h>w&&(h=w),p<v&&(p=v),f<w&&(f=w)}return{left:u,top:h,right:p,bottom:f}}}function I(t){var e=this;e.target=null,e.dom=document.createElement("div"),e.show=function(){e.dom.style.display="block",e.onshow()},e.hide=function(){e.dom.style.display="none",e.onhide()};var o=e.dom;e.components=[],e.componentsByID={},e.addComponent=function(t,n){return n||(n=t,t=""),n.page=e,n.propName=t,o.appendChild(n.dom),e.components.push(n),e.componentsByID[t]=n,n},e.getComponent=function(t){return e.componentsByID[t]},e.edit=function(t){e.target=t;for(var o=0;o<e.components.length;o++)e.components[o].show();e.onedit()},t&&e.addComponent(new O({header:!0,label:"Go Back",onclick:function(){t.showPage("Edit")}})),(o=document.createElement("div")).classList.add("form_container"),e.dom.appendChild(o),e.onedit=function(){},e.onshow=function(){},e.onhide=function(){},e.hide()}function L(){var e=this;e.dom=null,e.page=null,e.propName=null,e.show=function(){},e.getValue=function(){return e.page.target[e.propName]},e.setValue=function(o){(0,t.publish)("model/changed"),e.page.target[e.propName]=o,e.page.onedit()}}function S(t){var e=this;L.apply(e),e.dom=document.createElement("div");var o=i(t.label),n=a(t.textarea?"component_textarea":"component_input",t.textarea);n.oninput=function(t){e.setValue(n.value)},e.dom.appendChild(o),e.dom.appendChild(n),e.show=function(){n.value=e.getValue()},e.select=function(){setTimeout((function(){n.select()}),10)}}function P(t){var e=this;L.apply(e),e.dom=document.createElement("div");var o=i(t.label),n=function(t){var e=document.createElement("input");return e.setAttribute("class","component_input"),e.setAttribute("type","color"),e.addEventListener("keydown",(function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}),!1),e}();n.oninput=function(t){e.setValue(n.value)},e.dom.appendChild(o),e.dom.appendChild(n),e.show=function(){n.value=e.getValue()},e.select=function(){setTimeout((function(){n.select()}),10)}}function A(t){var e=this;L.apply(e),e.dom=document.createElement("div");var o=i(t.label);e.dom.appendChild(o);var n=document.createElement("div");n.setAttribute("class","component_slider"),e.dom.appendChild(n);var s=new Image;s.draggable=!1,s.src="assets/sliders/"+t.bg+".png",s.setAttribute("class","component_slider_graphic");var a=new Image;a.draggable=!1,a.src="assets/sliders/slider_pointer.png",a.setAttribute("class","component_slider_pointer"),n.appendChild(s),n.appendChild(a);var r=function(){var o=e.getValue(),n=(t.options.indexOf(o)+.5)*(250/t.options.length);a.style.left=n-7.5+"px"},d=!1,c=function(o){var n=o.x/250,i=Math.floor(n*t.options.length),s=t.options[i];void 0!==s&&(e.setValue(s),t.oninput&&t.oninput(s),r())};l(s,(function(t){d=!0,c(t)}),(function(t){d&&c(t)}),(function(){d=!1})),e.show=function(){r()},e.setBGColor=function(t){s.style.background=t}}function O(t){var e=this;L.apply(e),e.dom=document.createElement("div");var o=s(t.label,(function(){t.onclick(e.page.target)}));e.dom.appendChild(o),t.header&&o.setAttribute("header","yes")}function B(t){var e=this;L.apply(e),e.dom=document.createElement("div"),e.dom.innerHTML=t.html}function D(t){var e=this;L.apply(e),e.dom=a("component_output"),e.dom.setAttribute("readonly","true"),e.dom.onclick=function(){e.dom.select()},e.output=function(t){e.dom.value=t}}C.defaultOrientation=1,C.defaultType=1,C.defaultColor="#666666",T.allSignals=[],T.MAX_SIGNALS=100,T.MAX_SIGNALS_PER_EDGE=10,T.defaultStrength=1,T.defaultColor="#666",T.defaultThickness=3,T.defaultDelay=0;function R(t,e){var o=this;o.id=e.id,o.dom=document.createElement("div"),o.dom.setAttribute("class","toolbar_button"),o.dom.style.backgroundImage="url('"+e.icon+"')",o.dom.setAttribute("aria-label",e.tooltip),o.dom.setAttribute("data-balloon-pos","down-left"),o.select=function(){o.dom.setAttribute("selected","yes")},o.deselect=function(){o.dom.setAttribute("selected","no")},"lock"==e.id?o.callback=function(){e.callback(),loopy.locked?o.select():o.deselect()}:"fs"==e.id?o.callback=function(){e.callback()}:"clone"==e.id?o.callback=function(){e.callback(),loopy.clonning?o.select():o.deselect()}:"mode"==e.id?o.callback=function(){e.callback(),loopy.onlyText?o.select():o.deselect()}:o.callback=function(){e.callback(),t.selectButton(o)},o.dom.onclick=o.callback}const N=function(o){var n={},i=[];return n.buttonsByID={},n.dom=document.getElementById("toolbar"),n.addButton=function(e){var s=e.id,a=e.tooltip,r=e.callback,l=new R(n,{id:s,icon:"assets/nicons/"+s+".svg",tooltip:a,callback:r});n.dom.appendChild(l.dom),i.push(l),n.buttonsByID[s]=l,function(e){(0,t.subscribe)("key/"+e,(function(){o.ink.reset(),n.buttonsByID[e].callback()}))}(s)},n.addSeparator=function(){var t=document.createElement("div");t.setAttribute("class","toolbar_separator"),t.style.backgroundImage="url('assets/icons/separator.png')",n.dom.appendChild(t)},n.selectButton=function(t){for(var e=0;e<i.length;e++)i[e].deselect();o.locked&&this.buttonsByID.lock.select(),o.clonning&&this.buttonsByID.clone.select(),t.select()},n.currentTool="drag",n.setTool=function(t){n.currentTool=t;var i="TOOL_"+t.toUpperCase();o.tool=e[i],document.getElementById("canvasses").setAttribute("cursor",t)},n.addButton({id:"drag",tooltip:"MO(V)E",callback:function(){n.setTool("drag")}}),n.addButton({id:"pan",tooltip:"(P)AN",callback:function(){n.setTool("pan")}}),n.addSeparator(),n.addButton({id:"ink",tooltip:"PE(N)CIL",callback:function(){n.setTool("ink")}}),n.addButton({id:"loop",tooltip:"(L)OOP",callback:function(){n.setTool("loop")}}),n.addButton({id:"label",tooltip:"(T)EXT",callback:function(){n.setTool("label")}}),n.addButton({id:"erase",tooltip:"(E)RASE",callback:function(){n.setTool("erase")}}),n.addSeparator(),n.addButton({id:"clone",tooltip:"Press to enable/disable clonning the previous element",callback:function(){o.clonning?o.clonning=!1:o.clonning=!0}}),n.addButton({id:"mode",tooltip:"Press to enable/disable 'Only Text' mode",callback:function(){o.onlyText?o.onlyText=!1:o.onlyText=!0,(0,t.publish)("model/changed")}}),n.addButton({id:"lock",tooltip:"Press to Lock/Unlock Edit Tools",callback:function(){o.locked?o.locked=!1:o.locked=!0}}),n.addSeparator(),n.addButton({id:"fs",tooltip:"Return to the Landing Page",callback:function(){v("assets/fs.css")}}),n.buttonsByID.drag.callback(),(0,t.subscribe)("model/changed",(function(){o.locked||n.buttonsByID.drag.callback()})),n};function U(o){var n={};n.loopy=o;var i=function(){var e=document.getElementById("canvasses"),o=document.createElement("canvas"),n=function(){var t=e.clientWidth,n=e.clientHeight;o.width=2*t,o.style.width=t+"px",o.height=2*n,o.style.height=n+"px"};return n(),e.appendChild(o),(0,t.subscribe)("resize",(function(){n()})),o}(),s=i.getContext("2d");return n.canvas=i,n.context=s,n.strokeData=[],n.drawInk=function(){if(Mouse.pressed){var t=n.strokeData[n.strokeData.length-1];s.strokeStyle="#ccc",s.lineWidth=5,s.lineCap="round";var e=document.getElementById("canvasses"),i=e.clientWidth-m-m,a=e.clientHeight-g-m,r=2*o.offsetX,l=2*o.offsetY;r-=i+m,l-=a+m;var d=o.offsetScale;r*=d,l*=d,r+=i+m,l+=a+m,o.embedded&&(r+=m,l+=m),s.setTransform(d,0,0,d,r,l),s.beginPath(),s.moveTo(2*t[0],2*t[1]),s.lineTo(2*Mouse.x,2*Mouse.y),s.stroke(),n.strokeData.push([Mouse.x,Mouse.y])}},n.reset=function(){var t=document.getElementById("canvasses"),e=t.clientWidth-m-m,a=t.clientHeight-g-m,r=2*o.offsetX,l=2*o.offsetY;r-=e+m,l-=a+m;var d=o.offsetScale;r*=d,l*=d,r+=e+m,l+=a+m,o.embedded&&(r+=m,l+=m),s.clearRect(-r,-l,i.width,i.height),n.strokeData=[]},(0,t.subscribe)("mousedown",(function(){n.loopy.mode==e.MODE_EDIT&&n.loopy.tool==e.TOOL_INK&&(n.strokeData=[],n.strokeData.push([Mouse.x,Mouse.y]),n.drawInk())})),(0,t.subscribe)("mousemove",(function(){n.loopy.mode==e.MODE_EDIT&&n.loopy.tool==e.TOOL_INK&&n.drawInk()})),(0,t.subscribe)("mouseup",(function(){if(n.loopy.mode==e.MODE_EDIT&&n.loopy.tool==e.TOOL_INK&&!(n.strokeData.length<2)&&Mouse.moved){var t=n.strokeData[0],i=o.model.getNodeByPoint(t[0],t[1]);i||(i=o.model.getNodeByPoint(t[0],t[1],20));var s=n.strokeData[n.strokeData.length-1],a=o.model.getNodeByPoint(s[0],s[1]);if(a||(a=o.model.getNodeByPoint(s[0],s[1],40)),i&&a){var r={from:i.id,to:a.id};if(i==a){var l=((y=d(n.strokeData)).left+y.right)/2,h=(y.top+y.bottom)/2,p=l-i.x,f=h-i.y,m=Math.atan2(f,p);if(y=d(u(c(n.strokeData,-i.x,-i.y),-m)),r.rotation=m*(360/Math.TAU)+90,r.arc=y.right,r.arc<i.radius)r=null,o.sidebar.edit(i);else{var g=i.radius+25;r.arc<g&&(r.arc=g)}}else{p=a.x-i.x,f=a.y-i.y,m=Math.atan2(f,p);var y=d(u(c(n.strokeData,-i.x,-i.y),-m));Math.abs(y.top)>Math.abs(y.bottom)?r.arc=-y.top:r.arc=-y.bottom}if(r){var b=o.model.addEdge(r);o.sidebar.edit(b)}}if(!i){l=((y=d(n.strokeData)).left+y.right)/2,h=(y.top+y.bottom)/2;var v=y.width/2,w=y.height/2;if(v>20&&w>20){var x=o.model.addNode({x:l,y:h,w:v,h:w});o.sidebar.edit(x)}}n.reset()}})),(0,t.subscribe)("mouseclick",(function(){n.loopy.mode==e.MODE_EDIT&&n.loopy.tool==e.TOOL_INK&&n.reset()})),n}U.MINIMUM_RADIUS=Node.DEFAULT_RADIUS,U.SNAP_TO_RADIUS=25;const X=U,Y=function(o){var n={};return n.loopy=o,n.dragging=null,n.offsetX=0,n.offsetY=0,n.handling=null,(0,t.subscribe)("mousedown",(function(){if(n.loopy.mode==e.MODE_EDIT&&n.loopy.tool==e.TOOL_DRAG){var t=o.model.getLoopMarkByPoint(Mouse.x,Mouse.y);if(t)return n.dragging=t,n.offsetX=Mouse.x-t.x,n.offsetY=Mouse.y-t.y,void o.sidebar.edit(t);var i=o.model.getHandlerByPoint(Mouse.x,Mouse.y);if(i)return n.handling=i,n.offsetX=Mouse.x-i.w,n.offsetY=Mouse.y-i.h,void o.sidebar.edit(i);var s=o.model.getNodeByPoint(Mouse.x,Mouse.y);if(s)return n.dragging=s,n.offsetX=Mouse.x-s.x,n.offsetY=Mouse.y-s.y,void o.sidebar.edit(s);var a=o.model.getLabelByPoint(Mouse.x,Mouse.y);if(a)return n.dragging=a,n.offsetX=Mouse.x-a.x,n.offsetY=Mouse.y-a.y,void o.sidebar.edit(a);var r=o.model.getEdgeByPoint(Mouse.x,Mouse.y);return r?(n.dragging=r,n.offsetX=Mouse.x-r.labelX,n.offsetY=Mouse.y-r.labelY,void o.sidebar.edit(r)):void 0}})),(0,t.subscribe)("mousemove",(function(){if(n.loopy.mode==e.MODE_EDIT&&n.loopy.tool==e.TOOL_DRAG){if(n.handling){(0,t.publish)("model/changed");var i=n.handling;i.w=Math.abs(Mouse.x-n.offsetX),i.h=Math.abs(Mouse.y-n.offsetY),i.w<20&&(i.w=20),i.h<20&&(i.h=20),o.model.update()}if(n.dragging&&"Node"==n.dragging._CLASS_){(0,t.publish)("model/changed");var s=n.dragging;s.x=Mouse.x-n.offsetX,s.y=Mouse.y-n.offsetY,o.model.update()}if(n.dragging&&"Edge"==n.dragging._CLASS_){(0,t.publish)("model/changed");var a=n.dragging,r=Mouse.x-n.offsetX,l=Mouse.y-n.offsetY;if(a.from!=a.to){var d=a.from.x,h=a.from.y,p=a.to.x-d,f=a.to.y-h,m=Math.atan2(f,p),g=u(c([[r,l]],-d,-h),-m)[0];a.arc=-g[1]}else{p=r-a.from.x,f=l-a.from.y,m=Math.atan2(f,p);var y=Math.sqrt(p*p+f*f),b=a.from.radius+25;y<b&&(y=b),a.arc=y,a.rotation=m*(360/Math.TAU)+90}o.model.update()}if(n.dragging&&"Label"==n.dragging._CLASS_){(0,t.publish)("model/changed");var v=n.dragging;v.x=Mouse.x-n.offsetX,v.y=Mouse.y-n.offsetY,o.model.update()}if(n.dragging&&"LoopMark"==n.dragging._CLASS_){(0,t.publish)("model/changed");var w=n.dragging;w.x=Mouse.x-n.offsetX,w.y=Mouse.y-n.offsetY,o.model.update()}}})),(0,t.subscribe)("mouseup",(function(){n.loopy.mode==e.MODE_EDIT&&n.loopy.tool==e.TOOL_DRAG&&(n.dragging=null,n.handling=null,n.offsetX=0,n.offsetY=0)})),n},H=function(o){var n={};return n.loopy=o,n.erase=function(t){if(n.loopy.mode==e.MODE_EDIT&&n.loopy.tool==e.TOOL_ERASE){if(Mouse.pressed||t){var i=o.model.getNodeByPoint(Mouse.x,Mouse.y);i&&i.kill()}if(Mouse.pressed||t){var s=o.model.getEdgeByPoint(Mouse.x,Mouse.y,!0);s&&s.kill()}if(Mouse.pressed||t){var a=o.model.getLabelByPoint(Mouse.x,Mouse.y);a&&a.kill()}if(Mouse.pressed||t){var r=o.model.getLoopMarkByPoint(Mouse.x,Mouse.y);r&&r.kill()}}},(0,t.subscribe)("mousemove",(function(){n.erase()})),(0,t.subscribe)("mouseclick",(function(){n.erase(!0)})),n},z=function(t){var o={};return o.loopy=t,o.tryMakingLabel=function(){if(o.loopy.mode==e.MODE_EDIT&&o.loopy.tool==e.TOOL_LABEL)if("Label"!=o.loopy.sidebar.currentPage.id){var n=t.model.addLabel({x:Mouse.x,y:Mouse.y+10,color:"#000000"});t.sidebar.edit(n)}else t.sidebar.showPage("Edit")},o},F=function(o){var n={};return n.loopy=o,n.active=!1,n.referenced=!1,n.mouseXRef=0,n.mouseYRef=0,(0,t.subscribe)("mousedown",(function(){window.loopy.tool==e.TOOL_PAN&&(n.active=!0,n.referenced=!1,o.initialCanvasX=o.offsetX,o.initialCanvasY=o.offsetY)})),(0,t.subscribe)("mouseup",(function(){window.loopy.tool==e.TOOL_PAN&&(n.active=!1,o.initialCanvasX=o.offsetX,o.initialCanvasY=o.offsetY)})),(0,t.subscribe)("mousemove",(function(){n.referenced||(n.mouseXRef=Mouse.x-o.offsetX,n.mouseYRef=Mouse.y-o.offsetY,n.referenced=!0),window.loopy.tool==e.TOOL_PAN&&n.active&&(o.offsetX=Mouse.x-n.mouseXRef,o.offsetY=Mouse.y-n.mouseYRef,(0,t.publish)("canvas/moved"))})),n},V=function(o){return(0,t.subscribe)("mouseup",(function(){o.mode==e.MODE_EDIT&&o.tool==e.TOOL_LOOP&&o.model.addLoopMark({x:Mouse.x,y:Mouse.y})})),this};function G(t){var e=this,o="<div class='play_button_icon' icon='"+t.icon+"'></div> <div class='play_button_label'>"+t.label+"</div>";e.dom=s(o,(function(){t.onclick()})),t.tooltip&&(e.dom.setAttribute("aria-label",t.tooltip),e.dom.setAttribute("data-balloon-pos","down"))}function q(t){var e=this;e.dom=document.createElement("div"),e.dom.classList.add("play_slider"),(o=new Image).src="assets/icons/speed_slow.png",o.width=20,o.height=15,e.dom.appendChild(o);var o,n=document.createElement("input");n.setAttribute("class","play_slider"),e.dom.appendChild(n),(o=new Image).src="assets/icons/speed_fast.png",o.width=20,o.height=15,e.dom.appendChild(o),n.type="range",n.value=t.value,n.step=t.step,n.min=t.min,n.max=t.max,n.oninput=function(e){t.oninput(n.value)}}const W=function(o){var i,s=_(document.getElementById("playbar"));return s.loopy=o,(0,t.subscribe)("key/enter",(function(){Key.control&&o.setMode(e.MODE_PLAY)})),(i=new E).addComponent(new G({icon:0,label:"Visualize Flow",tooltip:n?"⌘-Enter":"control-enter",onclick:function(){o.setMode(e.MODE_PLAY)}})).dom.style.backgroundColor="green",s.addPage("Editor",i),_.call(s,document.getElementById("playbar")),function(){var n,i=new E;o.embedded?((n=i.addComponent(new G({icon:2,label:"Reset",onclick:function(){(0,t.publish)("model/reset")}})).dom).style.backgroundColor="#d49b00",n.style.width="100px",n.style.left="0px",n.style.top="0px",(n=i.addComponent(new G({icon:3,label:"Remix",onclick:function(){var t=o.saveToURL();window.open(t,"_blank")}})).dom).style.width="100px",n.style.right="0px",n.style.top="0px"):((n=i.addComponent(new G({icon:1,label:"Stop",onclick:function(){o.setMode(e.MODE_EDIT)}})).dom).style.backgroundColor="red",(n=i.addComponent(new G({icon:2,label:"Reset",onclick:function(){(0,t.publish)("model/reset")}})).dom).style.backgroundColor="#d49b00"),i.addComponent(new q({value:o.signalSpeed,min:0,max:6,step:.2,oninput:function(t){o.signalSpeed=t}})).dom.style.bottom="0px",s.addPage("Player",i)}(),s};function J(t){var e=document.createElement("iframe");this.dom=e,e.width=t.width,e.height=t.height,t.manual||(t.page.onshow=function(){e.src=t.src},t.page.onhide=function(){e.removeAttribute("src")})}const K=function(){function t(t,e,o,n,i){this.g_w=t,this.g_h=e,this.square=o,this.tile=n,this.stroke=i}return t.prototype.getSvg=function(){return'<svg width="'+this.g_w*this.square*this.tile+'1" height="'+this.g_h*this.square*this.tile+'1" xmlns="http://www.w3.org/2000/svg"> \t\t\t\t<defs> \t\t\t\t\t\t<pattern id="smallGrid" width="'+this.g_w+'" height="'+this.g_h+'" patternUnits="userSpaceOnUse"> \t\t\t\t\t\t\t\t<path d="M '+this.g_w+" 0 L 0 0 0 "+this.g_h+'" fill="none" stroke="gray" stroke-width="'+this.stroke+'" /> \t\t\t\t\t\t</pattern> \t\t\t\t\t\t<pattern id="grid" width="'+this.g_w*this.square+'" height="'+this.g_h*this.square+'" patternUnits="userSpaceOnUse"> \t\t\t\t\t\t\t\t<rect width="'+this.g_w*this.square+'" height="'+this.g_h*this.square+'" fill="url(#smallGrid)" /> \t\t\t\t\t\t\t\t<path d="M '+this.g_w*this.square+" 0 L 0 0 0 "+this.g_h*this.square+'" fill="none" stroke="grey" stroke-width="'+2*this.stroke+'" /> \t\t\t\t\t\t</pattern> \t\t\t\t</defs> \t\t\t\t<rect width="100%" height="100%" fill="url(#grid)" /> \t\t</svg>'},t.prototype.getImg=function(){var t=window.URL||window.webkitURL,e=new Image,o=new Blob([this.getSvg()],{type:"image/svg+xml;charset=utf-8"}),n=t.createObjectURL(o);return e.src=n,e},t}();function j(e,o){var n=this;n._CLASS_="Label",n.loopy=e.loopy,n.model=e,n.config=o,h(n,o),n.draw=function(t){var e=2*n.x,o=2*n.y;if(n.loopy.sidebar.currentPage.target==n){var i=n.getBounds();t.save(),t.scale(2,2),t.beginPath(),t.rect(i.x,i.y,i.width,i.height),t.fillStyle=HIGHLIGHT_COLOR,t.fill(),t.restore()}t.save(),t.translate(e,o),t.font="100 "+j.FONTSIZE+"px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillStyle=n.color,t.shadowColor="white",t.shadowBlur=7;var s=n.breakText();t.translate(0,-j.FONTSIZE*s.length/2);for(var a=0;a<s.length;a++){var r=s[a];t.fillText(r,0,0),t.translate(0,j.FONTSIZE)}t.restore()},n.kill=function(){e.removeLabel(n),(0,t.publish)("kill",[n])},n.breakText=function(){return n.text.split(/\n/)},n.getBounds=function(){for(var t=n.model.ctx,e=n.breakText(),o=0,i=0;i<e.length;i++){var s=e[i];o<(a=2*(t.measureText(s).width+10))&&(o=a)}var a=o,r=j.FONTSIZE*e.length/2;return{x:n.x-a/2,y:n.y-r/2-j.FONTSIZE/2,width:a,height:r+j.FONTSIZE/2}},n.isPointInLabel=function(t,e){return function(t,e,o){return!(t<o.x||t>o.x+o.width||e<o.y||e>o.y+o.height)}(t,e,n.getBounds())},n.getBoundingBox=function(){var t=n.getBounds();return{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height}}}j.FONTSIZE=40;const Z=function(){function e(e,o){var n=this;this._CLASS_="Node",this.id=o.id,this.model=e,this.x=o.x,this.y=o.y,this.init=o.init,this.label=o.label,this.color=o.color,this.w=o.w,this.h=o.h,this.rx=Math.sqrt(this.w*(this.w+this.h)),this.ry=this.rx*Math.sqrt(this.h/this.w),this.cb_rx=this.rx*this.init,this.cb_ry=this.ry*this.init,this.radius=Math.max(this.rx,this.ry),this.value=this.init,this.controls_visible=!1,this.controls_alpha=0,this.controls_direction=0,this.controls_selected=!1,this.controls_pressed=!1,this.handler_hovered=!1,this.offset=0,this.offset_goto=0,this.offset_velocity=0,this.offset_acceleration=0,this.offset_damping=.3,this.offset_hookes=.8,this.shift_index=0,this._listenerMouseMove=(0,t.subscribe)("mousemove",(function(){if(e.loopy.mode==et.Play)n.controls_selected=n.isPointInNode(window.Mouse.x,window.Mouse.y,0),n.controls_selected?(n.controls_visible=!0,n.controls_direction=window.Mouse.y<n.y?1:-1):(n.controls_visible=!1,n.controls_direction=0);else{var t=n.x+n.w,o=n.y+n.h;p(Mouse.x,Mouse.y,t,o,6)?n.handler_hovered=!0:n.handler_hovered=!1}})),this._listenerMouseDown=(0,t.subscribe)("mousedown",(function(){if(e.loopy.mode==et.Play&&(n.controls_selected&&(n.controls_pressed=!0),n.controls_pressed)){var t=.33*n.controls_direction;n.value+=t,n.sendSignal({delta:t})}})),this._listenerMouseUp=(0,t.subscribe)("mouseup",(function(){e.loopy.mode==et.Play&&(n.controls_pressed=!1)})),this._listenerReset=(0,t.subscribe)("model/reset",(function(){n.value=n.init}))}return e.prototype.update=function(t){this.rx=Math.sqrt(this.w*(this.w+this.h)),this.ry=this.rx*Math.sqrt(this.h/this.w),this.radius=Math.max(this.rx,this.ry);var e=this.model.loopy.mode==et.Play;this.model.loopy.mode==et.Edit&&(this.value=this.init),this.controls_selected&&Mouse.showCursor("pointer");var o=this.controls_visible?1:0;this.controls_alpha=.5*this.controls_alpha+.5*o,e&&this.controls_pressed?this.offset_goto=20*-this.controls_direction:this.offset_goto=0,this.offset+=this.offset_velocity,this.offset=this.offset>40?40:this.offset,this.offset=this.offset<-40?-40:this.offset,this.offset_velocity+=this.offset_acceleration,this.offset_velocity*=this.offset_damping,this.offset_acceleration=(this.offset_goto-this.offset)*this.offset_hookes},e.prototype.draw=function(t){if(t.save(),t.translate(2*this.x,2*this.y),this.model.loopy.sidebar.currentPage.target==this&&(t.beginPath(),this.model.loopy.onlyText?t.rect(2*-this.w-10,2*-this.h-10,4*this.w+20,4*this.h+20):t.ellipse(0,0,2*(this.rx+10),2*(this.ry+10),0,0,2*Math.PI,!1),t.fillStyle=window.HIGHLIGHT_COLOR,t.fill()),this.model.loopy.onlyText)t.beginPath(),t.fillStyle="#fff",t.shadowColor="black",t.shadowBlur=7,t.rect(2*-this.w,2*-this.h,4*this.w,4*this.h),t.fill();else{t.beginPath(),t.lineWidth=6,t.strokeStyle=this.color,t.fillStyle="#fff",t.ellipse(0,0,2*this.rx,2*this.ry,0,0,2*Math.PI,!1),t.fill(),t.stroke();var e=.9*this.rx*Math.abs(this.value);this.cb_rx=.8*this.cb_rx+.2*e;var o=.9*this.ry*Math.abs(this.value);this.cb_ry=.8*this.cb_ry+.2*o,t.beginPath(),t.fillStyle=this.color,t.ellipse(0,0,2*this.cb_rx,2*this.cb_ry,0,0,2*Math.PI,!1),t.fill()}t.fillStyle="#000",t.textAlign="center",t.textBaseline="middle",t.shadowColor="white",t.shadowBlur=7,function(t,e,o){var n=[t],i=60;for(e.font=i+"px sans-serif";x(n,i,e)>o.width||k(n.length,i)>o.height;)if(k(n.length,i)<=o.height){var s=w(n);s.success?n=s.paragraph:(i--,e.font=i+"px sans-serif")}else i--,e.font=i+"px sans-serif";!function(t,e,o){var n=0,i=t.length*e;o.save(),o.textBaseline="top",o.translate(0,-i/2),o.font=e+"px sans-serif",t.forEach((function(t){o.fillText(t,0,n),n+=e})),o.restore()}(n,i,e)}(this.label,t,{width:4*this.w,height:4*this.h}),t.beginPath(),t.shadowColor="black",t.shadowBlur=0,t.strokeStyle="#000",t.fillStyle=this.handler_hovered?"#fff":"#999",t.arc(2*this.w,2*this.h,12,0,2*Math.PI),t.fill(),t.stroke();t.globalAlpha=this.controls_alpha,t.strokeStyle="rgba(0,0,0,0.8)",t.beginPath(),t.moveTo(-40,-40),t.lineTo(0,-80),t.lineTo(40,-40),t.lineWidth=this.controls_direction>0?10:3,t.stroke(),t.beginPath(),t.moveTo(-40,40),t.lineTo(0,80),t.lineTo(40,40),t.lineWidth=this.controls_direction<0?10:3,t.stroke(),t.restore()},e.prototype.sendSignal=function(t){var e,o,n=this.model.getEdgesByStartNode(this);e=n,o=this.shift_index,n=e.splice(-o).concat(e),this.shift_index=(this.shift_index+1)%n.length,n.forEach((function(e){e.addSignal(t)}))},e.prototype.takeSignal=function(t){this.value+=t.delta,this.sendSignal(t),this.offset_velocity-=t.delta/Math.abs(t.delta)*6},e.prototype.kill=function(){(0,t.unsubscribe)("mousemove",this._listenerMouseMove),(0,t.unsubscribe)("mousedown",this._listenerMouseDown),(0,t.unsubscribe)("mouseup",this._listenerMouseUp),(0,t.unsubscribe)("model/reset",this._listenerReset),this.model.removeNode(this),(0,t.publish)("kill",[this])},e.prototype.isPointInNode=function(t,e,o){if(this.model.loopy.onlyText){var n=this.getBoundingBox(),i=n.left<t&&t<n.right,s=n.top<e&&e<n.bottom;return i&&s}return Math.pow(t-this.x,2)/Math.pow(this.rx,2)+Math.pow(e-this.y,2)/Math.pow(this.ry,2)<=1},e.prototype.getBoundingBox=function(){return{left:this.x-this.w,top:this.y-this.h,right:this.x+this.w,bottom:this.y+this.h}},e}(),$=function(){function t(t){this.raw_data=t}return t.prototype.deserializeAny=function(t,e,o){this.raw_data=e;var n=o.split(".").pop(),i=e.includes("'");switch(n){case"smwks":i?this.deserializeV2(t,e):this.deserializeV1(t,e);break;case"loopy":this.deserializeVL(t,e);break;case"mdl":this.deserializeVV(t,e)}},t.prototype.stringify=function(t){var e=JSON.stringify(t[0]);t.splice(0,1);var o=JSON.stringify(t);return e+"'"+(o=o.replace(/"/gi,"%22")).substr(0,o.length-1)+"%5D"},t.prototype.serialize=function(t){var e=[];e.push(t.loopy.version);var o=[];t.nodes.forEach((function(t){o.push([t.id,Math.round(t.x),Math.round(t.y),t.init,encodeURIComponent(encodeURIComponent(t.label)),encodeURIComponent(encodeURIComponent(t.color)),Math.round(t.w),Math.round(t.h)])})),e.push(o);var n=[];t.edges.forEach((function(t){n.push([t.from.id,t.to.id,Math.round(t.arc),t.strength,Math.round(t.rotation),t.thickness,encodeURIComponent(encodeURIComponent(t.color)),t.delay])})),e.push(n);var i=[];t.labels.forEach((function(t){i.push([Math.round(t.x),Math.round(t.y),encodeURIComponent(encodeURIComponent(t.text)),encodeURIComponent(encodeURIComponent(t.color))])})),e.push(i),e.push(t.nodeUID);var s=[];return t.loop_marks.forEach((function(t){s.push([Math.round(t.x),Math.round(t.y),t.clockwise,t.reinforcement,encodeURIComponent(encodeURIComponent(t.color))])})),e.push(s),this.stringify(e)},t.prototype.deserializeV1=function(t,e){t.clear();var o=JSON.parse(e),n=o[0],i=o[1],s=o[2],a=o[3],r=o[4];n.forEach((function(e){t.addNode({id:e[0],x:e[1],y:e[2],init:e[3],label:decodeURIComponent(e[4]),color:decodeURIComponent(e[5]),w:e[6],h:e[6]})})),i.forEach((function(e){t.addEdge({from:e[0],to:e[1],arc:e[2],strength:e[3],rotation:0,thickness:e[5],color:decodeURIComponent(e[6]),delay:e[7]})})),s.forEach((function(e){t.addLabel({x:e[0],y:e[1],text:decodeURIComponent(e[2]),color:decodeURIComponent(e[3])})})),r.forEach((function(e){t.addLoopMark({x:e[0],y:e[1],clockwise:e[2],reinforcement:e[3],color:decodeURIComponent(e[4])})})),t.nodeUID=a},t.prototype.deserializeV2=function(t,e){t.clear();var o=e.split("'");o[0],e=o[1];var n=JSON.parse(e),i=n[0],s=n[1],a=n[2],r=n[3],l=n[4];i.forEach((function(e){t.addNode({id:e[0],x:e[1],y:e[2],init:e[3],label:decodeURIComponent(e[4]),color:decodeURIComponent(e[5]),w:e[6],h:e[7]})})),s.forEach((function(e){t.addEdge({from:e[0],to:e[1],arc:e[2],strength:e[3],rotation:0,thickness:e[5],color:decodeURIComponent(e[6]),delay:e[7]})})),a.forEach((function(e){t.addLabel({x:e[0],y:e[1],text:decodeURIComponent(e[2]),color:decodeURIComponent(e[3])})})),l.forEach((function(e){t.addLoopMark({x:e[0],y:e[1],clockwise:e[2],reinforcement:e[3],color:decodeURIComponent(e[4])})})),t.nodeUID=r},t.prototype.deserializeVL=function(t,e){t.clear(),alert("Auto importing loopy file");for(var o=JSON.parse(e),n=o[0],i=o[1],s=o[2],a=o[3],r=0;r<n.length;r++){var l=n[r];t.addNode({id:l[0],x:l[1],y:l[2],init:l[3],label:decodeURIComponent(l[4]),hue:b[l[5]]})}for(r=0;r<i.length;r++){var d=i[r],c={from:d[0],to:d[1],arc:d[2],strength:d[3]};t.addEdge(c)}for(r=0;r<s.length;r++){var u=s[r];t.addLabel({x:u[0],y:u[1],text:decodeURIComponent(u[2])})}t.nodeUID=a},t.prototype.deserializeVV=function(t,e){t.clear(),alert("Auto importing a Vensim model, some features are uncompatible and it is not officially suported. All views from the file will be collapsed.");for(var o=e.split("\n"),n=!1,i=0;i<o.length;i++){var s=o[i];if(n&&"$"!=s.charAt(0)){var a=s.split(",");"10"==a[0]?t.addNode({id:Number(a[1]),x:Number(a[3]),y:Number(a[4]),init:.5,label:a[2],color:"#666",radius:60}):"1"==a[0]&&t.addEdge({from:Number(a[2]),to:Number(a[3]),arc:100,strength:1,rotation:0,thickness:3,color:"#666",delay:0})}"*"==s.charAt(0)&&"*"!=s.charAt(1)&&(alert("Loading "+s.split("*")[1]),n=!0)}},t}();var Q=function(){return(Q=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};const tt=function(){function e(e){var o,n,i=this;this.speed=.05,this.canvas_dirty=!1,this.drawCountdownFull=60,this.drawCountdown=this.drawCountdownFull,this.nodes=[],this.nodeByID={},this.nodeUID=0,this.edges=[],this.labels=[],this.loop_marks=[],this.loopy=e,this.project=new $("[[],[],[],0,[]]"),this.canvas=(o=document.getElementById("canvasses"),n=document.createElement("canvas"),y(o,n),o.appendChild(n),(0,t.subscribe)("resize",(function(){y(o,n)})),n),this.ctx=this.canvas.getContext("2d"),this.grid=new K(50,50,4,5,2),this.grid_img=this.grid.getImg(),(0,t.subscribe)("mousemove",(function(){i.drawCountdown=i.drawCountdownFull})),(0,t.subscribe)("mousedown",(function(){i.drawCountdown=i.drawCountdownFull})),(0,t.subscribe)("model/changed",(function(){i.loopy.mode==et.Edit&&(i.drawCountdown=i.drawCountdownFull)})),(0,t.subscribe)("canvas/moved",(function(){i.drawCountdown=i.drawCountdownFull})),(0,t.subscribe)("resize",(function(){i.drawCountdown=i.drawCountdownFull})),(0,t.subscribe)("model/reset",(function(){i.drawCountdown=i.drawCountdownFull})),(0,t.subscribe)("loopy/mode",(function(){i.loopy.mode==et.Play?i.drawCountdown=2*i.drawCountdownFull:i.drawCountdown=i.drawCountdownFull})),(0,t.subscribe)("mouseclick",(function(){if(i.loopy.mode==et.Edit&&i.loopy.tool!=ot.Erase){var t=i.getNodeByPoint(i.loopy.mouseControl.x,i.loopy.mouseControl.y,2);if(t)return void i.loopy.sidebar.edit(t);var e=i.getLabelByPoint(i.loopy.mouseControl.x,i.loopy.mouseControl.y);if(e)return void i.loopy.sidebar.edit(e);var o=i.getEdgeByPoint(i.loopy.mouseControl.x,i.loopy.mouseControl.y);if(o)return void i.loopy.sidebar.edit(o);var n=i.getLoopMarkByPoint(i.loopy.mouseControl.x,i.loopy.mouseControl.y);if(n)return void i.loopy.sidebar.edit(n);if(i.loopy.tool==ot.Label)return void i.loopy.labeller.tryMakingLabel();i.loopy.sidebar.showPage("Edit")}})),this.node_def={x:0,y:0,init:.5,color:"#00EE00",label:"?",radius:60},this.edge_def={arc:100,rotation:0,strength:1,thickness:3,color:"#666",delay:0},this.label_def={x:0,y:0,text:"...",color:"#000000"},this.loopmark_def={x:0,y:0,clockwise:1,reinforcement:1,color:"#141414"},this.node_last={x:0,y:0,init:.5,color:"#00EE00",label:"?",radius:60},this.edge_last={arc:100,rotation:0,strength:1,thickness:3,color:"#666",delay:0},this.label_last={x:0,y:0,text:"...",color:"#000000"},this.loopmark_last={x:0,y:0,clockwise:1,reinforcement:1,color:"#141414"}}return e.prototype.getNode=function(t){return this.nodeByID[t]},e.prototype.addNode=function(e){(0,t.publish)("model/changed");var o=e;o.id||(o.id=this.getUID()),o=this.loopy.clonning?Q(Q({},this.node_last),o):Q(Q({},this.node_def),o);var n=new Z(this,o);return this.nodeByID[n.id]=n,this.nodes.push(n),this.update(),n},e.prototype.removeNode=function(e){(0,t.publish)("model/changed"),this.nodes.splice(this.nodes.indexOf(e),1),delete this.nodeByID[e.id];for(var o=0;o<this.edges.length;o++){var n=this.edges[o];n.to!=e&&n.from!=e||(n.kill(),o--)}},e.prototype.getUID=function(){return this.nodeUID++,this.nodeUID},e.prototype.addEdge=function(e){(0,t.publish)("model/changed");var o=new T(this,e=this.loopy.clonning?Q(Q({},this.edge_last),e):Q(Q({},this.edge_def),e));return this.edges.push(o),this.update(),o},e.prototype.removeEdge=function(e){(0,t.publish)("model/changed"),this.edges.splice(this.edges.indexOf(e),1)},e.prototype.getEdgesByStartNode=function(t){return this.edges.filter((function(e){return e.from==t}))},e.prototype.addLabel=function(e){(0,t.publish)("model/changed");var o=new j(this,e=this.loopy.clonning?Q(Q({},this.label_last),e):Q(Q({},this.label_def),e));return this.labels.push(o),this.update(),o},e.prototype.removeLabel=function(e){(0,t.publish)("model/changed"),this.labels.splice(this.labels.indexOf(e),1)},e.prototype.addLoopMark=function(e){(0,t.publish)("model/changed");var o=new C(this,e=this.loopy.clonning?Q(Q({},this.loopmark_last),e):Q(Q({},this.loopmark_def),e));return this.loop_marks.push(o),this.update(),o},e.prototype.removeLoopMark=function(e){(0,t.publish)("model/changed"),this.loop_marks.splice(this.loop_marks.indexOf(e),1)},e.prototype.updateLasts=function(t){switch(t._CLASS_){case"Node":this.node_last={x:0,y:0,init:t.init,color:t.color,label:t.label,radius:t.radius};break;case"Edge":this.edge_last={arc:t.arc,rotation:t.rotation,strength:t.strength,thickness:t.thickness,color:t.color,delay:t.delay};break;case"Label":this.label_last={x:0,y:0,text:t.text,color:t.color};break;case"LoopMark":this.loopmark_last={x:0,y:0,clockwise:t.clockwise,reinforcement:t.reinforcement,color:t.color}}},e.prototype.update=function(){var t=this;this.edges.forEach((function(e){e.update(t.speed)})),this.nodes.forEach((function(e){e.update(t.speed)})),this.canvas_dirty=!0},e.prototype.draw=function(){var t=this;if(this.edges.forEach((function(e){e.signals.length>0&&(t.drawCountdown=t.drawCountdownFull)})),this.drawCountdown--,this.drawCountdown>0&&this.canvas_dirty){this.canvas_dirty=!1;var e=this.loopy,o=this.ctx;o.clearRect(0,0,this.canvas.width,this.canvas.height),o.save();var n=document.getElementById("canvasses"),i=n.clientWidth-m-m,s=n.clientHeight-g-m,a=2*e.offsetX,r=2*e.offsetY;a-=i+m,r-=s+m;var l=e.offsetScale;a*=l,r*=l,a+=i+m,r+=s+m,o.setTransform(l,0,0,l,a,r),o.drawImage(this.grid_img,0,0),this.labels.forEach((function(t){return t.draw(o)})),this.edges.forEach((function(t){return t.draw(o)})),this.nodes.forEach((function(t){return t.draw(o)})),this.loop_marks.forEach((function(t){return t.draw(o)})),o.restore()}},e.prototype.serialize=function(){return this.project.serialize(this)},e.prototype.deserialize=function(t,e){this.project.deserializeAny(this,t,e)},e.prototype.clear=function(){for(;this.nodes.length>0;)this.nodes[0].kill();for(;this.labels.length>0;)this.labels[0].kill();for(;this.loop_marks.length>0;)this.loop_marks[0].kill()},e.prototype.getNodeByPoint=function(t,e,o){for(var n=this.nodes.length-1;n>=0;n--){var i=this.nodes[n];if(i.isPointInNode(t,e,o))return i}return null},e.prototype.getHandlerByPoint=function(t,e){for(var o=this.nodes.length-1;o>=0;o--){var n=this.nodes[o];if(p(t,e,n.x+n.w,n.y+n.h,6))return n}},e.prototype.getEdgeByPoint=function(t,e){for(var o=this.edges.length-1;o>=0;o--){var n=this.edges[o];if(n.isPointOnLabel(t,e))return n}return null},e.prototype.getLabelByPoint=function(t,e){for(var o=this.labels.length-1;o>=0;o--){var n=this.labels[o];if(n.isPointInLabel(t,e))return n}return null},e.prototype.getLoopMarkByPoint=function(t,e){for(var o=this.loop_marks.length-1;o>=0;o--){var n=this.loop_marks[o];if(n.isPointInLoopMark(t,e))return n}return null},e.prototype.getBounds=function(){if(this.nodes.length>0||this.labels.length>0||this.loop_marks.length>0){var t=1/0,e=1/0,o=-1/0,n=-1/0,i=function(i){for(var s=0;s<i.length;s++){var a=i[s].getBoundingBox();t>a.left&&(t=a.left),e>a.top&&(e=a.top),o<a.right&&(o=a.right),n<a.bottom&&(n=a.bottom)}};return i(this.nodes),i(this.edges),i(this.labels),i(this.loop_marks),{left:t,top:e,right:o,bottom:n}}var s=document.getElementById("canvasses");return{left:0,top:0,right:s.clientWidth-m-m,bottom:s.clientHeight-g-m}},e.prototype.center=function(t){if(this.nodes.length>0||this.labels.length>0){var e=this.getBounds(),o=document.getElementById("canvasses"),n=o.clientWidth-m-m,i=o.clientHeight-g-m,s=(e.left+e.right)/2,a=(e.top+e.bottom)/2;if(this.loopy.offsetX=(m+n)/2-s,this.loopy.offsetY=(m+i)/2-a,t){var r,l=e.right-e.left,d=e.bottom-e.top;r=l/d>n/i?n/l:i/d,this.loopy.offsetScale=r}}},e}();var et,ot;!function(t){t[t.Edit=0]="Edit",t[t.Play=1]="Play"}(et||(et={})),function(t){t[t.Ink=0]="Ink",t[t.Drag=1]="Drag",t[t.Erase=2]="Erase",t[t.Label=3]="Label",t[t.Pan=4]="Pan",t[t.Loop=5]="Loop"}(ot||(ot={}));const nt=function(){function e(){var e=this;this.version=[2,0,0],this.offsetX=0,this.offsetY=0,this.offsetScale=1,this.initialCanvasX=0,this.initialCanvasY=0,this.signalSpeed=3,this.mode=et.Edit,this.tool=ot.Drag,this.tools_locked=!1,this.clonning=!1,this.dirty=!1,this.wobbleControls=-1,this.onlyText=!1,this.temp_onlyText=!1,this._blankData="[2,0,0]'[[[4,73,250,0.33,%22Actions%22,%22%25230b72e0%22,31,20],[7,315,250,0.5,%22Results%22,%22%2523c507df%22,59,20],[9,554,250,0,%22Slowing%2520Action%22,%22%2523d51010%22,31,20]],[[7,9,120,1,0,7,%22%2523c72323%22,0],[7,4,130,1,0,7,%22%25233450b7%22,0],[9,7,114,-1,0,3,%22%2523c72323%22,1],[4,7,117,1,0,5,%22%25233450b7%22,0]],[[302,93,%22Limits%2520to%2520Growth%22,%22%2523000000%22]],9,[[433,250,1,0,%22%2523c72323%22],[172,250,0,1,%22%25233450b7%22]]%5D",this.mouseControl=M.init(this,document.getElementById("canvasses")),this.model=new tt(this),this.sidebar=function(e){var o,n=_(document.getElementById("sidebar"));return n.edit=function(t){e.model.updateLasts(t),n.showPage(t._CLASS_),n.currentPage.edit(t)},(0,t.subscribe)("kill",(function(t){n.currentPage.target==t&&n.showPage("Edit")})),(o=new I(n)).addComponent("label",new S({label:"Name:"})),o.addComponent("color",new P({label:"Color:"})),o.addComponent("init",new A({bg:"initial",label:"Start Amount:",options:[0,.16,.33,.5,.66,.83,1],oninput:function(t){Node.defaultValue=t}})),o.onedit=function(){var t=o.target,e=t.color;o.getComponent("init").setBGColor(e);var n=t.label;""!=n&&"?"!=n||o.getComponent("label").select()},o.addComponent(new O({label:"delete node",onclick:function(t){t.kill(),n.showPage("Edit")}})),n.addPage("Node",o),function(){var t=new I(n);t.addComponent("strength",new A({bg:"strength",label:"Relationship:",options:[1,-1],oninput:function(t){T.defaultStrength=t}})),t.addComponent("delay",new A({bg:"delay",label:"Delay: ",options:[0,1],oninput:function(t){T.defaultDelay=t}})),t.addComponent("color",new P({label:"Color: "})),t.addComponent("thickness",new A({bg:"initial",label:"Thickness:",options:[3,4,5,6,7,8,9],oninput:function(t){Node.defaultValue=t}})),t.onedit=function(){var e=t.target.color;t.getComponent("thickness").setBGColor(e)},t.addComponent(new O({label:"delete arrow",onclick:function(t){t.kill(),n.showPage("Edit")}})),n.addPage("Edge",t)}(),function(){var t=new I(n);t.addComponent("text",new S({label:"Label:",textarea:!0})),t.addComponent("color",new P({label:"Color:"})),t.onshow=function(){t.getComponent("text").select()},t.onhide=function(){var e=t.target;if(t.target){var o=e.text;/^\s*$/.test(o)&&(t.target=null,e.kill())}},t.addComponent(new O({label:"delete label",onclick:function(t){t.kill(),n.showPage("Edit")}})),n.addPage("Label",t)}(),function(){var t=new I(n);t.addComponent("clockwise",new A({bg:"delay",label:"Clockwise: ",options:[0,1],oninput:function(t){C.defaultOrientation=t}})),t.addComponent("reinforcement",new A({bg:"delay",label:"Reinforcement: ",options:[0,1],oninput:function(t){C.defaultOrientation=t}})),t.addComponent("color",new P({label:"Color: "})),n.addPage("LoopMark",t)}(),function(){var t=new I;t.addComponent(new B({html:"<b style='font-size:1.4em'>About ...</b> <br>Build: v2.0.0 - <strong>Pre-alpha</strong><br>an advanced and free tool for thinking in systems<br><br><font size='3'><strong>License:</strong> GPLv3</font><hr/><br><div class='sidebar-buttons'><span class='mini_button' onclick='window.publish(\"modal\",[\"save_link\"])'>Save as Link</span><span class='mini_button' onclick='window.publish(\"export/file\")'>Save as File</span><span class='mini_button' onclick='window.publish(\"import/file\")'>Load from File</span><a class='mini_button' target='_blank' rel='noreferrer' href='https://juancsucoder.github.io/SystemicWorks/report'>Report a Bug</a><a class='mini_button' target='_blank' rel='noreferrer' href='https://github.com/JuanCSUCoder/SystemicWorks'>Source Code</a><a class='mini_button' target='_blank' rel='noreferrer' href='https://github.com/JuanCSUCoder/SystemicWorks/blob/main/LICENSE'>License</a></div><hr/><br><span>SystemicWorks</span> is made by <a target='_blank' rel='noreferrer' href='https://github.com/JuanCSUCoder'>JuanCSUCoder</a> based on the <a target='_blank' rel='noreferrer' href='https://ncase.me/loopy/'>LOOPY(v1.1)</a> project of <a target='_blank' rel='noreferrer' href='http://ncase.me'>nicky case</a> "})),n.addPage("Edit",t)}(),(0,t.subscribe)("key/save",(function(){Key.control&&(0,t.publish)("modal",["save_link"])})),n}(this),this.toolbar=N(this),this.playbar=W(this),this.modal=function(e){var o,n=_(document.getElementById("modal_page"));return n.loopy=e,n.isShowing=!1,n.show=function(){document.getElementById("modal_container").setAttribute("show","yes"),n.isShowing=!0},n.hide=function(){document.getElementById("modal_container").setAttribute("show","no"),n.currentPage.onhide&&n.currentPage.onhide(),n.isShowing=!1},document.getElementById("modal_bg").onclick=n.hide,document.getElementById("modal_close").onclick=n.hide,(0,t.subscribe)("modal",(function(t){n.show();var e=n.showPage(t);e.onshow&&e.onshow();var o=document.getElementById("modal");o.style.width=n.currentPage.width+"px",o.style.height=n.currentPage.height+"px"})),(o=new E).width=670,o.height=570,o.addComponent(new J({page:o,src:"pages/examples/",width:640,height:520})).dom.style.background="#f7f7f7",n.addPage("examples",o),function(){var t=new E;t.width=530,t.height=430,t.addComponent(new J({page:t,src:"pages/howto.html",width:500,height:350}));var e=document.createElement("div");e.style.fontSize="18px",e.style.marginTop="6px",e.style.color="#777",e.innerHTML="need ideas for simulations? check out <span style='text-decoration:underline; cursor:pointer' onclick='publish(\"modal\",[\"examples\"])'>the examples!</span>",t.dom.appendChild(e),n.addPage("howto",t)}(),function(){var t=new E;t.width=690,t.height=550,t.addComponent(new J({page:t,src:"pages/credits/",width:660,height:500})),n.addPage("credits",t)}(),function(){var t=new E;t.width=500,t.height=155,t.addComponent(new B({html:"copy your link:"}));var o=t.addComponent(new D({})),i=document.createElement("div");i.style.textAlign="right",i.style.fontSize="15px",i.style.marginTop="6px",i.style.color="#888",i.innerHTML="(this is a long URL, so you may want to use a link-shortener like <a target='_blank' rel='noreferrer' href='https://bitly.com/'>bit.ly</a>)",t.dom.appendChild(i);var s=document.createElement("div");s.style.textAlign="right",s.style.fontSize="15px",s.style.marginTop="3px",s.style.color="#888",s.innerHTML="X out of 2048 characters",t.dom.appendChild(s),t.onshow=function(){var t=e.saveToURL();o.output(t),o.dom.select();var n=t.length+" / 2048 characters";t.length>2048&&(n+=" - MAY BE TOO LONG FOR MOST BROWSERS"),s.innerHTML=n,s.style.fontWeight=t.length>2048?"bold":"100",s.style.fontSize=t.length>2048?"14px":"15px"},n.addPage("save_link",t)}(),function(){var t,o=new E;o.width=700,o.height=500;var i=function(){var e='<iframe width="'+a.getValue()+'" height="'+l.getValue()+'" frameborder="0" src="'+t+'"></iframe>';c.output(e)},s=document.createElement("div");s.style.width="150px",s.style.height="440px",s.style.float="left",o.dom.appendChild(s),(d=document.createElement("div")).innerHTML="<br>PREVIEW &rarr;<br><br>",s.appendChild(d),(d=document.createElement("div")).style.fontSize="15px",d.innerHTML="what size do you want your embed to be?",s.appendChild(d);var a=r(i);s.appendChild(a.dom),(d=document.createElement("div")).style.display="inline-block",d.style.fontSize="15px",d.innerHTML="&nbsp;×&nbsp;",s.appendChild(d);var l=r(i);s.appendChild(l.dom),(d=document.createElement("div")).style.fontSize="15px",d.innerHTML="<br><br>copy this code into your website's html:",s.appendChild(d);var d,c=new D({});c.dom.style.fontSize="12px",s.appendChild(c.dom),(d=document.createElement("div")).style.fontSize="15px",d.style.textAlign="right",d.innerHTML="<br><br>(note: the REMIX button lets someone else, well, remix your model! don't worry, it'll just be a copy, it won't affect the original.)",s.appendChild(d);var u=o.addComponent(new J({page:o,manual:!0,src:"",width:500,height:440})).dom;u.style.float="right",o.onshow=function(){a.setValue(500),l.setValue(440),t=e.saveToURL(!0),u.src=t,i(),c.dom.select()},o.onhide=function(){u.removeAttribute("src")},n.addPage("embed",o)}(),n}(this),this.ink=X(this),this.drag=Y(this),this.erase=H(this),this.labeller=z(this),this.pan=F(this),this.loop=V(this),this.sidebar.showPage("Edit"),this.playbar.showPage("Editor"),(0,t.subscribe)("model/changed",(function(){e.dirty=!0})),(0,t.subscribe)("export/file",(function(){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+e.model.serialize()),t.setAttribute("download","system_model.smwks"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)})),(0,t.subscribe)("import/file",(function(){var t=document.createElement("input");t.type="file",t.onchange=function(t){var o=t.target,n=o.files[0],i=new FileReader;i.readAsText(n,"UTF-8"),i.onload=function(t){var n,i=null===(n=t.target)||void 0===n?void 0:n.result;e.model.deserialize(i,o.value)}},t.click()})),this.init=this.init.bind(this),this.update=this.update.bind(this),this.draw=this.draw.bind(this),this.setMode=this.setMode.bind(this),this.saveToURL=this.saveToURL.bind(this),setInterval(this.update,1e3/30),this.init(),this.dirty=!1,document.body.style.opacity="",requestAnimationFrame(this.draw)}return e.prototype.init=function(){var t=function(t){var e=window.location.href;t=t.replace(/[\[\]]/g,"\\$&");var o=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}("data");t||(t=decodeURIComponent(this._blankData)),this.model.deserialize(t,"default.smwks")},e.prototype.update=function(){this.mouseControl.update(),this.wobbleControls>=0&&this.wobbleControls--,this.modal.isShowing||this.model.update()},e.prototype.draw=function(){this.modal.isShowing||this.model.draw(),requestAnimationFrame(this.draw)},e.prototype.setMode=function(e){var o,n,i,s,a,r,l,d;this.mode=e,t.publish("loopy/mode"),e==et.Play?(this.temp_onlyText=this.onlyText,this.temp_onlyText&&this.toolbar.buttonsByID.mode.callback(),this.toolbar.buttonsByID.pan.callback(),this.wobbleControls=45,this.sidebar.showPage("Edit"),this.playbar.showPage("Player"),null===(o=this.sidebar.dom)||void 0===o||o.setAttribute("mode","play"),null===(n=this.toolbar.dom)||void 0===n||n.setAttribute("mode","play"),null===(i=this.playbar.dom)||void 0===i||i.setAttribute("mode","play"),null===(s=document.getElementById("canvasses"))||void 0===s||s.removeAttribute("cursor")):t.publish("model/reset"),e==et.Edit&&(this.wobbleControls=-1,this.onlyText!=this.temp_onlyText&&this.toolbar.buttonsByID.mode.callback(),this.sidebar.showPage("Edit"),this.playbar.showPage("Editor"),null===(a=this.sidebar.dom)||void 0===a||a.setAttribute("mode","edit"),null===(r=this.toolbar.dom)||void 0===r||r.setAttribute("mode","edit"),null===(l=this.playbar.dom)||void 0===l||l.setAttribute("mode","edit"),null===(d=document.getElementById("canvasses"))||void 0===d||d.setAttribute("cursor",function(t){switch(t){case ot.Drag:return"drag";case ot.Erase:return"erase";case ot.Ink:return"ink";case ot.Label:return"label";case ot.Loop:return"loop";case ot.Pan:return"pan";default:return null}}(this.toolbar.currentTool)))},e.prototype.saveToURL=function(){var t=this.model.serialize(),e=window.location.origin+window.location.pathname+"?data="+t;return this.dirty=!1,window.history.replaceState(null,"",e),e},e}(),it=function(e,o){var n=this;e.Key={},this.key_codes={Enter:"enter",n:"ink",v:"drag",e:"erase",t:"label",s:"save",p:"pan",l:"loop"},e.addEventListener("keydown",(function(i){if(!(o&&o.modal&&o.modal.isShowing)){var s=n.key_codes[i.key];e.Key[s]=!0,(0,t.publish)("key/"+s)}}),!1),e.addEventListener("keyup",(function(t){if(!(o&&o.modal&&o.modal.isShowing)){var i=n.key_codes[t.key];e.Key[i]=!1,t.stopPropagation(),t.preventDefault()}}),!1)};window.subscribe=t.subscribe,window.publish=t.publish,window.onload=function(){window.loopy=new nt,document.getElementById("goto").addEventListener("click",(function(){v("assets/fs.css")})),new it(window,window.loopy)}})()})();